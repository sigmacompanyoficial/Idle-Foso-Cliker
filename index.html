<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Foso Tycoon — Juego</title>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-JLHC8HP0RE"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-JLHC8HP0RE');
</script>
<style>
  :root { /* Paleta de colores "Senior" / "Cyber" */
    --bg: #020617; /* Casi negro */
    --panel: #0f172a; /* Azul pizarra oscuro */
    --accent: #22d3ee; /* Cian vibrante */
    --muted: #64748b; /* Gris azulado */
    --success: #2ecc71;
  }
  html, body {
      height: 100%; margin: 0; font-family: Inter, system-ui, Arial; color: #eef6ff; font-size: 15px;
      background: var(--bg); overflow: hidden; /* Evita el scroll */
  }
  .bigCounter { font-size: 20px; font-weight: 800; }
  .metaTiny { font-size: 12px; color: var(--muted); }
  .hidden { display: none !important; }
  .icon { width: 18px; height: 18px; stroke: currentColor; stroke-width: 2; fill: none; vertical-align: middle; }

  /* --- Main Layout --- */
  .game-container { position: relative; width: 100%; height: 100%; }
  .vaperWrap {
      position: fixed; inset: 0; z-index: 0;
      display: flex; align-items: center; justify-content: center;
      cursor: pointer;
  }
  .vaperWrap svg {
      width: auto; height: 80vh; max-height: 700px;
      filter: drop-shadow(0 10px 30px rgba(0,0,0,0.5));
      transition: transform 0.1s ease; /* Para la animación de pulso */
  }
  /* Smoke overlay */
  .smoke-layer{position:absolute;inset:0;pointer-events:none;overflow:visible}
  .smoke{position:absolute;width:8px;height:8px;border-radius:50%;background:rgba(255,255,255,0.6);filter:blur(0.5px);animation:smokeUp 1.2s ease-out forwards;will-change:transform,opacity}
  @keyframes smokeUp{0%{transform:translateY(0) scale(0.8);opacity:.85}100%{transform:translateY(-120px) scale(1.6);opacity:0}}
  /* Shop title fit for long names */
  .shopGrid .shopCard > div[style*="font-weight:700"]{font-size:13px;text-align:center;line-height:1.15}
  .controlsRow{display:flex;gap:12px;width:100%;justify-content:center;flex-wrap:wrap}

  /* --- Left Info Panel --- */
  .left-panel {
      position: fixed; top: 20px; left: 20px; z-index: 10;
      background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(10px);
      padding: 16px; border-radius: 12px; border: 1px solid rgba(100, 116, 139, 0.3);
      width: 620px; max-width: calc(100% - 40px); box-shadow: 0 8px 20px rgba(0,0,0,0.4);
      display: flex; flex-direction: column; max-height: calc(100vh - 40px); overflow-y: auto;
  }
  .stats-grid {
      display: grid;
      flex-shrink: 0;
      grid-template-columns: auto 1fr;
      gap: 8px 12px;
      align-items: center;
  }
  .stats-grid .icon {
      grid-column: 1;
      width: 20px; height: 20px;
      color: var(--accent);
  }
  .stats-grid > div { grid-column: 2; }
  .stats-grid .bigCounter { font-size: 1.5em; }
  .stats-grid .metaTiny { color: var(--muted); }

  /* --- Right Collapsible Menu --- */
  .right-menu-toggle {
      position: fixed; top: 10px; right: 10px; z-index: 10021; /* Por encima del panel de ranking */
      width: 50px; height: 50px;
  }
  .right-menu {
      position: fixed; top: 0; right: 0; bottom: 0; z-index: 11;
      width: 280px; background: rgba(15, 23, 42, 0.9); backdrop-filter: blur(10px);
      border-left: 1px solid rgba(100, 116, 139, 0.3);
      transform: translateX(100%); transition: transform 0.4s cubic-bezier(0.25, 1, 0.5, 1);
      padding: 70px 20px 20px; display: flex; flex-direction: column; gap: 10px;
      overflow-y: auto; /* Scroll para el menú */
  }
  .right-menu.active { transform: translateX(0); }
  .right-menu .mata-btn {
      width: 100%;
      justify-content: flex-start;
      position: relative; /* Para el punto de notificación */
  }
  .right-menu .notify-dot { right: 12px; top: 50%; transform: translateY(-50%); }

  .right-menu .mata-btn { width: 100%; justify-content: flex-start; }

  /* Botones estilo "Senior" / "Hi-Tech" */
  .mata-btn{position:relative;display:inline-flex;align-items:center;gap:8px;padding:10px 16px;border-radius:8px;border:1px solid rgba(100, 116, 139, 0.4);background:var(--panel);color:#eef6ff;font-weight:700;cursor:pointer;box-shadow: 0 1px 2px rgba(0,0,0,0.2); transition:all .2s ease}
  .mata-btn:hover{transform:translateY(-1px);background: #1e293b; box-shadow: 0 0 15px -2px var(--accent), 0 4px 10px rgba(0,0,0,0.3);}
  .mata-btn:active{transform:translateY(0)}
  .mata-btn:focus-visible{outline:2px solid var(--accent);outline-offset:2px}
  .mata-btn[disabled]{opacity:.4;cursor:not-allowed;transform:none;box-shadow:none;background: #0f172a; color: var(--muted);}
  .icon-16{width:16px;height:16px}
  .icon-20{width:20px;height:20px}

  .panel{background:var(--panel);padding:12px;border-radius:10px;border:1px solid rgba(100, 116, 139, 0.3); border-top: 2px solid var(--accent);}
  .shopGrid{display:grid;grid-template-columns:repeat(6,1fr);gap:10px;margin-top:10px;max-height:520px;overflow:auto;padding-right:6px}
  /* Tarjetas de tienda estilo "Senior" */
  .shopCard{background:var(--panel);padding:8px;border-radius:8px;display:flex;flex-direction:column;align-items:center;gap:6px;cursor:pointer;border:1px solid rgba(100, 116, 139, 0.4); transition: all 0.2s ease; box-shadow: inset 0 1px 0 rgba(255,255,255,0.03);}

  /* --- Chat Styles --- */
  #chatPanel {
    margin-top: 15px;
    background: rgba(15, 23, 42, 0.5);
    border-radius: 10px;
    padding: 12px;
    display: flex; flex-direction: column; /* Asegura el layout de columna flexible */
  }
  #chatPanel h3 { margin: 0 0 10px 0; color: var(--accent, #22d3ee); font-weight: 800; display:flex; align-items:center; gap:8px; }
  #mensajes {
    list-style: none; padding: 0; margin: 0; height: 220px; overflow-y: auto; display: flex; flex-direction: column; gap: 8px; flex-grow: 1; min-height: 50px;
  }
  #mensajes li {
    max-width: 80%; padding: 6px 10px; border-radius: 12px; position: relative; word-wrap: break-word; font-size: 13px; line-height: 1.3;
  }
  #mensajes li .hora {
    font-size: 10px; color: var(--muted); display: block; text-align: right; margin-top: 4px;
  }
  #mensajes li.mio {
    background: #1a3a5a; align-self: flex-end; border-bottom-right-radius: 4px;
  }
  #mensajes li.otro {
    background: #2a3f5a; align-self: flex-start; border-bottom-left-radius: 4px;
  }
  #mensajes li.rank-gold, #rankingPanel .rank-gold td {
    background: linear-gradient(145deg, #fde047, #eab308); color: #422006; font-weight: bold;
  }
  #mensajes li.rank-silver, #rankingPanel .rank-silver td {
    background: linear-gradient(145deg, #e5e7eb, #9ca3af); color: #1f2937; font-weight: bold;
  }
  #mensajes li.rank-bronze, #rankingPanel .rank-bronze td {
    background: linear-gradient(145deg, #fcd3a1, #d97706); color: #451a03; font-weight: bold;
  }
  #mensajes li.rank-diamond, #rankingPanel .rank-diamond td {
    background: linear-gradient(145deg, #a5f3fc, #22d3ee); color: #0e7490; font-weight: bold;
  }
  #mensajes li.rank-gold strong, #mensajes li.rank-silver strong, #mensajes li.rank-bronze strong, #mensajes li.rank-diamond strong {
    color: inherit;
    text-shadow: 0 1px 1px rgba(255,255,255,0.2);
  }
  .input-area { display: flex; margin-top: 10px; gap: 8px; }
  #replyingTo {
    background: rgba(0,0,0,0.2);
    padding: 8px;
    border-radius: 6px;
    margin-bottom: 8px;
    font-size: 12px;
    border-left: 3px solid var(--accent);
    position: relative;
  }
  #replyingTo p { margin: 0; color: var(--muted); }
  #replyingTo span {
    display: block;
    color: #fff;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  #cancelReply {
    position: absolute; top: 4px; right: 4px; cursor: pointer;
    width: 20px; height: 20px; display: flex; align-items: center; justify-content: center;
  }
  .chat-ranking-container {
    display: flex;
    gap: 15px;
    overflow: hidden; /* Para que los hijos con flex:1 se comporten */
    margin-top: 10px;
    align-items: flex-start;
  }
  .chat-ranking-container > div { flex: 1; }
  .input-area input {
    flex-grow: 1;
    background: rgba(0,0,0,0.3);
    border: 1px solid var(--muted);
    color: var(--text);
    padding: 8px;
    border-radius: 6px;
    outline: none;
  }
  .input-area button {
    padding: 8px 12px;
    border-radius: 6px;
    border: none;
    background: var(--accent);
    color: var(--bg);
    cursor: pointer;
    font-weight: bold;
  }
  .shopCard:hover { transform: translateY(-2px); box-shadow: 0 0 15px -3px var(--accent), inset 0 1px 0 rgba(255,255,255,0.03); border-color: var(--accent);}
  .shopCard img, .shopCard svg{width:72px;height:auto}
  .priceTag{background:rgba(0,0,0,0.4);padding:4px 8px;border-radius:6px;font-weight:700;font-size:13px}
  .hint{color:var(--muted);font-size:13px; line-height: 1.4; margin: 0;}
  footer{position: fixed; bottom: 10px; left: 50%; transform: translateX(-50%); text-align:center;color:var(--muted);font-size:13px; z-index: 5;}

  @media (max-width:600px){
    .left-panel { width: auto; left: 5px; right: 5px; top: 5px; padding: 10px; max-width: 100%; }
    .stats-grid { gap: 6px 10px; }
    .stats-grid .icon { width: 18px; height: 18px; }
    .stats-grid .bigCounter { font-size: 1.2em; }
    .right-menu { width: 240px; }
    .right-menu .mata-btn { padding: 8px 12px; gap: 6px; font-size: 14px; } /* Botones más pequeños */
    .right-menu { gap: 6px; } /* Menos espacio entre botones */
    .chat-ranking-container { flex-direction: column; gap: 10px; }
    .vaperWrap svg { height: 65vh; } /* Reducir altura del foso en móviles */
    .modal-content { padding: 14px; width: min(96%, 980px); }
    .modal-body { padding-top: 10px; }
    .modal-title { font-size: 1.1em; }
    #rankingPanel table { font-size: 12px; }
    #rankingPanel tbody td { padding: 4px; }
    #maintenanceGameArea { width: 90%; max-width: 300px; height: 320px; }
    .vaperWrap svg.clicked {
      transform: scale(0.98); /* Animación de pulso al hacer clic */
    }
    footer { display: none; } /* Ocultar footer en móvil para más espacio */
    #chatPanel { display: flex; flex-direction: column; min-height: 300px; max-height: 45vh; }
    #mensajes { height: auto; }
    .chat-ranking-container > div {
      min-width: 0; /* Allow flex items to shrink properly */
    }
  }
  @media (max-width: 900px) {
    /* 3 columnas para tablets, 2 para móviles */
    .shopGrid{grid-template-columns:repeat(auto-fill, minmax(100px, 1fr));}
  }
  /* Modal mejorado: glass + bordes suaves + encabezado */
  .modal { position: fixed; inset:0; display:flex; justify-content:center; align-items:center; z-index:9999; background: rgba(3,10,20,0.65); backdrop-filter: blur(6px); }
  .modal.hidden { display:none; }
  .modal-content { /* Modal estilo "Senior" */
    position: relative; background: var(--panel);
    border: 1px solid rgba(100, 116, 139, 0.5);
    border-top: 3px solid var(--accent);
    box-shadow: 0 20px 60px rgba(0,0,0,0.55); animation: modalIn 0.3s cubic-bezier(0.25, 1, 0.5, 1);
    border-radius: 16px;
    padding: 18px 18px 14px; width: min(94%, 980px); max-height: 84vh; overflow: hidden; color: #e7edf6;
  }
  .modal-header { display:flex; align-items:center; justify-content:space-between; gap:10px; padding-bottom:10px; border-bottom:1px solid rgba(100, 116, 139, 0.3); }
  .modal-title { font-weight:800; letter-spacing:.2px; }
  .close-btn { display:inline-flex; align-items:center; justify-content:center; width:32px; height:32px; border-radius:8px; cursor:pointer; color:#9fb2c8; background:rgba(255,255,255,0.04); border:1px solid rgba(255,255,255,0.06); }
  .close-btn:hover { background:rgba(255,255,255,0.08); color:#fff; }
  .modal-body { overflow:auto; max-height: calc(84vh - 56px); padding-top:12px; }
  @keyframes modalIn { from { opacity: 0; transform: scale(0.95) translateY(20px); } to { opacity: 1; transform: scale(1) translateY(0); } }
.powers-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
  gap: 15px;
  margin-top: 20px;
}
.power-card {
  background: #222;
  border: 1px solid #444;
  border-radius: 8px;
  padding: 12px;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 8px;
  text-align: center;
}
.power-card .power-icon {
  font-size: 28px;
}
.power-card h4 {
  margin: 0;
  font-size: 14px;
}
.power-card p {
  margin: 0;
  font-size: 12px;
  transition: transform 0.2s, box-shadow 0.2s;
}
.power-card:hover {
  transform: scale(1.05);
  box-shadow: 0 0 12px #0ff;
}
.power-card button:disabled {
  background: #444; color:#999; cursor: not-allowed;
}

/* Animación de humo al hacer clic */
.smoke-on-click {
  position: absolute;
  bottom: 120px; /* Ajusta para que salga de la boquilla */
  left: 50%;
  width: 12px;
  height: 12px;
  background: rgba(255, 255, 255, 0.6);
  border-radius: 50%;
  filter: blur(2px);
  transform: translateX(-50%);
  pointer-events: none;
  animation: smokeUpOnClick 1.5s ease-out forwards;
}

@keyframes smokeUpOnClick { /* Ajustado para el foso grande */
  from { transform: translate(-50%, 0) scale(0.5); opacity: 0.9; }
  to   { transform: translate(-50%, -80px) scale(2.5); opacity: 0; }
}

/* --- Toast (Notificaciones) Estilo "Senior" --- */
#toastContainer {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  flex-direction: column-reverse;
  gap: 10px;
  z-index: 10002;
  align-items: center;
}
.toast {
  display: flex; align-items: center; gap: 10px;
  background: var(--panel); color: #eef6ff;
  padding: 10px 16px; border-radius: 10px;
  border: 1px solid rgba(100, 116, 139, 0.4);
  box-shadow: 0 5px 20px rgba(0,0,0,0.4);
  font-weight: 600; font-size: 14px;
  animation: toastIn 0.3s ease forwards, toastOut 0.3s ease 1.7s forwards;
}
@keyframes toastIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
@keyframes toastOut { from { opacity: 1; transform: translateY(0); } to { opacity: 0; transform: translateY(20px); } }

#autoClickPointer {
  position: absolute;
  width: 24px;         /* más pequeño */
  height: 24px;
  background: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'><path fill='%23ffffff' d='M3 2l7 18 2-7 7-2z'/><path fill='%23000000' opacity='0.2' d='M10 20l2-7 7-2-9 9z'/></svg>") no-repeat center;
  background-size: contain;
  pointer-events: none;  /* no bloquea nada */
  opacity: 0;
  transform: scale(1);
  transition: transform 0.15s ease, opacity 0.15s ease;
  z-index: 1;           /* por debajo de UI pero encima del foso */
}
#autoClickPointer.active {
  opacity: 0.8;         /* aparece más sutil */
  transform: scale(0.7);
}

.click-value {
  position: absolute;
  z-index: 10;
  pointer-events: none;
  font-size: 22px;
  font-weight: bold;
  color: #fff;
  text-shadow: 0 0 5px #ffc107, 0 0 10px #ffc107;
  animation: floatUp 1s ease-out forwards;
  white-space: nowrap; /* Evita que el texto se parta */
}

.notify-dot {
  position: absolute;
  top: 6px; right: 10px; width: 8px; height: 8px;
  background: #ef4444; border-radius: 50%;
  border: 1px solid var(--panel);
  box-shadow: 0 0 5px #ef4444;
}
.right-menu-toggle .notify-dot {
  position: absolute;
  top: 8px; right: 8px; width: 10px; height: 10px;
  background: #ef4444; border-radius: 50%;
  box-shadow: 0 0 5px #ef4444;
}

/* --- Estilos de Mantenimiento --- */
.maintenance-bar-container {
    width: 80%;
    max-width: 250px;
    margin-top: 5px;
    text-align: center;
}
.maintenance-bar {
    height: 12px;
    background: rgba(0,0,0,0.4);
    border-radius: 6px;
    border: 1px solid #444;
    overflow: hidden;
}
.maintenance-bar-fill {
    height: 100%;
    background: linear-gradient(90deg, #2ecc71, #f1c40f, #e74c3c);
    background-size: 300% 100%;
    transition: background-position 0.5s ease, width 0.5s ease;
}

/* Animación de vibración para foso dañado */
@keyframes shake {
  0%, 100% { transform: translateX(0); }
  10%, 30%, 50%, 70%, 90% { transform: translateX(-2px); }
  20%, 40%, 60%, 80% { transform: translateX(2px); }
}
.foso-shaking {
    animation: shake 0.5s infinite;
}
@keyframes floatUp {
    from { transform: translateY(0); opacity: 1; }
    to   { transform: translateY(-60px); opacity: 0; }
}

/* Animación de vibración para combo máximo */
@keyframes combo-shake {
  0%, 100% { transform: translate(-1px, 1px) rotate(-1deg); }
  25% { transform: translate(1px, 1px) rotate(1deg); }
  50% { transform: translate(1px, -1px) rotate(-1deg); }
  75% { transform: translate(-1px, -1px) rotate(1deg); }
}
.foso-combo-max {
    animation: combo-shake 0.2s infinite;
}
.vaperWrap svg.clicked {
  transform: scale(0.99);
}


/* Lluvia de Monedas */
.coin-rain {
    position: fixed; top: -50px; left: 0; width: 100%; height: 100vh;
    pointer-events: none; z-index: 10003;
}
.coin {
    position: absolute; font-size: 24px; animation: fall 5s linear forwards;
}
@keyframes fall { from { top: -50px; } to { top: 100vh; transform: rotate(720deg); } }


/* Humo negro para foso dañado */
.black-smoke {
    background: rgba(50, 50, 50, 0.7) !important;
    filter: blur(3px) !important;
}

/* Mini-juego de Mantenimiento */
#maintenanceGameArea {
    position: relative;
    width: 300px;
    height: 360px;
    margin: 20px auto;
    background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 260"><rect x="20" y="20" width="60" height="220" rx="12" fill="%23333"/><rect x="20" y="0" width="60" height="20" rx="10" fill="%23111"/></svg>') no-repeat center center;
    background-size: contain;
}
.maintenance-point {
    position: absolute;
    width: 30px; height: 30px; background: rgba(255, 255, 0, 0.8);
    border: 2px solid white; border-radius: 50%;
    display: flex; justify-content: center; align-items: center;
    font-weight: bold; color: black; cursor: pointer;
}
/* --- Estilos de Eventos Aleatorios --- */
#eventBanner {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    background: linear-gradient(45deg, var(--accent), #f39c12);
    color: black;
    text-align: center;
    padding: 10px;
    font-weight: bold;
    z-index: 10001; /* Encima de todo */
    box-shadow: 0 2px 10px rgba(0,0,0,0.5);
}
/* Achievement Styles */
#achievementsGrid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 12px;
}

.achievement-card {
    background: var(--panel);
    border: 1px solid rgba(255,255,255,0.05);
    border-radius: 8px;
    padding: 12px;
    display: flex;
    align-items: center;
    gap: 12px;
    transition: all 0.2s ease;
}

.achievement-card.unlocked {
    background: linear-gradient(145deg, rgba(245, 158, 11, 0.1), rgba(245, 158, 11, 0.02));
    border-color: rgba(245, 158, 11, 0.3);
}

.achievement-icon {
    font-size: 28px;
    flex-shrink: 0;
    width: 32px; height: 32px;
}

.achievement-card.locked .achievement-icon {
    filter: grayscale(100%);
    opacity: 0.5;
}

.achievement-info h4 {
    margin: 0 0 4px;
    font-size: 14px;
    color: #fff;
}

.achievement-card.locked .achievement-info h4 {
    color: var(--muted);
}

.achievement-info p {
    margin: 0;
    font-size: 12px;
    color: var(--muted);
}

.achievement-card.unlocked .achievement-info p {
    color: #f5b041;
}

/* Wheel Styles */
.wheel-container {
    position: relative;
    width: 300px;
    height: 300px;
    margin: 20px auto;
}

.wheel-pointer {
    position: absolute;
    top: -10px;
    left: 50%;
    transform: translateX(-50%);
    width: 0;
    height: 0;
    border-left: 20px solid transparent;
    border-right: 20px solid transparent;
    border-top: 35px solid var(--accent);
    z-index: 10;
    filter: drop-shadow(0 -2px 2px rgba(0,0,0,0.5));
}

.wheel {
    list-style: none;
    padding: 0;
    margin: 0;
    position: relative;
    width: 300px;
    height: 300px;
    border-radius: 50%;
    overflow: hidden;
    transition: transform 5s cubic-bezier(0.2, 0.8, 0.2, 1);
    border: 8px solid #1a2a4a;
    box-shadow: 0 0 20px rgba(0,0,0,0.6), inset 0 0 15px rgba(0,0,0,0.4);
}

.wheel .segment {
    overflow: hidden;
    position: absolute;
    top: 0;
    right: 0;
    width: 50%;
    height: 50%;
    transform-origin: 0% 100%;
}

.wheel .segment .text {
    position: absolute;
    left: -100%;
    width: 200%;
    height: 200%;
    text-align: center;
    display: block;
    transform: skewY(45deg) rotate(22.5deg);
    background: var(--color);
    padding-top: 50px;
    font-weight: bold;
    color: white;
    font-size: 14px;
}

/* Mission Styles */
#missionsGrid {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.mission-card {
    background: var(--panel);
    border: 1px solid rgba(255,255,255,0.05);
    border-radius: 8px;
    padding: 12px;
    display: flex;
    align-items: center;
    gap: 12px;
}

.mission-info {
    flex-grow: 1;
}

.mission-info h4 {
    margin: 0 0 4px;
    font-size: 14px;
}

.mission-progress-bar {
    width: 100%;
    height: 10px;
    background: rgba(0,0,0,0.3);
    border-radius: 5px;
    overflow: hidden;
    margin-top: 5px;
}

.mission-progress-fill {
    width: 0%;
    height: 100%;
    background: var(--accent);
    transition: width 0.3s ease;
}

.mission-card button {
    flex-shrink: 0;
}

/* --- Tutorial Styles --- */
.tutorial-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(2px);
    z-index: 10004; /* Above everything */
    pointer-events: none; /* Allow clicks through by default */
}
.tutorial-highlight {
    position: absolute;
    border: 3px solid var(--accent);
    border-radius: 12px;
    box-shadow: 0 0 20px var(--accent);
    transition: all 0.3s ease-in-out;
    pointer-events: all; /* Clicks on the highlight are for the element underneath */
}
.tutorial-tooltip {
    position: absolute;
    background: var(--panel);
    color: #eef6ff;
    padding: 12px 16px;
    border-radius: 10px;
    border: 1px solid var(--accent);
    box-shadow: 0 5px 20px rgba(0,0,0,0.4);
    max-width: 280px;
    z-index: 10005;
    pointer-events: all; /* Clickable */
    transform-origin: center;
    animation: toastIn 0.3s ease;
}
.tutorial-tooltip p {
    margin: 0 0 10px;
    font-size: 14px;
    line-height: 1.4;
}
.tutorial-tooltip button {
    width: 100%;
    justify-content: center;
}
.tutorial-arrow {
    position: absolute;
    width: 20px;
    height: 20px;
    background: var(--panel);
    border-top: 1px solid var(--accent);
    border-left: 1px solid var(--accent);
    transform: rotate(45deg);
}
.tutorial-arrow.top { top: -10px; left: calc(50% - 10px); }
.tutorial-arrow.bottom { bottom: -10px; left: calc(50% - 10px); transform: rotate(225deg); }
.tutorial-arrow.left { left: -10px; top: calc(50% - 10px); transform: rotate(-45deg); }
.tutorial-arrow.right { right: -10px; top: calc(50% - 10px); transform: rotate(135deg); }
.tutorial-active { pointer-events: auto !important; /* Re-enable pointer events for the overlay */
}

/* --- Estilos del Panel de Ranking --- */
#rankingPanel {
  position: relative;
  width: auto;
  background: rgba(15, 23, 42, 0.5);
  border-radius: 10px;
  padding: 12px;
  color: #e7eef6;
  font-family: Inter, system-ui, Arial;
  font-size: 14px;
}
#rankingPanel h3 {
  margin: 0 0 10px 0;
  color: var(--accent, #22d3ee);
  font-weight: 800;
  display:flex; align-items:center; gap:8px;
}
#rankingPanel h3 svg {
  width: 24px; height: 24px;
  animation: trophy-shine 3s infinite;
}
@keyframes trophy-shine {
  0%, 100% { filter: drop-shadow(0 0 1px var(--accent)); }
  50% { filter: drop-shadow(0 0 6px var(--accent)); }
}
#rankingPanel #rankingTable tr {
  opacity: 0;
  transform: translateY(10px);
  animation: fadeInRow 0.5s ease forwards;
}
#rankingPanel .ranking-table-container { max-height: 200px; overflow-y: auto; }
#rankingPanel table { width:100%; border-collapse:collapse; }
#rankingPanel thead th { text-align:left; color: rgba(230,240,255,0.7); font-weight:700; padding:6px 6px 8px 0; font-size:12px; }
#rankingPanel tbody td { padding:6px 6px; border-bottom: 1px solid rgba(100,116,139,0.08); font-size:13px; color:#dfeeff; }
#rankingControls { display:flex; gap:8px; margin:10px 0 8px 0; align-items:center; }
#playerNameInput { flex:1; padding:6px 8px; border-radius:8px; border:1px solid rgba(100,116,139,0.2); background:rgba(0,0,0,0.12); color:inherit; }
.mini-btn { padding:6px 8px; border-radius:8px; border:none; cursor:pointer; font-weight:700; background: linear-gradient(90deg,#16a34a,#10b981); color:#04101a; }
.mini-btn.ghost { background: rgba(255,255,255,0.03); color:var(--muted,#aab4c4); border:1px solid rgba(100,116,139,0.12); }
#rankingEmpty { color: var(--muted,#8aa0b8); font-size:13px; padding:6px 0; }
#registerPrompt { font-size: 11px; color: #f59e0b; text-align: center; padding: 4px; background: rgba(245, 158, 11, 0.1); border-radius: 4px; margin-bottom: 6px; display: none; }
@keyframes fadeInRow {
  to {
    opacity: 1;
    transform: translateY(0);
  }
}
#rankingPanel .currentUser td {
  background: rgba(34, 211, 238, 0.1);
  font-weight: bold;
  color: #fff;
}
#vaperWrap, .vaperWrap {
  position: absolute;
  left: calc(50% + 100px);
  transform: translateX(-50%);
  z-index: 5;
}
/* --- Scroll vertical en la tabla de ranking --- */
#rankingContainer {
  max-height: 400px;   /* altura máxima visible */
  overflow-y: auto;    /* activa scroll vertical */
  scrollbar-width: thin; /* estiliza scroll (Firefox) */
}

/* opcional: estilo más limpio en navegadores webkit */
#rankingContainer::-webkit-scrollbar {
  width: 8px;
}
#rankingContainer::-webkit-scrollbar-thumb {
  background: rgba(255,255,255,0.3);
  border-radius: 4px;
}
#rankingContainer::-webkit-scrollbar-thumb:hover {
  background: rgba(255,255,255,0.5);
}
/* --- Scroll vertical solo dentro del área del ranking --- */
#rankingContainer {
  max-height: 250px;   /* ajusta según el espacio del panel */
  overflow-y: auto;    /* activa scroll vertical */
  overflow-x: hidden;  /* evita desplazamiento lateral */
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: 6px;
  margin-top: 6px;
  scrollbar-width: thin;
  scrollbar-color: rgba(255,255,255,0.3) transparent;
}

/* scroll más limpio en Chrome / Edge */
#rankingContainer::-webkit-scrollbar {
  width: 8px;
}
#rankingContainer::-webkit-scrollbar-thumb {
  background: rgba(255,255,255,0.3);
  border-radius: 4px;
}
#rankingContainer::-webkit-scrollbar-thumb:hover {
  background: rgba(255,255,255,0.5);
}

@media (max-width:900px){
  /* en pantallas pequeñas permitimos ocultar el panel con botón */
  #rankingPanel.collapsed { transform: translateX(-220px); transition: transform .25s ease; }
}

</style>
  <link rel="icon" type="image/png" href="logo%20oficial.png">
  <link rel="apple-touch-icon" href="logo%20oficial.png">
  <meta property="og:image" content="logo%20oficial.png">
</head>
<body>
  <!-- Banner para Eventos Aleatorios -->
  <div id="eventBanner" class="hidden">
      <span id="eventName"></span> - <span data-lang="time_left">Tiempo restante</span>: <span id="eventTimer">60s</span>
  </div>
<body>
  <div id="intro-animation" style="position:fixed;inset:0;background:#020617;display:flex;justify-content:center;align-items:center;z-index:10000;flex-direction:column;color:white;font-family:Arial,sans-serif;opacity:1;transition:opacity 1s ease-out;" class="no-scroll">
      <div class="intro-slide" id="intro-text1">
          <div style="width: 150px; height: 150px; margin-bottom: 20px;">
              <img src="ChatGPT Image 8 de set. del 2025, 12_51_42.png" alt="Sigma Company Logo" style="width: 100%; height: 100%; object-fit: contain;">
          </div>
          <h1>Sigma Company Presenta</h1>
      </div>
      <div class="intro-slide" id="intro-text2" style="display:none;">
          <div style="width: 150px; height: 150px; margin-bottom: 20px;">
              <img src="logo oficial.png" alt="Idle Foso Clicker Logo" style="width: 100%; height: 100%; object-fit: contain;">
          </div>
          <h1>Foso Tycoon</h1>
      </div>
  </div>
  <style>
      .intro-slide {
          display: flex;
          flex-direction: column;
          align-items: center;
          position: absolute;
          opacity: 0;
          transform: scale(0.9);
          transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
      }
      .intro-slide.active {
          opacity: 1;
          transform: scale(1);
      }
  </style>

  <!-- Tutorial Overlay -->
  <div id="tutorialOverlay" class="tutorial-overlay hidden">
      <div id="tutorialHighlight" class="tutorial-highlight"></div>
      <div id="tutorialTooltip" class="tutorial-tooltip">
          <div id="tutorialArrow" class="tutorial-arrow"></div>
          <p id="tutorialText" style="margin: 0 0 10px; font-size: 14px; line-height: 1.4;"></p>
          <button id="tutorialSkipBtn" class="mata-btn" style="background:#c11e3c; justify-content: center; width: 100%; margin-top: 5px; display: none;">Saltar Tutorial</button>
          <button id="tutorialNextBtn" class="mata-btn">Siguiente</button>
      </div>
  </div>
  <!-- Pantalla de advertencia mejorada -->
  <div id="advertencia" style="position:fixed;inset:0;background:#000;display:flex;justify-content:center;align-items:center;z-index:9999; padding: 10px;">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 600" style="width:100%;max-width:1200px;height:auto" font-family="Arial" font-weight="bold" text-anchor="middle">
      <defs>
        <radialGradient id="gBg" cx="50%" cy="40%" r="70%">
          <stop offset="0%" stop-color="#111"/>
          <stop offset="100%" stop-color="#000"/>
        </radialGradient>
      </defs>
      <rect width="800" height="600" fill="url(#gBg)"/>
      <polygon points="400,100 500,300 300,300" fill="yellow" stroke="black" stroke-width="5"/>
      <text x="400" y="280" font-size="150" fill="black">!</text>
      <text x="400" y="380" font-size="54" fill="white">FOSO IDLE TYCOON</text>
      <text x="400" y="430" font-size="54" fill="white">es una obra de ficción.</text>
      <text x="400" y="500" font-size="45" fill="white">Fumar y vapear dañan la salud.</text>
      <text x="400" y="560" font-size="42" fill="white">Juega de forma responsable.</text>
    </svg>
  </div>
  
  <div class="game-container">
    <div class="left-panel">
        <div class="stats-grid">
            <!-- Sigmacoins -->
            <svg class="icon" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z"/></svg>
            <div>
                <div class="bigCounter"><span id="sigTotal">0</span> ΣC</div>
                <div class="metaTiny"><span data-lang="per_click">Por clic</span>: <span id="perClick">1</span> ΣC</div>
            </div>

            <!-- Rango -->
            <svg class="icon" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
            <div>
                <div id="rankTitle" style="font-weight: bold; color: var(--accent);"></div>
                <div class="metaTiny"><span data-lang="total_clicks">Clicks totales</span>: <span id="totalClicks">0</span></div>
            </div>

            <!-- Racha Diaria -->
            <svg class="icon" viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
            <div>
                <div style="font-weight:700"><span data-lang="streak">Racha</span>: <span id="dailyStreak">0</span> <span data-lang="days">días</span></div>
                <div class="metaTiny" id="streakHint" data-lang="streak_hint">Vuelve cada día para aumentar tu racha</div>
            </div>
        </div>

          <!-- Barra de Combo -->
          <div id="comboContainer" class="hidden" style="width: 100%; text-align: center; margin-top: 15px;">
              <div id="comboText" style="font-weight: bold; color: #ffc107; font-size: 16px;"></div>
              <div style="background: rgba(0,0,0,0.3); border-radius: 5px; overflow: hidden; height: 8px; margin-top: 4px;">
                  <div id="comboBar" style="width: 100%; height: 100%; background: #ffc107; transition: width 0.1s linear;"></div>
              </div>
          </div>

          <!-- Barra de Condición del Foso -->
          <div class="maintenance-bar-container" style="width: 100%; max-width: none; margin-top: 15px;">
              <div class="metaTiny" data-lang="foso_condition" style="display: flex; align-items: center; gap: 4px;"><svg class="icon" style="width:14px; height:14px;" viewBox="0 0 24 24"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path></svg> Condición del Foso</div>
              <div class="maintenance-bar">
                  <div id="maintenanceBarFill" class="maintenance-bar-fill"></div>
              </div>
          </div>

          <div class="chat-ranking-container">
            <!-- Chat Panel -->
            <div id="chatPanel">
              <h3><svg class="icon" style="width:20px; height:20px;" viewBox="0 0 24 24"><path fill="currentColor" d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/></svg> Sigma Chat</h3>
              <div id="replyingTo" class="hidden">
                <!-- Contenido de la respuesta aquí -->
              </div>
              <ul id="mensajes"></ul>
              <div class="input-area">
                <input id="msg" placeholder="Escribe un mensaje..." />
                <button id="enviar">Enviar</button>
              </div>
            </div>
            <!-- Panel de Ranking movido aquí -->
            <div id="rankingPanel" aria-label="Ranking — Más clics, más dinero">
              <h3><svg viewBox="0 0 24 24" fill="currentColor"><path d="M20.2,5.2H18V3c0-0.6-0.4-1-1-1h-2.4c-0.6,0-1,0.4-1,1v2.2H8.2V3c0-0.6-0.4-1-1-1H4.8c-0.6,0-1,0.4-1,1v2.2H2.2 C1.5,5.2,1,5.7,1,6.4v3.2c0,0.4,0.2,0.7,0.5,0.9l7.5,4.5c0.3,0.2,0.7,0.2,1,0l7.5-4.5c0.3-0.2,0.5-0.5,0.5-0.9V6.4 C21.2,5.7,20.7,5.2,20.2,5.2z M4.8,18.8h14.4c0.6,0,1-0.4,1-1V11l-7.5,4.5c-0.3,0.2-0.7,0.2,1,0L3.8,11v6.8 C3.8,18.4,4.2,18.8,4.8,18.8z M19.2,20.8H4.8c-1.2,0-2.2-1-2.2-2.2v-1.2h18.8v1.2C21.4,19.8,20.4,20.8,19.2,20.8z"/></svg> Ranking</h3>
              <div id="registerPrompt">¡Registra tu nombre para guardar tu puntuación!</div>
              <div id="rankingControls">
                <input id="playerNameInput" placeholder="Tu nombre (Ej: Pepe42)" value="Jugador" />
                <button id="btnSaveNow" class="mini-btn" title="Guardar ahora">Guardar</button>
              </div>
              <div style="display:flex;gap:8px;align-items:center;margin-bottom:6px;">
                <div class="metaTiny" style="flex:1;color:var(--muted,#9fb2c8)">ΣC: <span id="panelSigma">0</span></div>
                <div class="metaTiny" style="color:var(--muted,#9fb2c8)">Clicks: <span id="panelClicks">0</span></div>
              </div>
              <div id="rankingContainer">
                <table aria-live="polite" role="table">
                  <thead>
                    <tr><th>Jugador</th><th style="text-align:center">Clics</th></tr>
                  </thead>
                  <tbody id="rankingTable">
                    <tr id="rankingEmptyRow"><td colspan="3" id="rankingEmpty">Cargando ranking…</td></tr>
                  </tbody>
                </table>
              </div>
              <div style="margin-top:12px; display:flex; gap:8px;">
                <button id="btnToggleSave" class="mini-btn ghost" title="Activar/Desactivar guardado automático">Auto-save: ON</button>
                <button id="btnRefreshRanking" class="mini-btn ghost" title="Forzar recarga del ranking">Refrescar</button>
              </div>
            </div>
          </div>
<!-- ===========================
     SCRIPTS: FIREBASE + LÓGICA
     =========================== -->
<script type="module">
  // ----- IMPORTS de Firebase (modular) -----
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
  import { getDatabase, ref, set, onValue, get, child, push, onChildAdded, remove, query, limitToFirst } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-database.js";

  // ----- CONFIG: reemplaza esto con tu firebaseConfig real -----
  const firebaseConfig = {
    apiKey: "AIzaSyDaS5OObMey6w21wyE2svLxFH9uKO5g6Gg",
    authDomain: "foso-game.firebaseapp.com",
    databaseURL: "https://foso-game-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "foso-game",
    storageBucket: "foso-game.firebasestorage.app",
    messagingSenderId: "256849527517",
    appId: "1:256849527517:web:2d9ef58d80d4b772a61134",
    measurementId: "G-JLHC8HP0RE"
  };
  // ------------------------------------------------------------

  // Inicializar Firebase
  let app, db;
  try {
    app = initializeApp(firebaseConfig);
    db = getDatabase(app);
  } catch (e) {
    console.error("Firebase initialization error:", e);
    document.getElementById('rankingEmpty').innerText = "Error Firebase: revisa firebaseConfig en el HTML.";
  }

  // Elementos UI
  const rankingTable = document.getElementById("rankingTable");
  const rankingEmpty = document.getElementById("rankingEmpty");
  const playerNameInput = document.getElementById("playerNameInput");
  const btnSaveNow = document.getElementById("btnSaveNow");
  const btnToggleSave = document.getElementById("btnToggleSave");
  const btnRefreshRanking = document.getElementById("btnRefreshRanking");
  const panelSigma = document.getElementById("panelSigma");
  const registerPrompt = document.getElementById("registerPrompt");
  const panelClicks = document.getElementById("panelClicks");
  let localPlayerId = localStorage.getItem('localPlayerId') || `Jugador#${Math.floor(1000 + Math.random() * 9000)}`;

  // Variable global para guardar el ranking ordenado
  let rankedPlayers = [];

  // Chat UI Elements
  const chatLista = document.getElementById("mensajes");
  const chatInput = document.getElementById("msg");
  const chatEnviarBtn = document.getElementById("enviar");
  const replyingToContainer = document.getElementById('replyingTo');

  // Usa los ids existentes en tu HTML si existen (para reflejar valores en el panel)
  const totalClicksEl = document.getElementById("totalClicks");
  const sigTotalEl = document.getElementById("sigTotal");

  // Modo auto-save
  let autoSaveEnabled = true;
  let autoSaveInterval = 5000; // ms
  let autoSaveTimer = null;

  // Estado del chat
  let replyingTo = null;

  // Guarda los datos del jugador en Realtime DB
  function savePlayerData(nombre, clicks, dinero, isAutoSave = false) {
    if (!db) return;
    const savedName = localStorage.getItem('playerName');
    if (!savedName && isAutoSave) return; // No auto-guardar si no hay nombre registrado
    const key = sanitizeKey(savedName || localPlayerId);
    set(ref(db, 'players/' + key), {
      name: nombre,
      clicks: Number(clicks) || 0,
      dinero: Number(dinero) || 0,
      updatedAt: Date.now()
    }).catch(err => console.error("savePlayerData error:", err));
  }

  // Cargar ranking (suscripción en tiempo real)
  function loadRankingRealtime() {
    if (!db) return;
    const playersRef = ref(db, 'players');
    onValue(playersRef, (snapshot) => {
      const val = snapshot.val();
      renderRanking(val);
    }, (err) => {
      console.error("onValue error:", err);
      rankingEmpty.innerText = "No se pudo cargar el ranking.";
    });
  }

  // Renderiza la tabla desde el objeto players
  function renderRanking(dataObj) {
    rankingTable.innerHTML = "";
    if (!dataObj) {
      rankingEmpty.innerText = "Aún no hay jugadores.";
      rankingTable.appendChild(document.getElementById('rankingEmptyRow'));
      return;
    }
    // Transformar en array, ordenar y guardar en la variable global
    const players = Object.entries(dataObj).map(([k,v]) => {
      // soporta tanto estructura con nombre dentro como sin ella
      return {
        key: k,
        name: v?.name ?? k,
        clicks: Number(v?.clicks ?? 0),
        dinero: Number(v?.dinero ?? 0),
        updatedAt: v?.updatedAt ?? 0
      };
    }).sort((a,b) => b.clicks - a.clicks);
    
    rankedPlayers = players; // Actualizar la lista global
    // Si está vacío
    if (players.length === 0) {
      rankingEmpty.innerText = "Aún no hay jugadores.";
      rankingTable.appendChild(document.getElementById('rankingEmptyRow'));
      return;
    }

    // Limitar filas al Top 15
    const top15 = players.slice(0, 15);
    const currentPlayerName = localStorage.getItem('playerName') || localPlayerId;
    let isPlayerInTop15 = false;

    top15.forEach((p, i) => {
      const tr = document.createElement("tr");
      const rankClasses = {
        0: 'rank-gold',
        1: 'rank-silver',
        2: 'rank-bronze'
      };
      tr.style.animationDelay = `${i * 0.05}s`;
      if (p.name === currentPlayerName) {
        tr.classList.add('currentUser');
        isPlayerInTop15 = true;
      }
      if (p.name.toLowerCase() === 'ceo') tr.classList.add('rank-diamond');
      else if (rankClasses[i]) tr.classList.add(rankClasses[i]);

      tr.innerHTML = `
        <td style="padding-left:6px; max-width: 120px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${escapeHtml(p.name)}">${escapeHtml(p.name)}</td>
        <td style="text-align:center">${p.clicks.toLocaleString()}</td>
      `;
      rankingTable.appendChild(tr);
    });

    // Si el jugador no está en el top 15, pero existe en la lista, añadirlo al final para que vea su posición
    if (!isPlayerInTop15) {
        const playerIndex = players.findIndex(p => p.name === currentPlayerName);
        if (playerIndex > -1) {
            const player = players[playerIndex];
            const rankClasses = {
                0: 'rank-gold',
                1: 'rank-silver',
                2: 'rank-bronze'
            };
            const tr = document.createElement("tr");
            tr.className = 'currentUser';
            if (player.name.toLowerCase() === 'ceo') tr.classList.add('rank-diamond');
            else if (rankClasses[playerIndex]) tr.classList.add(rankClasses[playerIndex]);

            tr.innerHTML = `
                <td style="padding-left:6px; max-width: 120px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${escapeHtml(player.name)}">${playerIndex + 1}. ${escapeHtml(player.name)}</td>
                <td style="text-align:center">${player.clicks.toLocaleString()}</td>
            `;
            rankingTable.appendChild(tr);
        }
    }
  }

  // Util: sanear clave para Realtime DB (no puntos, #, $, [, ])
  function sanitizeKey(k) {
    return String(k).replace(/[.#$[\]]/g, "_");
  }

  // Escape simple para nombres en HTML
  function escapeHtml(s) {
    return String(s).replace(/[&<>"']/g, c => ({
      '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'
    }[c]));
  }

  // Formatear números grandes con sufijos (k, M, B, T...)
  function formatNum(n) {
      if (n < 1e3) return n.toString();
      const suffixes = ["", "k", "M", "B", "T", "Qa", "Qi", "Sx", "Sp", "Oc", "No", "Dc"];
      const i = Math.floor(Math.log10(n) / 3);
      const num = (n / Math.pow(10, i * 3));
      // Evitar decimales si el número es entero (ej: 1.00k -> 1k)
      // Mostrar 1 o 2 decimales si los tiene.
      if (num % 1 === 0) {
          return num.toFixed(0) + suffixes[i];
      } else if (num < 10) {
          return num.toFixed(2) + suffixes[i];
      }
      return num.toFixed(1) + suffixes[i];
  }

  // Actualiza los valores del panel desde tu UI del juego si existen
  function refreshPanelFromGameUI() {
    const clicks = totalClicksEl ? (Number(totalClicksEl.innerText) || 0) : 0;
    const dinero = window.gameState ? window.gameState.sig : 0; // Usar el estado real del juego
    panelClicks.innerText = clicks.toLocaleString();
    panelSigma.innerText = dinero.toLocaleString();
  }

  // Guardado automático periódico (toma el nombre del input)
  function startAutoSave() {
    stopAutoSave();
    autoSaveTimer = setInterval(() => {
      const name = playerNameInput.value;
      const clicks = totalClicksEl ? parseInt(totalClicksEl.innerText.replace(/,/g, ''), 10) || 0 : 0;
      const dinero = window.gameState ? window.gameState.sig : 0;
      savePlayerData(name, clicks, dinero, true); // isAutoSave = true
      // actualizar panel (local)
      refreshPanelFromGameUI();
    }, autoSaveInterval);
  }
  function stopAutoSave() {
    if (autoSaveTimer) clearInterval(autoSaveTimer);
    autoSaveTimer = null;
  }

  // Botones UI
  btnSaveNow.addEventListener("click", async () => {
    const name = playerNameInput.value;
    if (!name || name.trim() === "" || name === "Jugador") {
        registerPrompt.style.display = 'block';
        showToast("Por favor, introduce un nombre válido.", "error");
        return;
    }

    // Comprobar si el nombre ya existe
    const key = sanitizeKey(name);
    const playerRef = ref(db, 'players/' + key);
    const snapshot = await get(playerRef);

    const oldName = localStorage.getItem('playerName');

    if (snapshot.exists() && name !== oldName) {
        showToast("Ese nombre ya está en uso. Elige otro.", "error");
    } else {
        // Guardar el nombre localmente
        localStorage.setItem('playerName', name);
        registerPrompt.style.display = 'none';

        const clicks = totalClicksEl ? parseInt(totalClicksEl.innerText.replace(/,/g, ''), 10) || 0 : 0;
        const dinero = window.gameState ? window.gameState.sig : 0;
        savePlayerData(name, clicks, dinero);
        refreshPanelFromGameUI();
        btnSaveNow.innerText = "Guardado ✓";
        setTimeout(()=> btnSaveNow.innerText = "Guardar", 900);
    }
  });

  btnToggleSave.addEventListener("click", () => {
    autoSaveEnabled = !autoSaveEnabled;
    btnToggleSave.innerText = autoSaveEnabled ? "Auto-save: ON" : "Auto-save: OFF";
    btnToggleSave.classList.toggle("ghost", !autoSaveEnabled);
    if (autoSaveEnabled) startAutoSave(); else stopAutoSave();
  });

  btnRefreshRanking.addEventListener("click", () => {
    // Si quieres forzar una recarga puntual, simplemente recarga la subscripción
    loadOnceAndRender();
  });

  // Carga inicial y mecanismos
  function loadOnceAndRender() {
    if (!db) return;
    // Leer una vez y renderizar (complemento a la suscripción)
    const dbRef = ref(db);
    get(child(dbRef, 'players')).then(snapshot => {
      renderRanking(snapshot.val());
    }).catch(err => {
      console.error("loadOnce error:", err);
    });
  }

  // On start: suscribirse y arrancar auto-save
  (function initRankingModule(){
    refreshPanelFromGameUI();
    const savedName = localStorage.getItem('playerName');
    localStorage.setItem('localPlayerId', localPlayerId);
    if (savedName) {
        playerNameInput.value = savedName;
    } else {
        registerPrompt.style.display = 'block';
        playerNameInput.value = localPlayerId;
    }
    if (db) {
      loadRankingRealtime(); // escucha en tiempo real
      loadOnceAndRender();   // carga inicial
      if (autoSaveEnabled) startAutoSave();
    }
    // actualizar panel cada segundo para reflejar cambios locales en la UI del juego
    setInterval(refreshPanelFromGameUI, 1000);
    // Guardar antes de cerrar (último intento)
    window.addEventListener("beforeunload", () => {
      if (!db) return;
      const name = playerNameInput.value;
      const clicks = totalClicksEl ? parseInt(totalClicksEl.innerText.replace(/,/g, ''), 10) || 0 : 0;
      const dinero = window.gameState ? window.gameState.sig : 0;
      try { savePlayerData(name, clicks, dinero); } catch(e){}
    });
    playerNameInput.addEventListener('input', () => {
        registerPrompt.style.display = (!name || name === "Jugador") ? 'block' : 'none';
    });

    // ----- CHAT LOGIC -----
    const chatRef = ref(db, "chat");

    // Mostrar mensajes nuevos
    onChildAdded(chatRef, (snap) => {
      if (!chatLista) return;
      const data = snap.val();
      const li = document.createElement("li");
      const hora = new Date(data.hora).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
      
      const miNombre = playerNameInput.value || localPlayerId;

      let replyHtml = '';
      if (data.replyTo) {
        replyHtml = `
          <div style="background:rgba(0,0,0,0.15); padding: 4px 8px; border-radius:6px; margin-bottom:4px; font-size:11px; border-left: 2px solid #64748b;">
            <strong>${escapeHtml(data.replyTo.nombre)}</strong>
            <div style="white-space:nowrap; overflow:hidden; text-overflow:ellipsis; color: #bdc3c7;">${escapeHtml(data.replyTo.texto)}</div>
          </div>
        `;
      }

      li.innerHTML = `${replyHtml}<span><strong>${escapeHtml(data.nombre)}:</strong> ${escapeHtml(data.texto)}</span><span class="hora">${hora}</span>`;
      
      // Asignar clases de ranking
      const playerRankIndex = rankedPlayers.findIndex(p => p.name === data.nombre);
      const rankClasses = {
        0: 'rank-gold',
        1: 'rank-silver',
        2: 'rank-bronze'
      };

      if (data.nombre.toLowerCase() === 'ceo') {
        li.classList.add('rank-diamond');
      } else if (playerRankIndex !== -1 && rankClasses[playerRankIndex]) {
        li.classList.add(rankClasses[playerRankIndex]);
      } else {
        li.className = data.nombre === miNombre ? 'mio' : 'otro';
      }
      li.id = snap.key;

      // Añadir listener para responder
      li.addEventListener('click', () => {
        replyingTo = { id: snap.key, nombre: data.nombre, texto: data.texto };
        renderReplyingTo();
      });

      chatLista.appendChild(li);
      chatLista.scrollTop = chatLista.scrollHeight; // scroll automático
    });


    // Borrar mensajes viejos para mantener la base de datos limpia
    const borrarMensajeViejo = async () => {
      const snapshot = await get(chatRef);
      const total = snapshot.size;
      if (total > 50) { // Mantener los últimos 50 mensajes
        const primeroSnap = await get(query(chatRef, limitToFirst(total - 50)));
        primeroSnap.forEach((child) => remove(ref(db, "chat/" + child.key)));
      }
    };

    // Enviar mensaje
    const enviarMensaje = async () => {
      const texto = chatInput.value.trim();
      if (!texto) return;
      
      const miNombre = playerNameInput.value || localPlayerId;
      
      const messageData = {
        nombre: miNombre,
        texto: texto,
        hora: Date.now()
      };

      if (replyingTo) {
        messageData.replyTo = replyingTo;
      }

      await push(chatRef, messageData);
      chatInput.value = "";
      replyingTo = null;
      renderReplyingTo();
      borrarMensajeViejo();
    };

    function renderReplyingTo() {
        if (replyingTo) {
            replyingToContainer.innerHTML = `
                <p>Respondiendo a <strong>${escapeHtml(replyingTo.nombre)}</strong></p>
                <span>${escapeHtml(replyingTo.texto)}</span>
                <div id="cancelReply" title="Cancelar respuesta">&times;</div>
            `;
            replyingToContainer.classList.remove('hidden');
            document.getElementById('cancelReply').onclick = () => { replyingTo = null; renderReplyingTo(); };
        } else {
            replyingToContainer.innerHTML = '';
            replyingToContainer.classList.add('hidden');
        }
    }

    chatEnviarBtn.addEventListener('click', enviarMensaje);
    chatInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
            enviarMensaje();
        }
    });
  })();

</script>

    </div>

    <!-- Foso de fondo -->
    <div class="vaperWrap" id="vaperWrap" title="Haz click en cualquier parte del foso para generar ΣC" data-lang-title="foso_tooltip">
        <div id="smokeLayer"></div>
            <svg id="centralFoso" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 260" role="img" aria-label="Foso central" style="filter: drop-shadow(0 5px 15px rgba(0,0,0,0.4));">
              <rect x="20" y="20" width="60" height="220" rx="12" ry="12" fill="url(#gActive)" stroke="#0b0c2a" stroke-width="3"/>
              <rect x="20" y="0" width="60" height="20" rx="10" ry="10" fill="url(#mouthActive)"/>
<!-- Pantalla central -->
<rect x="34" y="99" width="32" height="52" rx="5" ry="5" fill="#111" stroke="#333" stroke-width="1"/>
<!-- PANTALLA CENTRAL (dentro del svg centralFoso) -->
<rect x="35" y="100" width="30" height="50" rx="4" ry="4" fill="#000" id="centralScreen"/>
<text id="batteryText" x="50" y="125" font-size="10" fill="#0f0" text-anchor="middle">0%</text>


  <!-- niveles: vamos a usar máscaras para "llenar" o simplemente cambiar color/opacity -->
  <!-- para simplicidad controlamos solo el color/opacity del path según drops -->


<!-- Texto de porcentaje -->




              <defs>
                <linearGradient id="gActive" x1="0" y1="0" x2="0" y2="1">
                  <stop offset="0%" stop-color="#f1c40f"/>
                  <stop offset="50%" stop-color="#2ecc71"/>
                  <stop offset="100%" stop-color="#1e3799"/>
                </linearGradient>
                <linearGradient id="mouthActive" x1="0" y1="0" x2="0" y2="1">
                  <stop offset="0%" stop-color="#2c2c54"/>
                  <stop offset="100%" stop-color="#000"/>
                </linearGradient>
                <linearGradient id="batteryGrad" x1="0" y1="0" x2="1" y2="0"> 
                  <stop offset="0%" stop-color="#00ff99"/>
                  <stop offset="100%" stop-color="#00a86b"/>
                </linearGradient>
              </defs>
            </svg>
        <div id="autoClickPointer"></div> 
    </div>

    <!-- Right Menu -->
    <button id="menuToggle" class="mata-btn right-menu-toggle">
        <svg class="icon" viewBox="0 0 24 24"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
        <span id="dotMenu" class="notify-dot hidden"></span>
    </button>
    <div id="rightMenu" class="right-menu">
        <button id="btnPower" class="mata-btn" style="background:#0ea5b7">
            <svg class="icon" viewBox="0 0 24 24"><path d="M12 2v8"/><path d="M5.2 5.2a9 9 0 1 0 12.7 0"/></svg>
            <span data-lang="power">Power</span>
        </button>
        <button id="btnChargeToggle" class="mata-btn" style="background:#00cfff">
            <svg class="icon" viewBox="0 0 24 24"><path d="M13 2 L4 14h6l-1 8 10-12h-7z" fill="currentColor"/></svg>
            <span id="chargeLabel" data-lang="charge">Cargar</span>
        </button>
        <button id="btnMata" class="mata-btn" style="background:#ef4444">
            <svg class="icon" viewBox="0 0 24 24"><path d="M7 7l10 10M17 7L7 17"/><circle cx="12" cy="12" r="9"/></svg>
            <span id="mataLabel" data-lang="mata_foso">Mata Foso</span>
        </button>
        <button id="btnMaintenance" class="mata-btn" style="background:#f39c12">
            <svg class="icon" viewBox="0 0 24 24"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path></svg>
            <span data-lang="maintenance">Mantenimiento</span>
        </button>
        <hr style="border-color: rgba(100, 116, 139, 0.3); width: 100%; margin: 5px 0;">
        <button id="btnShop" class="mata-btn" style="background:#facc15">
            <svg class="icon" viewBox="0 0 24 24"><path d="M3 4h2l2 10h11l2-7H6"/></svg>
            <span data-lang="shop">Tienda</span>
        </button>
        <button id="btnUpgrades" class="mata-btn" style="background:#8b5cf6">
            <svg class="icon" viewBox="0 0 24 24"><path d="M12 20V10"/><path d="M18 20V4"/><path d="M6 20v-4"/></svg>
            <span data-lang="upgrades">Mejoras</span>
        </button>
        <button id="btnRebirth" class="mata-btn" style="background:#a78bfa">
            <svg class="icon" viewBox="0 0 24 24"><path d="M3 10v4h4"/><path d="M21 14v-4h-4"/><path d="M21 10a8 8 0 0 0-13.66-5.66L7 6"/><path d="M3 14a8 8 0 0 0 13.66 5.66L17 18"/></svg>
            <span data-lang="rebirth">Rebirth</span>
        </button>
        <button id="btnPrestige" class="mata-btn hidden" style="background:linear-gradient(45deg, #f59e0b, #f39c12, #e58e26); color:black;">
            <svg class="icon" viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg>
            <span data-lang="prestige">Prestigio</span>
        </button>
        <hr style="border-color: rgba(100, 116, 139, 0.3); width: 100%; margin: 5px 0;">
        <button id="btnDaily" class="mata-btn">
            <svg class="icon" viewBox="0 0 24 24"><rect x="3" y="5" width="18" height="16" rx="2"/><path d="M16 3v4M8 3v4M3 11h18"/></svg>
            <span data-lang="daily_gift">Regalo Diario</span><span id="dotDaily" class="notify-dot hidden"></span>
        </button>
        <button id="btnWheel" class="mata-btn" style="background:#ff6b6b">
            <svg class="icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="3"/></svg>
            <span id="wheelBtnLabel" data-lang="wheel">Ruleta</span>
            <span id="dotWheel" class="notify-dot hidden"></span>
        </button>
        <button id="btnMissions" class="mata-btn" style="background:#3498db">
            <svg class="icon" viewBox="0 0 24 24"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="9 17 4 12 9 7"></polyline><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"></path><polyline points="15 7 20 12 15 17"></polyline></svg>
            <span id="missionsBtnLabel" data-lang="missions">Misiones</span><span id="dotMissions" class="notify-dot hidden"></span>
        </button>
        <button id="btnChests" class="mata-btn" style="background:#f39c12">
            <svg class="icon" viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="3" y1="9" x2="21" y2="9"></line><line x1="9" y1="21" x2="9" y2="9"></line></svg>
            <span data-lang="chests">Cofres</span><span id="dotChests" class="notify-dot hidden"></span>
        </button>
        <hr style="border-color: rgba(100, 116, 139, 0.3); width: 100%; margin: 5px 0;">
        <button id="btnAFK" class="mata-btn" style="background:#8e44ad">
            <svg class="icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="9"/><path d="M12 7v5l3 3"/></svg>
            <span data-lang="afk_upgrades">Mejoras AFK</span>
            <span id="dotAFK" class="notify-dot hidden"></span>
        </button>
        <button id="btnPets" class="mata-btn" style="background:#6366f1">
            <svg class="icon" viewBox="0 0 24 24"><path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0L12 2.69z"></path><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>
            <span data-lang="pets">Mascotas</span><span id="dotPets" class="notify-dot hidden"></span>
        </button>
        <button id="btnCrafting" class="mata-btn" style="background:#20c997">
            <svg class="icon" viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg>
            <span data-lang="crafting">Laboratorio</span>
            <span id="dotCrafting" class="notify-dot hidden"></span>
        </button>
        <button id="btnPromo" class="mata-btn" style="background:#2ecc71">
            <svg class="icon" viewBox="0 0 24 24"><path d="M21.4 11.6l-9-9a2 2 0 0 0-2.8 0l-9 9a2 2 0 0 0 0 2.8l9 9a2 2 0 0 0 2.8 0l9-9a2 2 0 0 0 0-2.8z"></path><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>
            <span data-lang="promo_code_button">Código Promocional</span>
            <span id="dotPromo" class="notify-dot hidden"></span>
        </button>
        <hr style="border-color: rgba(100, 116, 139, 0.3); width: 100%; margin: 5px 0;">
        <button id="btnAchievements" class="mata-btn" style="background:#f59e0b">
            <svg class="icon" viewBox="0 0 24 24"><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"/><path d="m9 12 2 2 4-4"/></svg>
            <span data-lang="achievements">Logros</span>
            <span id="dotAchievements" class="notify-dot hidden"></span>
        </button>
        <button id="btnConfig" class="mata-btn" style="background:#c084fc">
            <svg class="icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V22a2 2 0 1 1-4 0v-.11a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H2a2 2 0 1 1 0-4h.11a1.65 1.65 0 0 0 1.51-1 1.65 1.65 0 0 0-.33-1.82l-.06-.06A2 2 0 1 1 6.06 3.3l.06.06a1.65 1.65 0 0 0 1.82.33H8a1.65 1.65 0 0 0 1-1.51V2a2 2 0 1 1 4 0v.11a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06A2 2 0 1 1 20.7 6.06l-.06.06a1.65 1.65 0 0 0-.33 1.82V8c0 .64.39 1.22 1 1.51.35.17.73.49.73.49"/></svg>
            <span data-lang="settings">Configuración</span>
        </button>
    </div>

<!-- Modal Logros -->
<div id="achievementsModal" class="modal hidden">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-title" data-lang="achievements_title"><svg class="icon" style="width:20px; height:20px;" viewBox="0 0 24 24"><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"/><path d="m9 12 2 2 4-4"/></svg> Logros</div>
      <button class="close-btn" data-close>&times;</button>
    </div>
    <div class="modal-body" id="achievementsGrid">
      <!-- Los logros se generarán aquí -->
    </div>
  </div>
</div>

<!-- Modal Mejoras -->
<div id="upgradesModal" class="modal hidden">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-title" data-lang="upgrades_title"><svg class="icon" style="width:20px; height:20px;" viewBox="0 0 24 24"><path d="M12 20V10"/><path d="M18 20V4"/><path d="M6 20v-4"/></svg> Mejoras Permanentes</div>
      <button class="close-btn" data-close>&times;</button>
    </div>
    <div class="modal-body">
        <p class="hint" data-lang="upgrades_desc">Compra mejoras con ΣC para potenciar tus ganancias y eficiencia de forma permanente.</p>
        <div id="upgradesGrid" class="powers-grid">
            <!-- Las mejoras se generarán aquí -->
        </div>
    </div>
  </div>
</div>
<!-- Modal Rebirth -->
<div id="rebirthModal" class="modal hidden">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-title" data-lang="rebirth_title"><svg class="icon" style="width:20px; height:20px;" viewBox="0 0 24 24"><path d="M3 10v4h4"/><path d="M21 14v-4h-4"/><path d="M21 10a8 8 0 0 0-13.66-5.66L7 6"/><path d="M3 14a8 8 0 0 0 13.66 5.66L17 18"/></svg> Rebirth</div>
      <button class="close-btn" data-close>&times;</button>
    </div>
    <div class="modal-body">
      <p data-lang="rebirth_desc">Hacer un Rebirth reiniciará tu progreso (ΣC, fosos, mejoras) a cambio de una bonificación permanente en tus ganancias por clic.</p>
      <div id="rebirthInfo" style="background: var(--panel); padding: 12px; border-radius: 8px; margin: 12px 0;">
        <!-- Contenido dinámico aquí -->
      </div>
      <button id="btnConfirmRebirth" class="mata-btn" style="width: 100%; background: #a78bfa; justify-content: center;" data-lang="confirm_rebirth">
        Confirmar Rebirth
      </button>
    </div>
  </div>
</div>

<!-- Modal Crafteo -->
<div id="craftingModal" class="modal hidden">
    <div class="modal-content">
        <div class="modal-header">
            <div class="modal-title" data-lang="crafting_title"><svg class="icon" style="width:20px; height:20px;" viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg> Laboratorio de Sabores</div>
            <button class="close-btn" data-close>&times;</button>
        </div>
        <div class="modal-body">
            <p class="hint" data-lang="crafting_desc">Arrastra líquidos de tu inventario a las ranuras para combinarlos y crear sabores temporales con bonus.</p>
            
            <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 20px; margin-top: 15px;">
                <div>
                    <h4 data-lang="liquid_inventory">Inventario de Líquidos</h4>
                    <div id="liquidInventoryGrid" class="shopGrid" style="grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); max-height: 250px;">
                        <!-- Líquidos del jugador aquí -->
                    </div>
                </div>
                <div>
                    <h4 data-lang="crafting_area">Área de Crafteo</h4>
                    <div id="craftingSlots" style="display: flex; gap: 10px; justify-content: center; background: var(--bg); padding: 15px; border-radius: 8px; min-height: 100px; align-items: center;">
                        <div class="crafting-slot" data-slot="0"></div>
                        <span style="font-size: 24px;">+</span>
                        <div class="crafting-slot" data-slot="1"></div>
                    </div>
                    <button id="btnCombine" class="mata-btn" style="width: 100%; justify-content: center; margin-top: 10px;" data-lang="combine">Combinar</button>
                    <div id="activeFlavorInfo" style="margin-top: 15px; background: var(--bg); padding: 10px; border-radius: 8px;">
                        <h5 data-lang="active_flavor">Sabor Activo</h5>
                        <div id="activeFlavorDetails">
                            <p class="metaTiny" data-lang="no_active_flavor">Ninguno</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal Prestigio -->
<div id="prestigeModal" class="modal hidden">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-title" data-lang="prestige_title"><svg class="icon" style="width:20px; height:20px;" viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg> Prestigio</div>
      <button class="close-btn" data-close>&times;</button>
    </div>
    <div class="modal-body">
      <p data-lang="prestige_desc">¡Felicidades! Has llegado al final del camino... por ahora. Hacer Prestigio reiniciará tu progreso (como un Rebirth) pero te otorgará Puntos de Prestigio (PP) para desbloquear mejoras permanentes increíblemente poderosas.</p>
      <div id="prestigeInfo" style="background: var(--panel); padding: 12px; border-radius: 8px; margin: 12px 0;">
        <!-- Contenido dinámico aquí -->
      </div>
      <div id="prestigeUpgradesGrid" class="shopGrid" style="grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); max-height: 300px; margin-bottom: 15px;"></div>
      <button id="btnConfirmPrestige" class="mata-btn" style="width: 100%; background: #f59e0b; justify-content: center;" data-lang="confirm_prestige">
        Confirmar Prestigio
      </button>
    </div>
  </div>
</div>

<style>
    .liquid-item { text-align: center; cursor: grab; user-select: none; }
    .liquid-item:active { cursor: grabbing; }
    .liquid-icon { font-size: 32px; }
    .liquid-name { font-size: 12px; }
    .liquid-count { font-size: 11px; background: rgba(0,0,0,0.5); padding: 2px 4px; border-radius: 4px; }

    .crafting-slot {
        width: 60px; height: 60px; background: rgba(0,0,0,0.2); border: 2px dashed var(--muted);
        border-radius: 8px; display: flex; align-items: center; justify-content: center;
        font-size: 24px; transition: background 0.2s;
    }
    .crafting-slot.over {
        background: rgba(34, 211, 238, 0.2);
        border-color: var(--accent);
    }
</style>
<div id="shopModal" class="modal hidden">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-title" style="display:flex;align-items:center;gap:8px">
        <svg class="icon" style="width:20px; height:20px;" viewBox="0 0 24 24"><path d="M3 4h2l2 10h11l2-7H6"/></svg>
        <span data-lang="shop_title">Tienda — Fositos</span>
      </div>
      <button class="close-btn" data-close>&times;</button>
      <div id="marketStatus" class="metaTiny" style="text-align: right; padding-right: 10px;"></div>
    </div>
    <div class="modal-body">

    <!-- Aquí metemos la tienda -->
    <aside class="panel">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div style="display:flex;align-items:center;gap:8px">
          <p class="hint" data-lang="shop_hint">Clic para equipar/comprar. El foso central cambia según lo equipado.</p>
        </div>
        <div>
          <div class="metaTiny" style="text-align: right;">ΣC: <span id="shopSigma">0</span></div>
          <div class="metaTiny" style="text-align: right;">💎: <span id="shopGems">0</span></div>
        </div>
      </div>

      <div class="shopGrid" id="shopGrid">

      

 
        <div class="shopCard" data-index="0" title="Foso 1: Mango Ice 🥭❄️ (0 ΣC)">
  <div class="metaTiny" style="font-weight:800">Foso 1: Mango Ice 🥭❄️</div>
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g1_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth1_shop)"/>
    <defs>
      <linearGradient id="g1_shop" x1="0" y1="0" x2="0" y2="1">
        <stop offset="0%" stop-color="#f1c40f"/><stop offset="50%" stop-color="#2ecc71"/><stop offset="100%" stop-color="#1e3799"/>
      </linearGradient>
      <linearGradient id="mouth1_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/></linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700" data-lang="foso_0_name">Foso 1: Mango Ice 🥭❄️</div>
  <div class="priceTag" data-cost="0">0 ΣC</div>
</div>

<!-- 2 -->
<div class="shopCard" data-index="1" title="Foso 2: Strawberry Kiwi 🍓🥝 (200 ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g2_shop)" stroke="#4a0e0e" stroke-width="1.5"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth2_shop)"/>
    <rect x="35" y="110" width="30" height="20" rx="4" fill="#111"/>
    <defs>
      <linearGradient id="g2_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#ff7675"/><stop offset="100%" stop-color="#fd7e14"/></linearGradient>
      <linearGradient id="mouth2_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#444"/><stop offset="100%" stop-color="#111"/></linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700" data-lang="foso_1_name">Foso 2: Strawberry Kiwi 🍓🥝</div>
  <div class="priceTag" data-cost="200">200 ΣC</div>
</div>

<!-- 3 -->
<div class="shopCard" data-index="2" title="Foso 3: Blue Razz 🫐💙 (600 ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g3_shop)" stroke="#003a75" stroke-width="1.5"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth3_shop)"/>
    <rect x="35" y="110" width="30" height="20" rx="4" fill="#111"/>
    <defs>
      <linearGradient id="g3_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#00c6ff"/><stop offset="100%" stop-color="#0072ff"/></linearGradient>
      <linearGradient id="mouth3_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#444"/><stop offset="100%" stop-color="#111"/></linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700" data-lang="foso_2_name">Foso 3: Blue Razz 🫐💙</div>
  <div class="priceTag" data-cost="600">600 ΣC</div>
</div>

<!-- 4 -->
<div class="shopCard" data-index="3" title="Foso 4: Watermelon Ice 🍉❄️ (2 000 ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g4_shop)" stroke="#475569" stroke-width="1.5"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth4_shop)"/>
    <rect x="35" y="110" width="30" height="20" rx="4" fill="#111"/>
    <defs>
      <linearGradient id="g4_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#ecf0f1"/><stop offset="100%" stop-color="#95a5a6"/></linearGradient>
      <linearGradient id="mouth4_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#444"/><stop offset="100%" stop-color="#111"/></linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700" data-lang="foso_3_name">Foso 4: Watermelon Ice 🍉❄️</div>
  <div class="priceTag" data-cost="2000">2 000 ΣC</div>
</div>

<!-- 5 -->
<div class="shopCard" data-index="4" title="Foso 5: Pineapple Coconut 🍍🥥 (6 000 ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g5_shop)" stroke="#b38600" stroke-width="1.5"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth5_shop)"/>
    <rect x="35" y="110" width="30" height="20" rx="4" fill="#111"/>
    <defs>
      <linearGradient id="g5_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#ffd700"/><stop offset="100%" stop-color="#ffb400"/></linearGradient>
      <linearGradient id="mouth5_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#444"/><stop offset="100%" stop-color="#111"/></linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700" data-lang="foso_4_name">Foso 5: Pineapple Coconut 🍍🥥</div>
  <div class="priceTag" data-cost="6000">6 000 ΣC</div>
</div>

<!-- 6 -->
<div class="shopCard" data-index="5" title="Foso 6: Grape Ice 🍇❄️ (20 000 ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g6_shop)" stroke="#1e002b" stroke-width="1.5"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth6_shop)"/>
    <rect x="35" y="110" width="30" height="20" rx="4" fill="#111"/>
    <defs>
      <linearGradient id="g6_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#9b59b6"/><stop offset="100%" stop-color="#2c003e"/></linearGradient>
      <linearGradient id="mouth6_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#444"/><stop offset="100%" stop-color="#111"/></linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700" data-lang="foso_5_name">Foso 6: Grape Ice 🍇❄️</div>
  <div class="priceTag" data-cost="20000">20 000 ΣC</div>
</div>

<!-- 7 -->
<div class="shopCard" data-index="6" title="Foso 7: Peach Mango 🍑🥭 (60 000 ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g7_shop)" stroke="#000" stroke-width="1.5"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth7_shop)"/>
    <rect x="35" y="110" width="30" height="20" rx="4" fill="#111"/>
    <defs><linearGradient id="g7_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#ff0000"/><stop offset="100%" stop-color="#000"/></linearGradient>
    <linearGradient id="mouth7_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#444"/><stop offset="100%" stop-color="#111"/></linearGradient></defs>
  </svg>
  <div style="font-weight:700" data-lang="foso_6_name">Foso 7: Peach Mango 🍑🥭</div>
  <div class="priceTag" data-cost="60000">60 000 ΣC</div>
</div>

<!-- 8 -->
<div class="shopCard" data-index="7" title="Foso 8: Cola Ice 🥤❄️ (200 000 ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g8_shop)" stroke="#005580" stroke-width="1.5"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth8_shop)"/>
    <rect x="35" y="110" width="30" height="20" rx="4" fill="#111"/>
    <defs><linearGradient id="g8_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#ffffff"/><stop offset="100%" stop-color="#00aaff"/></linearGradient>
    <linearGradient id="mouth8_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#444"/><stop offset="100%" stop-color="#111"/></linearGradient></defs>
  </svg>
  <div style="font-weight:700" data-lang="foso_7_name">Foso 8: Cola Ice 🥤❄️</div>
  <div class="priceTag" data-cost="200000">200 000 ΣC</div>
</div>

<!-- 9 -->
<div class="shopCard" data-index="8" title="Foso 9: Lychee Rose 🌸🍒 (600 000 ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g9_shop)" stroke="#0a2e18" stroke-width="1.5"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth9_shop)"/>
    <rect x="35" y="110" width="30" height="20" rx="4" fill="#111"/>
    <defs><linearGradient id="g9_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2ecc71"/><stop offset="100%" stop-color="#145a32"/></linearGradient>
    <linearGradient id="mouth9_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#444"/><stop offset="100%" stop-color="#111"/></linearGradient></defs>
  </svg>
  <div style="font-weight:700" data-lang="foso_8_name">Foso 9: Lychee Rose 🌸🍒</div>
  <div class="priceTag" data-cost="600000">600 000 ΣC</div>
</div>

<!-- 10 -->
<div class="shopCard" data-index="9" title="Foso 10: Apple Mint 🍏🌿 (2 000 000 ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g10_shop)" stroke="#48061f" stroke-width="1.5"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth10_shop)"/>
    <rect x="35" y="110" width="30" height="20" rx="4" fill="#111"/>
    <defs><linearGradient id="g10_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#ff5733"/><stop offset="100%" stop-color="#900c3f"/></linearGradient>
    <linearGradient id="mouth10_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#444"/><stop offset="100%" stop-color="#111"/></linearGradient></defs>
  </svg>
  <div style="font-weight:700" data-lang="foso_9_name">Foso 10: Apple Mint 🍏🌿</div>
  <div class="priceTag" data-cost="2000000">2 000 000 ΣC</div>
</div>

<!-- 11 -->
<div class="shopCard" data-index="10" title="Foso 11: Banana Ice Cream 🍌🍦 (6 000 000 ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g11_shop)" stroke="#008080" stroke-width="1.5"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth11_shop)"/>
    <rect x="35" y="110" width="30" height="20" rx="4" fill="#111"/>
    <defs><linearGradient id="g11_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#39ff14"/><stop offset="100%" stop-color="#0ff"/></linearGradient>
    <linearGradient id="mouth11_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#444"/><stop offset="100%" stop-color="#111"/></linearGradient></defs>
  </svg>
  <div style="font-weight:700" data-lang="foso_10_name">Foso 11: Banana Ice Cream 🍌🍦</div>
  <div class="priceTag" data-cost="6000000">6 000 000 ΣC</div>
</div>

<!-- 12 -->
<div class="shopCard" data-index="11" title="Foso 12: Lemon Tart 🍋🥧 (20 000 000 ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g12_shop)" stroke="#400080" stroke-width="1.5"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth12_shop)"/>
    <rect x="35" y="110" width="30" height="20" rx="4" fill="#111"/>
    <defs><linearGradient id="g12_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#00f5ff"/><stop offset="50%" stop-color="#7f00ff"/><stop offset="100%" stop-color="#00ff88"/></linearGradient>
    <linearGradient id="mouth12_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#444"/><stop offset="100%" stop-color="#111"/></linearGradient></defs>
  </svg>
  <div style="font-weight:700" data-lang="foso_11_name">Foso 12: Lemon Tart 🍋🥧</div>
  <div class="priceTag" data-cost="20000000">20 000 000 ΣC</div>
</div>

<!-- 13 -->
<div class="shopCard" data-index="12" title="Foso 13: Cherry Cola 🍒🥤 (60 000 000 ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g13_shop)" stroke="#371600" stroke-width="1.5"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth13_shop)"/>
    <rect x="35" y="110" width="30" height="20" rx="4" fill="#111"/>
    <defs>
      <linearGradient id="g13_shop" x1="0" y1="0" x2="0" y2="1">
        <stop offset="0%" stop-color="#cd7f32"/><stop offset="100%" stop-color="#6e2c00"/>
      </linearGradient>
      <linearGradient id="mouth13_shop" x1="0" y1="0" x2="0" y2="1"> 
        <stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/>
      </linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700" data-lang="foso_12_name">Foso 13: Cherry Cola 🍒🥤</div>
  <div class="priceTag" data-cost="60000000">60 000 000 ΣC</div>
</div>

<!-- 14 -->
<div class="shopCard" data-index="13" title="Foso 14: Cotton Candy 🍭 (200 000 000 ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g14_shop)" stroke="#426173" stroke-width="1.5"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth14_shop)"/>
    <rect x="35" y="110" width="30" height="20" rx="4" fill="#111"/>
    <defs>
      <linearGradient id="g14_shop" x1="0" y1="0" x2="0" y2="1">
        <stop offset="0%" stop-color="#ffffff"/><stop offset="100%" stop-color="#85c1e9"/>
      </linearGradient>
      <linearGradient id="mouth14_shop" x1="0" y1="0" x2="0" y2="1"> 
        <stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/>
      </linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700" data-lang="foso_13_name">Foso 14: Cotton Candy 🍭</div>
  <div class="priceTag" data-cost="200000000">200 000 000 ΣC</div>
</div>

<!-- 15 (especial: cuerpo cambia rojo->azul->verde con animate) -->
<div class="shopCard" data-index="14" title="Foso 15: Black Diamond Reserve 💎🔥 (600 000 000 ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g15_shop)" stroke="#222" stroke-width="1.5"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth15_shop)"/>
    <rect x="35" y="110" width="30" height="20" rx="4" fill="#111"/>
    <defs>
      <linearGradient id="g15_shop" x1="0%" y1="0%" x2="0%" y2="100%">
        <stop offset="0%" stop-color="red">
          <animate attributeName="stop-color" values="red;blue;green;red" dur="3s" repeatCount="indefinite"/>
        </stop>
        <stop offset="100%" stop-color="red">
          <animate attributeName="stop-color" values="red;blue;green;red" dur="3s" repeatCount="indefinite"/>
        </stop>
      </linearGradient>
      <linearGradient id="mouth15_shop" x1="0" y1="0" x2="0" y2="1">
        <stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/>
      </linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700" data-lang="foso_14_name">Foso 15: Black Diamond Reserve 💎🔥</div>
  <div class="priceTag" data-cost="600000000">600 000 000 ΣC</div>
</div>

<!-- 16 -->
<div class="shopCard" data-index="15" title="Foso 16: Cosmic Swirl 🌌 (2B ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g16_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth16_shop)"/>
    <defs>
      <linearGradient id="g16_shop" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#434343"/><stop offset="100%" stop-color="#000000"/></linearGradient>
      <linearGradient id="mouth16_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#333"/><stop offset="100%" stop-color="#111"/></linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700" data-lang="foso_15_name">Foso 16: Cosmic Swirl 🌌</div>
  <div class="priceTag" data-cost="2000000000">2B ΣC</div>
</div>

<!-- 17 -->
<div class="shopCard" data-index="16" title="Foso 17: Golden Dragon 🐉 (6B ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg" id="foso-svg-16">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g17_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth17_shop)"/>
    <defs>
      <linearGradient id="g17_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#FFD700"/><stop offset="100%" stop-color="#B8860B"/></linearGradient>
      <linearGradient id="mouth17_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#4a2c00"/><stop offset="100%" stop-color="#000"/></linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700" data-lang="foso_16_name">Foso 17: Golden Dragon 🐉</div>
  <div class="priceTag" data-cost="6000000000">6B ΣC</div>
</div>

<!-- 18 -->
<div class="shopCard" data-index="17" title="Foso 18: Ocean Breeze 🌊 (20B ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg" id="foso-svg-17">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g18_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth18_shop)"/>
    <defs>
      <linearGradient id="g18_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#87CEEB"/><stop offset="100%" stop-color="#00BFFF"/></linearGradient>
      <linearGradient id="mouth18_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#eee"/><stop offset="100%" stop-color="#ccc"/></linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700" data-lang="foso_17_name">Foso 18: Ocean Breeze 🌊</div>
  <div class="priceTag" data-cost="20000000000">20B ΣC</div>
</div>

<!-- 19 -->
<div class="shopCard" data-index="18" title="Foso 19: Ruby Red ❤️ (60B ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg" id="foso-svg-18">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g19_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth19_shop)"/>
    <defs>
      <linearGradient id="g19_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#DC143C"/><stop offset="100%" stop-color="#8B0000"/></linearGradient>
      <linearGradient id="mouth19_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/></linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700" data-lang="foso_18_name">Foso 19: Ruby Red ❤️</div>
  <div class="priceTag" data-cost="60000000000">60B ΣC</div>
</div>

<!-- 20 -->
<div class="shopCard" data-index="19" title="Foso 20: Emerald Green 💚 (200B ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg" id="foso-svg-19">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g20_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth20_shop)"/>
    <defs>
      <linearGradient id="g20_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#32CD32"/><stop offset="100%" stop-color="#006400"/></linearGradient>
      <linearGradient id="mouth20_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/></linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700" data-lang="foso_19_name">Foso 20: Emerald Green 💚</div>
  <div class="priceTag" data-cost="200000000000">200B ΣC</div>
</div>

<!-- 21 -->
<div class="shopCard" data-index="20" title="Foso 21: Sapphire Blue 💙 (600B ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg" id="foso-svg-20">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g21_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth21_shop)"/>
    <defs>
      <linearGradient id="g21_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#4169E1"/><stop offset="100%" stop-color="#00008B"/></linearGradient>
      <linearGradient id="mouth21_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/></linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700" data-lang="foso_20_name">Foso 21: Sapphire Blue 💙</div>
  <div class="priceTag" data-cost="600000000000">600B ΣC</div>
</div>

<!-- 22 -->
<div class="shopCard" data-index="21" title="Foso 22: Amethyst Purple 💜 (2T ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg" id="foso-svg-21">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g22_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth22_shop)"/>
    <defs>
      <linearGradient id="g22_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#9370DB"/><stop offset="100%" stop-color="#4B0082"/></linearGradient>
      <linearGradient id="mouth22_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/></linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700" data-lang="foso_21_name">Foso 22: Amethyst Purple 💜</div>
  <div class="priceTag" data-cost="2000000000000">2T ΣC</div>
</div>

<!-- 23 -->
<div class="shopCard" data-index="22" title="Foso 23: Topaz Yellow 💛 (6T ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg" id="foso-svg-22">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g23_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth23_shop)"/>
    <defs>
      <linearGradient id="g23_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#FFD700"/><stop offset="100%" stop-color="#FFA500"/></linearGradient>
      <linearGradient id="mouth23_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/></linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700" data-lang="foso_22_name">Foso 23: Topaz Yellow 💛</div>
  <div class="priceTag" data-cost="6000000000000">6T ΣC</div>
</div>

<!-- 24 -->
<div class="shopCard" data-index="23" title="Foso 24: Onyx Black 🖤 (20T ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg" id="foso-svg-23">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g24_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth24_shop)"/>
    <defs>
      <linearGradient id="g24_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2F4F4F"/><stop offset="100%" stop-color="#000000"/></linearGradient>
      <linearGradient id="mouth24_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/></linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700" data-lang="foso_23_name">Foso 24: Onyx Black 🖤</div>
  <div class="priceTag" data-cost="20000000000000">20T ΣC</div>
</div>

<!-- 25 -->
<div class="shopCard" data-index="24" title="Foso 25: Pearl White 🤍 (60T ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg" id="foso-svg-24">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g25_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth25_shop)"/>
    <defs>
      <linearGradient id="g25_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#F5F5DC"/><stop offset="100%" stop-color="#D3D3D3"/></linearGradient>
      <linearGradient id="mouth25_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/></linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700" data-lang="foso_24_name">Foso 25: Pearl White 🤍</div>
  <div class="priceTag" data-cost="60000000000000">60T ΣC</div>
</div>

<!-- 26 -->
<div class="shopCard" data-index="25" title="Foso 26: Lava Flow 🌋 (200T ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg" id="foso-svg-25">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g26_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth26_shop)"/>
    <defs>
      <linearGradient id="g26_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#FF4500"/><stop offset="100%" stop-color="#FF8C00"/></linearGradient>
      <linearGradient id="mouth26_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/></linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700" data-lang="foso_25_name">Foso 26: Lava Flow 🌋</div>
  <div class="priceTag" data-cost="200000000000000">200T ΣC</div>
</div>

<!-- 27 -->
<div class="shopCard" data-index="26" title="Foso 27: Arctic Chill 🧊 (600T ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg" id="foso-svg-26">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g27_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth27_shop)"/>
    <defs>
      <linearGradient id="g27_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#ADD8E6"/><stop offset="100%" stop-color="#F0FFFF"/></linearGradient>
      <linearGradient id="mouth27_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/></linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700" data-lang="foso_26_name">Foso 27: Arctic Chill 🧊</div>
  <div class="priceTag" data-cost="600000000000000">600T ΣC</div>
</div>

<!-- 28 -->
<div class="shopCard" data-index="27" title="Foso 28: Jungle Vine 🌿 (2Qa ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg" id="foso-svg-27">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g28_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth28_shop)"/>
    <defs>
      <linearGradient id="g28_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#228B22"/><stop offset="100%" stop-color="#006400"/></linearGradient>
      <linearGradient id="mouth28_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/></linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700" data-lang="foso_27_name">Foso 28: Jungle Vine 🌿</div>
  <div class="priceTag" data-cost="2000000000000000">2Qa ΣC</div>
</div>

<!-- 29 -->
<div class="shopCard" data-index="28" title="Foso 29: Desert Mirage 🏜️ (6Qa ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg" id="foso-svg-28">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g29_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth29_shop)"/>
    <defs>
      <linearGradient id="g29_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#F4A460"/><stop offset="100%" stop-color="#D2691E"/></linearGradient>
      <linearGradient id="mouth29_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/></linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700" data-lang="foso_28_name">Foso 29: Desert Mirage 🏜️</div>
  <div class="priceTag" data-cost="6000000000000000">6Qa ΣC</div>
</div>

<!-- 30 -->
<div class="shopCard" data-index="29" title="Foso 30: Cyber Punk 🤖 (20Qa ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg" id="foso-svg-29">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g30_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth30_shop)"/>
    <defs>
      <linearGradient id="g30_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#00FFFF"/><stop offset="100%" stop-color="#FF00FF"/></linearGradient>
      <linearGradient id="mouth30_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/></linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700" data-lang="foso_29_name">Foso 30: Cyber Punk 🤖</div>
  <div class="priceTag" data-cost="20000000000000000">20Qa ΣC</div>
</div>

<!-- 31 -->
<div class="shopCard" data-index="30" title="Foso 31: Steampunk ⚙️ (60Qa ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg" id="foso-svg-30">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g31_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth31_shop)"/>
    <defs>
      <linearGradient id="g31_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#CD853F"/><stop offset="100%" stop-color="#8B4513"/></linearGradient>
      <linearGradient id="mouth31_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/></linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700" data-lang="foso_30_name">Foso 31: Steampunk ⚙️</div>
  <div class="priceTag" data-cost="60000000000000000">60Qa ΣC</div>
</div>

<!-- 32 -->
<div class="shopCard" data-index="31" title="Foso 32: Galaxy Quest 🌠 (200Qa ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg" id="foso-svg-31">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g32_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth32_shop)"/>
    <defs>
      <linearGradient id="g32_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#483D8B"/><stop offset="100%" stop-color="#000000"/></linearGradient>
      <linearGradient id="mouth32_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/></linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700" data-lang="foso_31_name">Foso 32: Galaxy Quest 🌠</div>
  <div class="priceTag" data-cost="200000000000000000">200Qa ΣC</div>
</div>

<!-- 33 -->
<div class="shopCard" data-index="32" title="Foso 33: Void 🕳️ (600Qa ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg" id="foso-svg-32">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g33_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth33_shop)"/>
    <defs>
      <linearGradient id="g33_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#1C1C1C"/><stop offset="100%" stop-color="#000000"/></linearGradient>
      <linearGradient id="mouth33_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/></linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700" data-lang="foso_32_name">Foso 33: Void 🕳️</div>
  <div class="priceTag" data-cost="600000000000000000">600Qa ΣC</div>
</div>

<!-- 34 -->
<div class="shopCard" data-index="33" title="Foso 34: Aether ✨ (2Qi ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg" id="foso-svg-33">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g34_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth34_shop)"/>
    <defs>
      <linearGradient id="g34_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#E6E6FA"/><stop offset="100%" stop-color="#FFFFFF"/></linearGradient>
      <linearGradient id="mouth34_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/></linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700" data-lang="foso_33_name">Foso 34: Aether ✨</div>
  <div class="priceTag" data-cost="2000000000000000000">2Qi ΣC</div>
</div>

<!-- 35 -->
<div class="shopCard" data-index="34" title="Foso 35: Inferno 🔥 (6Qi ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg" id="foso-svg-34">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g35_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth35_shop)"/>
    <defs>
      <linearGradient id="g35_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#FF4500"/><stop offset="100%" stop-color="#DC143C"/></linearGradient>
      <linearGradient id="mouth35_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/></linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700" data-lang="foso_34_name">Foso 35: Inferno 🔥</div>
  <div class="priceTag" data-cost="6000000000000000000">6Qi ΣC</div>
</div>

<!-- 36 -->
<div class="shopCard" data-index="35" title="Foso 36: Tsunami 🌊 (20Qi ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg" id="foso-svg-35">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g36_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth36_shop)"/>
    <defs>
      <linearGradient id="g36_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#00BFFF"/><stop offset="100%" stop-color="#191970"/></linearGradient>
      <linearGradient id="mouth36_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/></linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700" data-lang="foso_35_name">Foso 36: Tsunami 🌊</div>
  <div class="priceTag" data-cost="20000000000000000000">20Qi ΣC</div>
</div>

<!-- 37 -->
<div class="shopCard" data-index="36" title="Foso 37: Earthquake 🌍 (60Qi ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg" id="foso-svg-36">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g37_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth37_shop)"/>
    <defs>
      <linearGradient id="g37_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#A0522D"/><stop offset="100%" stop-color="#8B4513"/></linearGradient>
      <linearGradient id="mouth37_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/></linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700" data-lang="foso_36_name">Foso 37: Earthquake 🌍</div>
  <div class="priceTag" data-cost="60000000000000000000">60Qi ΣC</div>
</div>

<!-- 38 -->
<div class="shopCard" data-index="37" title="Foso 38: Hurricane 🌪️ (200Qi ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg" id="foso-svg-37">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g38_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth38_shop)"/>
    <defs>
      <linearGradient id="g38_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#778899"/><stop offset="100%" stop-color="#2F4F4F"/></linearGradient>
      <linearGradient id="mouth38_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/></linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700" data-lang="foso_37_name">Foso 38: Hurricane 🌪️</div>
  <div class="priceTag" data-cost="200000000000000000000">200Qi ΣC</div>
</div>

<!-- 39 -->
<div class="shopCard" data-index="38" title="Foso 39: Supernova 🌟 (600Qi ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg" id="foso-svg-38">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g39_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth39_shop)"/>
    <defs>
      <linearGradient id="g39_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#FFFF00"/><stop offset="100%" stop-color="#FFD700"/></linearGradient>
      <linearGradient id="mouth39_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/></linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700" data-lang="foso_38_name">Foso 39: Supernova 🌟</div>
  <div class="priceTag" data-cost="600000000000000000000">600Qi ΣC</div>
</div>

<!-- 40 -->
<div class="shopCard" data-index="39" title="Foso 40: Black Hole ⚫ (2Sx ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg" id="foso-svg-39">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g40_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth40_shop)"/>
    <defs>
      <linearGradient id="g40_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#1C1C1C"/><stop offset="100%" stop-color="#000000"/></linearGradient>
      <linearGradient id="mouth40_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/></linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700" data-lang="foso_39_name">Foso 40: Black Hole ⚫</div>
  <div class="priceTag" data-cost="2000000000000000000000">2Sx ΣC</div>
</div>

<!-- 41 -->
<div class="shopCard" data-index="40" title="Foso 41: Nebula ☁️ (6Sx ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg" id="foso-svg-40">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g41_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth41_shop)"/>
    <defs>
      <linearGradient id="g41_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#4B0082"/><stop offset="100%" stop-color="#8A2BE2"/></linearGradient>
      <linearGradient id="mouth41_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/></linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700" data-lang="foso_40_name">Foso 41: Nebula ☁️</div>
  <div class="priceTag" data-cost="6000000000000000000000">6Sx ΣC</div>
</div>

<!-- 42 -->
<div class="shopCard" data-index="41" title="Foso 42: Quasar 💫 (20Sx ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg" id="foso-svg-41">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g42_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth42_shop)"/>
    <defs>
      <linearGradient id="g42_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#00FFFF"/><stop offset="100%" stop-color="#00BFFF"/></linearGradient>
      <linearGradient id="mouth42_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/></linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700" data-lang="foso_41_name">Foso 42: Quasar 💫</div>
  <div class="priceTag" data-cost="20000000000000000000000">20Sx ΣC</div>
</div>

<!-- 43 -->
<div class="shopCard" data-index="42" title="Foso 43: Pulsar 🎇 (60Sx ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg" id="foso-svg-42">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g43_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth43_shop)"/>
    <defs>
      <linearGradient id="g43_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#FFB6C1"/><stop offset="100%" stop-color="#FF69B4"/></linearGradient>
      <linearGradient id="mouth43_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/></linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700" data-lang="foso_42_name">Foso 43: Pulsar 🎇</div>
  <div class="priceTag" data-cost="60000000000000000000000">60Sx ΣC</div>
</div>

<!-- 44 -->
<div class="shopCard" data-index="43" title="Foso 44: Magnetar 🧲 (200Sx ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg" id="foso-svg-43">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g44_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth44_shop)"/>
    <defs>
      <linearGradient id="g44_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#FF00FF"/><stop offset="100%" stop-color="#800080"/></linearGradient>
      <linearGradient id="mouth44_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/></linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700" data-lang="foso_43_name">Foso 44: Magnetar 🧲</div>
  <div class="priceTag" data-cost="200000000000000000000000">200Sx ΣC</div>
</div>

<!-- 45 -->
<div class="shopCard" data-index="44" title="Foso 45: The Singularity ✨ (600Sx ΣC)">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg" id="foso-svg-44">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g45_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth45_shop)"/>
    <defs>
      <linearGradient id="g45_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#FFFFFF"/><stop offset="100%" stop-color="#000000"/></linearGradient>
      <linearGradient id="mouth45_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2c2c54"/><stop offset="100%" stop-color="#000"/></linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700" data-lang="foso_44_name">Foso 45: The Singularity ✨</div>
  <div class="priceTag" data-cost="600000000000000000000000">600Sx ΣC</div>
</div>

<!-- Foso Pollo (Exclusivo Ruleta) -->
<div class="shopCard" data-index="45" title="Foso Pollo 🍗 (Exclusivo de la Ruleta)" style="display: none;">
  <svg viewBox="0 0 100 260" xmlns="http://www.w3.org/2000/svg" id="foso-svg-45">
    <rect x="20" y="20" width="60" height="220" rx="12" fill="url(#g46_shop)"/>
    <rect x="20" y="0" width="60" height="20" rx="10" fill="url(#mouth46_shop)"/>
    <defs>
      <linearGradient id="g46_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#ADFF2F"/><stop offset="100%" stop-color="#006400"/></linearGradient>
      <linearGradient id="mouth46_shop" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#444"/><stop offset="100%" stop-color="#111"/></linearGradient>
    </defs>
  </svg>
  <div style="font-weight:700" data-lang="foso_45_name">Foso Pollo 🍗</div>
  <div class="priceTag" data-cost="Infinity">Ruleta</div>
</div>

<!-- --- SECCION: Sabores Especiales (Consumibles) --- -->
<div style="grid-column:1/-1; font-weight:800; margin-top:10px; padding-top:8px; border-top:1px solid rgba(46, 204, 113, 0.3)" data-lang="special_flavors">
  <svg class="icon" style="width:16px; height:16px;" viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg>
  Sabores Especiales (Consumibles)
</div>

<div class="shopCard" data-flavor-id="mint_burst" title="Aumenta la probabilidad de crítico en +5% durante 2 minutos.">
  <div style="font-size: 32px;">🌿💥</div>
  <div style="font-weight:700">Ráfaga de Menta</div>
  <div class="priceTag" data-cost="500000">500K ΣC</div>
</div>
<div class="shopCard" data-flavor-id="strawberry_boost" title="Aumenta las ganancias de ΣC en +50% durante 5 minutos."><svg viewBox="0 0 24 24" style="width:32px; height:32px; fill: #e74c3c;"><path d="M12 2C8.686 2 6 4.686 6 8c0 4 6 12 6 12s6-8 6-12c0-3.314-2.686-6-6-6zm0 8c-1.105 0-2-.895-2-2s.895-2 2-2 2 .895 2 2-.895 2-2 2z"/></svg><div style="font-weight:700">Impulso de Fresa</div><div class="priceTag" data-cost="2000000">2M ΣC</div></div>
<div class="shopCard" data-flavor-id="gem_essence" title="Aumenta la probabilidad de encontrar gemas en +1% durante 10 minutos.">
  <svg viewBox="0 0 24 24" style="width:32px; height:32px; fill: #3498db;"><path d="M12 2l-2.5 5.5L4 9l4.5 4.5L7 19l5-3.5 5 3.5-1.5-5.5L20 9l-5.5-1.5z"/></svg>
  <div style="font-weight:700">Esencia de Gema</div>
  <div class="priceTag gem-price" data-cost="50">50 💎</div>
</div>
<div class="shopCard" data-flavor-id="tycoon_elixir" title="Aumenta TODAS las ganancias de ΣC en +100% durante 15 minutos.">
  <svg viewBox="0 0 24 24" style="width:32px; height:32px; fill: #f1c40f;"><path d="M5 16L3 5l5.5 5L12 3l3.5 7L21 5l-2 11H5zm14 3H5a1 1 0 0 0 0 2h14a1 1 0 0 0 0-2z"/></svg>
  <div style="font-weight:700">Elixir del Magnate</div>
  <div class="priceTag gem-price" data-cost="150">150 💎</div>
</div>

<div class="shopCard" data-flavor-id="battery_chew" title="Reduce el consumo de batería en un 50% durante 10 minutos.">
  <svg viewBox="0 0 24 24" style="width:32px; height:32px; fill: #2ecc71;"><path d="M17 4h-3V2h-4v2H7c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-5 14h-2v-6h2v6z"/></svg>
  <div style="font-weight:700">Chicle de Batería</div>
  <div class="priceTag" data-cost="10000000">10M ΣC</div>
</div>
<div class="shopCard" data-flavor-id="repair_tonic" title="Repara instantáneamente el 25% de la condición de tu foso actual.">
  <svg viewBox="0 0 24 24" style="width:32px; height:32px; fill: #95a5a6;"><path d="M22.7 19l-9.1-9.1c.9-2.3.4-5-1.5-6.9-2-2-5-2.4-7.4-1.3L9 6 6 9 1.6 4.7C.4 7.1.9 10.1 2.9 12.1c1.9 1.9 4.6 2.4 6.9 1.5l9.1 9.1c.4.4 1 .4 1.4 0l2.4-2.4c.4-.4.4-1 0-1.4z"/></svg>
  <div style="font-weight:700">Tónico de Reparación</div>
  <div class="priceTag" data-cost="25000000">25M ΣC</div>
</div>
<div class="shopCard" data-flavor-id="chest_magnet" title="Aumenta la probabilidad de encontrar cofres en +5% durante 10 minutos.">
  <svg viewBox="0 0 24 24" style="width:32px; height:32px; fill: #e67e22;"><path d="M20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-8 13H8v-2h4v2zm0-3H8v-2h4v2zm0-3H8V9h4v2zm4 6h-2v-2h2v2zm0-3h-2v-2h2v2zm0-3h-2V9h2v2z"/></svg>
  <div style="font-weight:700">Imán de Cofres</div>
  <div class="priceTag gem-price" data-cost="75">75 💎</div>
</div>
<div class="shopCard" data-flavor-id="time_potion" title="Otorga instantáneamente 1 hora de ganancias AFK.">
  <svg viewBox="0 0 24 24" style="width:32px; height:32px; fill: #8e44ad;"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm4.5 14H11v-6h2v4h1.5v2z"/></svg>
  <div style="font-weight:700">Poción del Tiempo</div>
  <div class="priceTag gem-price" data-cost="200">200 💎</div>
</div>

<!-- --- SECCION: Fosos de Gema --- -->
<div style="grid-column:1/-1; font-weight:800; margin-top:10px; padding-top:8px; border-top:1px solid rgba(245, 158, 11, 0.3)" data-lang="gem_fosos">
  <svg class="icon" style="width:16px; height:16px;" viewBox="0 0 24 24"><path fill="#f1c40f" d="M12 2l-2.5 5.5L4 9l4.5 4.5L7 19l5-3.5 5 3.5-1.5-5.5L20 9l-5.5-1.5z"/></svg>
  Fosos de Gema (+5% Ganancias c/u)
</div>

      </div>
    </aside>

    </div>
  </div>
</div>
  
    <footer>
      <div style="display:flex;gap:10px;justify-content:center;align-items:center;flex-wrap:wrap">
        <span class="metaTiny" data-lang="follow_us">Síguenos:</span>
        <a href="https://instagram.com/sigmacompanyoficial" target="_blank" rel="noopener" class="metaTiny">@sigmacompanyoficial</a>
        <span>•</span>
        <a href="https://tiktok.com/@sigmacompanyoficial" target="_blank" rel="noopener" class="metaTiny">@sigmacompanyoficial</a>
        <span>•</span>
        <a href="https://x.com/sigmacompanyoficial" target="_blank" rel="noopener" class="metaTiny">@sigmacompanyoficial</a>
        <span>•</span>
        <a href="https://facebook.com/sigmacompanyoficial" target="_blank" rel="noopener" class="metaTiny">@sigmacompanyoficial</a>
        <span>•</span>
        <a href="https://youtube.com/@sigmacompanyoficial" target="_blank" rel="noopener" class="metaTiny">@sigmacompanyoficial</a>
      </div>
      <div class="metaTiny" style="margin-top:6px" data-lang="footer_credits">Maqueta funcional — HTML/CSS/JS puro. Guardado automático en localStorage.</div>
    </footer>
  </div>
   
  <!-- Modal Poderes -->
<div id="powersModal" class="modal hidden">
  <div class="modal-content">
    <span class="close-btn">&times;</span>
    <h2 data-lang="powers">Poderes</h2>
    <div id="powersGrid" class="powers-grid"></div>
  </div>
</div>

<!-- Modal Configuración -->
<div id="configModal" class="modal hidden">
  <div class="modal-content">
    <div class="modal-header">
        <div class="modal-title" data-lang="settings_title"><svg class="icon" style="width:20px; height:20px;" viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V22a2 2 0 1 1-4 0v-.11a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H2a2 2 0 1 1 0-4h.11a1.65 1.65 0 0 0 1.51-1 1.65 1.65 0 0 0-.33-1.82l-.06-.06A2 2 0 1 1 6.06 3.3l.06.06a1.65 1.65 0 0 0 1.82.33H8a1.65 1.65 0 0 0 1-1.51V2a2 2 0 1 1 4 0v.11a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06A2 2 0 1 1 20.7 6.06l-.06.06a1.65 1.65 0 0 0-.33 1.82V8c0 .64.39 1.22 1 1.51.35.17.73.49.73.49"/></svg> Configuración</div>
        <button class="close-btn" data-close>&times;</button>
    </div>
    <div class="modal-body">
        <div class="config-grid">
            <div class="config-item">
                <label for="langSelect" data-lang="language_label">Idioma 🌐</label>
                <select id="langSelect" class="mata-btn" style="padding: 10px 16px;">
                    <option value="es">Español</option>
                    <option value="en">English</option>
                </select>
            </div>
            <div class="config-item">
                <label for="chkSmoke" data-lang="smoke_animation_label">Animación de Humo 💨</label>
                <label class="switch">
                    <input type="checkbox" id="chkSmoke" checked>
                    <span class="slider"></span>
                </label>
            </div>
            <div class="config-item">
                <label for="chkClickNumbers" data-lang="click_numbers_label">Números al Clicar ✨</label>
                <label class="switch">
                    <input type="checkbox" id="chkClickNumbers" checked>
                    <span class="slider"></span>
                </label>
            </div>
            <div class="config-item">
                <label data-lang="manual_save_label">Guardado Manual 💾</label>
                <button id="btnManualSave" class="mata-btn" data-lang="manual_save_button">Guardar Ahora</button>
            </div>
            <div class="config-item">
                <label data-lang="reset_progress_label">Borrar Progreso 💣</label>
                <button id="btnReset" class="mata-btn" style="background:#c11e3c;" data-lang="reset_progress_button">Borrar Todo</button>
            </div>
            <div class="config-item">
                <label data-lang="repeat_tutorial_label">Repetir Tutorial 🎓</label>
                <button id="btnRepeatTutorial" class="mata-btn" data-lang="repeat_tutorial_button">Reiniciar Tutorial</button>
            </div>
            <div class="config-item">
                <label for="musicVolume" data-lang="music_volume_label">Volumen de Música 🎵</label>
                <input type="range" id="musicVolume" min="0" max="1" step="0.05" class="slider-input">
            </div>
            <div class="config-item">
                <label for="sfxVolume" data-lang="sfx_volume_label">Volumen de Efectos 🔊</label>
                <input type="range" id="sfxVolume" min="0" max="1" step="0.05" class="slider-input">
            </div>
        </div>
    </div>
  </div>
</div>


<!-- Modal Recompensas Diarias -->
<div id="dailyModal" class="hidden" style="
  position: fixed; top:0; left:0; right:0; bottom:0;
  background: rgba(0,0,0,0.8); display:flex;
  align-items:center; justify-content:center;
  z-index:1000;">

  <div style="background:#111; padding:20px; border-radius:12px;
              max-width:600px; width:90%; text-align:center; color:#fff; position:relative; animation: modalIn 0.3s cubic-bezier(0.25, 1, 0.5, 1);">

    <span id="closeDaily" style="position:absolute; top:10px; right:15px; cursor:pointer; font-size:28px;">&times;</span>
    <h2 data-lang="daily_rewards_title">🎁 Recompensas Diarias</h2>

    <div id="carousel" style="display:flex; overflow-x:auto; gap:15px; padding:10px;">
      <!-- Tarjetas generadas por JS -->
    </div>

    <button id="btnClaimDaily" class="mata-btn" style="margin-top:15px;" data-lang="claim_today">
      Reclamar de hoy
    </button>
  </div>
</div>

<!-- Modal Ruleta -->
<div id="wheelModal" class="modal hidden">
    <div class="modal-content">
        <div class="modal-header">
            <div class="modal-title" data-lang="wheel_title"><svg class="icon" style="width:20px; height:20px;" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="3"/></svg> Ruleta de la Fortuna</div>
            <button class="close-btn" data-close>&times;</button>
        </div>
        <div class="modal-body" style="align-items: center; text-align: center;">
            <div class="wheel-container">
                <div class="wheel-pointer"></div>
                <div class="wheel"></div>
            </div>
            <button id="btnSpinWheel" class="mata-btn" style="margin-top: 20px; background: var(--accent);" data-lang="spin">Girar</button>
            <p id="wheelCooldownText" class="metaTiny" style="margin-top: 10px;"></p>
        </div>
    </div>
</div>

<!-- Modal Misiones -->
<div id="missionsModal" class="modal hidden">
    <div class="modal-content">
        <div class="modal-header">
            <div class="modal-title" data-lang="missions_title"><svg class="icon" style="width:20px; height:20px;" viewBox="0 0 24 24"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="9 17 4 12 9 7"></polyline><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"></path><polyline points="15 7 20 12 15 17"></polyline></svg> Misiones Diarias</div>
            <button class="close-btn" data-close>&times;</button>
        </div>
        <div class="modal-body" id="missionsGrid">
            <!-- Las misiones se generarán aquí -->
        </div>
    </div>
</div>

<!-- Modal Cofres -->
<div id="chestsModal" class="modal hidden">
    <div class="modal-content">
        <div class="modal-header">
            <div class="modal-title" data-lang="chests_title"><svg class="icon" style="width:20px; height:20px;" viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="3" y1="9" x2="21" y2="9"></line><line x1="9" y1="21" x2="9" y2="9"></line></svg> Cofres Sorpresa</div>
            <button class="close-btn" data-close>&times;</button>
        </div>
        <div class="modal-body">
            <p id="chestsInfo" class="hint" data-lang="chests_desc">¡Has encontrado cofres! Haz clic en uno para abrirlo y ver qué contiene.</p>
            <div id="chestsGrid" style="display:flex; flex-wrap:wrap; gap:15px; justify-content:center; margin-top:15px;">
                <!-- Los cofres se generarán aquí -->
            </div>
        </div>
    </div>
</div>

<!-- Modal Mantenimiento -->
<div id="maintenanceModal" class="modal hidden">
    <div class="modal-content">
        <div class="modal-header">
            <div class="modal-title" data-lang="maintenance_title"><svg class="icon" style="width:20px; height:20px;" viewBox="0 0 24 24"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path></svg> Mantenimiento de Foso</div>
            <button class="close-btn" data-close>&times;</button>
        </div>
        <div class="modal-body" style="text-align: center;">
            <p id="maintenanceInstructions" data-lang="maintenance_instructions">¡El foso necesita limpieza! Haz clic en los puntos en orden numérico para repararlo.</p>
            <div id="maintenanceGameArea">
                <!-- Puntos de mantenimiento generados por JS -->
            </div>
            <p id="maintenanceRewardText" class="metaTiny"></p>
        </div>
    </div>
</div>

<!-- Modal Mascotas -->
<div id="petsModal" class="modal hidden">
    <div class="modal-content">
        <div class="modal-header">
            <div class="modal-title" data-lang="pets_title"><svg class="icon" style="width:20px; height:20px;" viewBox="0 0 24 24"><path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0L12 2.69z"></path><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg> Tienda de Mascotas</div>
            <button class="close-btn" data-close>&times;</button>
        </div>
        <div class="modal-body">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                <p class="hint" data-lang="pets_desc">Compra mascotas con gemas para obtener bonus permanentes.</p>
                <div class="priceTag" style="background-color: #8e44ad;">💎 <span id="petsGems">0</span></div>
            </div>
            <div id="petsGrid" class="shopGrid" style="grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); max-height: 60vh;">
                <!-- Las mascotas se generarán aquí -->
            </div>
        </div>
    </div>
</div>

<!-- Modal Mercado Negro -->
<div id="blackMarketModal" class="modal hidden">
    <div class="modal-content">
        <div class="modal-header">
            <div class="modal-title" data-lang="black_market_title"><svg class="icon" style="width:20px; height:20px;" viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V22a2 2 0 1 1-4 0v-.11a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H2a2 2 0 1 1 0-4h.11a1.65 1.65 0 0 0 1.51-1 1.65 1.65 0 0 0-.33-1.82l-.06-.06A2 2 0 1 1 6.06 3.3l.06.06a1.65 1.65 0 0 0 1.82.33H8a1.65 1.65 0 0 0 1-1.51V2a2 2 0 1 1 4 0v.11a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V8c0 .64.39 1.22 1 1.51.35.17.73.49.73.49"></path></svg> Mercado Negro</div>
            <button class="close-btn" data-close>&times;</button>
        </div>
        <div class="modal-body">
            <p class="hint" data-lang="black_market_desc">Un vendedor misterioso te ofrece estos tratos... ¡Solo por tiempo limitado!</p>
            <div id="blackMarketGrid" class="shopGrid" style="grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));"></div>
        </div>
    </div>
</div>

<!-- Modal Código Promocional -->
<div id="promoModal" class="modal hidden">
    <div class="modal-content">
        <div class="modal-header">
            <div class="modal-title" data-lang="promo_code_title"><svg class="icon" style="width:20px; height:20px;" viewBox="0 0 24 24"><path d="M21.4 11.6l-9-9a2 2 0 0 0-2.8 0l-9 9a2 2 0 0 0 0 2.8l9 9a2 2 0 0 0 2.8 0l9-9a2 2 0 0 0 0-2.8z"></path><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg> Código Promocional</div>
            <button class="close-btn" data-close>&times;</button>
        </div>
        <div class="modal-body" style="text-align: center;">
            <p class="hint" data-lang="promo_code_desc">Introduce un código para recibir recompensas especiales.</p>
            <div style="display:flex; gap:8px; margin-top: 15px;">
                <input id="promoInput" type="text" placeholder="Introduce un código" data-lang-placeholder="promo_code_placeholder" style="flex:1; padding:10px; border-radius:8px; border:1px solid rgba(100, 116, 139, 0.2); background:rgba(0,0,0,0.12); color:inherit; text-align: center;">
                <button id="promoBtn" class="mata-btn" data-lang="redeem" style="justify-content: center;">
                    Canjear
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Toast Container -->
<div id="toastContainer"></div>

<!-- Modal AFK -->
<div id="afkModal" class="modal hidden">
  <div class="modal-content">
    <div class="modal-header">
        <div class="modal-title" data-lang="afk_upgrades_title"><svg class="icon" style="width:20px; height:20px;" viewBox="0 0 24 24"><circle cx="12" cy="12" r="9"/><path d="M12 7v5l3 3"/></svg> Mejoras AFK</div>
        <button class="close-btn" data-close>&times;</button>
    </div>
    <div class="modal-body" style="text-align: center;">
        <p id="afkInfo" style="margin-bottom: 15px;"></p>
        <div style="display:flex;gap:12px;justify-content:center;">
            <button id="btnUpgradeAFK" class="mata-btn" data-lang="upgrade">
                <svg class="icon" viewBox="0 0 24 24"><path d="M12 5v14m-7-7h14"/></svg>
                Mejorar
            </button>
            <button id="btnClaimAFK" class="mata-btn" style="background: var(--accent);" data-lang="claim"><svg class="icon" viewBox="0 0 24 24"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path></svg> Reclamar</button>
        </div>
    </div>
  </div>
</div>

<script>
    // Bloquear scroll y ocultar advertencia tras 3s
    document.documentElement.style.overflow = 'hidden';

  // Intro animation
  const introAnimation = document.getElementById('intro-animation');
  const introText1 = document.getElementById('intro-text1');
  const introText2 = document.getElementById('intro-text2');
  const advertencia = document.getElementById('advertencia');

  setTimeout(() => {
      introText1.classList.add('active');
  }, 500);

  setTimeout(() => {
      introText1.classList.remove('active');
  }, 2500);

  setTimeout(() => {
      introText1.style.display = 'none';
      introText2.style.display = 'flex';
      introText2.classList.add('active');
  }, 3500);

  setTimeout(() => {
      introText2.classList.remove('active');
  }, 5500);

  setTimeout(() => {
    introAnimation.style.opacity = 0; // Oculta la animación de logos
    advertencia.style.opacity = 1; // Muestra la advertencia
    setTimeout(() => introAnimation.style.display = 'none', 1000);
  }, 6500);

  setTimeout(() => {
      advertencia.style.opacity = 0;
      setTimeout(() => {
          advertencia.style.display = 'none';
          document.documentElement.style.overflow = '';
      }, 1000);
  }, 8000);


    (function() {
        const LANGUAGES = {
            es: {
                sigmacoin: "Sigmacoin",
                per_click: "Por clic",
                total_clicks: "Clicks Totales",
                ranking: "Ranking",
                streak: "Racha",
                days: "días",
                streak_hint: "Vuelve cada día para aumentar tu racha",
                foso_tooltip: "Haz click en cualquier parte del foso para generar ΣC",
                power: "Poderes",
                charge: "Cargar",
                charging: "Cargando...",
                mata_foso: "Mata Foso",
                cooldown: "Cooldown",
                shop: "Tienda",
                upgrades: "Mejoras Permanentes",
                upgrades_title: "Mejoras Permanentes",
                upgrades_desc: "Compra mejoras con ΣC para potenciar tus ganancias y eficiencia de forma permanente.",
                rebirth: "Rebirth",
                daily_gift: "Regalo Diario",
                wheel: "Ruleta",
                prestige: "Prestigio",
                prestige_title: "🌟 Prestigio",
                prestige_desc: "¡Felicidades! Has llegado al final del camino... por ahora. Hacer Prestigio reiniciará tu progreso (como un Rebirth) pero te otorgará Puntos de Prestigio (PP) para desbloquear mejoras permanentes increíblemente poderosas.",
                confirm_prestige: "Confirmar Prestigio",
                prestige_points: "Puntos de Prestigio",
                crafting: "Laboratorio",
                crafting_title: "🧪 Laboratorio de Sabores",
                crafting_desc: "Arrastra líquidos de tu inventario a las ranuras para combinarlos y crear sabores temporales con bonus.",
                liquid_inventory: "Inventario de Líquidos",
                crafting_area: "Área de Crafteo",
                combine: "Combinar",
                active_flavor: "Sabor Activo",
                no_active_flavor: "Ninguno", 
                gem_fosos: "Fosos de Gema (+5% Ganancias c/u)",
                special_flavors: "Sabores Especiales (Consumibles)",
                pets: "Mascotas",
                afk_upgrades: "Mejoras AFK",
                missions: "Misiones",
                redeem: "Canjear",
                maintenance: "Mantenimiento",
                foso_condition: "Condición del Foso",
                maintenance_title: "🔧 Mantenimiento de Foso",
                maintenance_instructions: "¡El foso necesita limpieza! Haz clic en los puntos en orden numérico para repararlo.",
                maintenance_reward: "Recompensa por mantenimiento: {amount} ΣC",
                time_left: "Tiempo restante",
                event_frenzy: "🔥 ¡Fiebre del Clic! (x5 Ganancias)",
                event_gem_rain: "💎 ¡Lluvia de Gemas! (+10% prob. de gema por clic)",
                event_free_repair: "🔧 ¡Reparación Gratuita! (Foso reparado al 100%)",
                event_combo_madness: "⚡ ¡Combo Infinito! (El combo no se reinicia)",
                event_infinite_battery: "🔋 ¡Batería Infinita! (No se gasta batería)",
                event_black_market: "🕵️ ¡Mercado Negro Abierto!",
                black_market_title: "🕵️ Mercado Negro",
                black_market_desc: "Un vendedor misterioso te ofrece estos tratos... ¡Solo por tiempo limitado!",
                promo_code_button: "Código Promocional",
                promo_code_title: "🎁 Código Promocional",
                chests_title: "🎁 Cofres Sorpresa",
                chests_desc: "¡Has encontrado cofres! Haz clic en uno para abrirlo y ver qué contiene.",
                combo_meter: "Combo x{value}",
                promo_code_placeholder: "Código promo",
                achievements: "Logros",
                settings: "Configuración", 
                achievements_title: "Logros",
                rebirth_title: "Rebirth",
                rebirth_desc: "Hacer un Rebirth reiniciará tu progreso (ΣC, fosos, mejoras) a cambio de una bonificación permanente en tus ganancias por clic.",
                confirm_rebirth: "Confirmar Rebirth", 
                shop_hint: "Tienda: clic en la miniatura para equipar/comprar.",
                shop_title: "Tienda — Fositos",
                upgrade_battery: "Capacidad Batería",
                upgrade_autoclicker: "Autoclicker",
                upgrade_critical: "Clics Críticos",
                upgrade_efficiency: "Eficiencia de Clic",
                upgrade_combo: "Combo Extendido",
                upgrade_liquid_luck: "Suerte de Líquido",
                upgrade_autorecharge: "Auto-Recarga",
                follow_us: "Síguenos:",
                footer_credits: "Maqueta funcional — HTML/CSS/JS puro. Guardado automático en localStorage.",
                settings_title: "Configuración",
                language_label: "Idioma 🌐",
                smoke_animation_label: "Animación de Humo 💨",
                click_numbers_label: "Números al Clicar ✨",
                manual_save_label: "Guardado Manual 💾",
                manual_save_button: "Guardar Ahora",
                reset_progress_label: "Borrar Progreso 💣",
                reset_progress_button: "Borrar Todo",
                daily_rewards_title: "Recompensas Diarias",
                claim_today: "Reclamar de hoy",
                afk_upgrades_title: "Mejoras AFK",
                upgrade: "Mejorar",
                claim: "💰 Reclamar",
                wheel_title: "🎡 Ruleta de la Fortuna",
                spin: "Girar",
                next_spin: "Próximo giro en:",
                missions_title: "🎯 Misiones Diarias",
                owned: "Adquirido",
                max_level: "MAX",
                tutorial_1: "¡Bienvenido a Foso Tycoon! Haz clic en el foso para ganar tus primeros Sigmacoins.",
                tutorial_2: "¡Genial! Cada clic consume un poco de batería. Puedes verla en la pantalla del foso.",
                tutorial_3: "Para recargar la batería, pulsa el botón 'Cargar'. No podrás clicar mientras se carga.",
                tutorial_4: "¡Bien hecho! Ahora, vamos a comprar un foso mejor. Abre la Tienda desde el menú lateral.",
                tutorial_5: "Ahorra 200 ΣC y haz clic en el 'Foso 2: Strawberry Kiwi' para aumentar tus ganancias.",
                tutorial_6: "¡Buena compra! En el menú también encontrarás 'Mejoras Permanentes', que son muy útiles para progresar.",
                tutorial_7: "¡Ya casi terminamos! Revisa tu 'Regalo Diario', la 'Ruleta' y las 'Misiones' para acelerar tu progreso. Están en el menú lateral.",
                tutorial_8: "¡Tutorial completado! Ahora explora todas las funciones y conviértete en un Magnate del Foso.",
                rank_0: "Novato",
                rank_1: "Aprendiz de Foso",
                rank_2: "Clickeador Casual",
                rank_3: "Maestro del Foso",
                rank_4: "Magnate del Vapor",
                rank_5: "Leyenda Sigma",
                repeat_tutorial_label: "Repetir Tutorial 🎓",
                repeat_tutorial_button: "Reiniciar Tutorial",
                music_volume_label: "Volumen de Música 🎵",
                sfx_volume_label: "Volumen de Efectos 🔊",
                next: "Siguiente",
                got_it: "¡Entendido!",
                foso_broken_toast: "¡Foso roto! Repáralo desde el menú de Mantenimiento.",
                foso_repaired_toast: "¡Foso reparado! Has ganado {amount} ΣC.",
            },
            en: {
                game_title: "Foso Tycoon",
                sigmacoin: "Sigmacoin",
                per_click: "Per Click",
                total_clicks: "Total Clicks",
                ranking: "Ranking",
                streak: "Streak",
                days: "days",
                streak_hint: "Come back every day to increase your streak",
                foso_tooltip: "Click anywhere on the foso to generate ΣC",
                power: "Power",
                charge: "Charge",
                charging: "Charging…",
                mata_foso: "Kill Foso",
                cooldown: "Cooldown",
                shop: "Shop",
                upgrades: "Permanent Upgrades",
                upgrades_title: "Permanent Upgrades",
                upgrades_desc: "Buy upgrades with ΣC to permanently boost your earnings and efficiency.",
                rebirth: "Rebirth",
                daily_gift: "Daily Gift",
                wheel: "Wheel",
                afk_upgrades: "AFK Upgrades",
                missions: "Missions",
                redeem: "Redeem",
                maintenance: "Maintenance",
                foso_condition: "Foso Condition",
                maintenance_title: "🔧 Foso Maintenance",
                maintenance_instructions: "The foso needs cleaning! Click the points in numerical order to repair it.",
                maintenance_reward: "Maintenance reward: {amount} ΣC",
                time_left: "Time left",
                event_frenzy: "🔥 Click Frenzy! (x5 Earnings)",
                event_gem_rain: "💎 Gem Rain! (+10% gem chance per click)",
                event_free_repair: "🔧 Free Repair! (Foso repaired to 100%)",
                event_combo_madness: "⚡ Infinite Combo! (Combo doesn't reset)",
                event_infinite_battery: "🔋 Infinite Battery! (No battery drain)",
                event_black_market: "🕵️ Black Market Open!",
                black_market_title: "🕵️ Black Market",
                black_market_desc: "A mysterious vendor offers you these deals... For a limited time only!",
                promo_code_button: "Promo Code",
                promo_code_title: "🎁 Promo Code",
                chests_title: "🎁 Surprise Chests",
                chests_desc: "You've found chests! Click one to open it and see what's inside.",
                combo_meter: "Combo x{value}",
                promo_code_placeholder: "Promo code",
                achievements: "Achievements",
                settings: "Settings",
                achievements_title: "🏆 Achievements",
                rebirth_title: "🔄 Rebirth",
                rebirth_desc: "Rebirthing will reset your progress (ΣC, fosos, upgrades) in exchange for a permanent bonus to your earnings per click.",
                confirm_rebirth: "Confirm Rebirth",
                shop_hint: "Shop: click on a thumbnail to equip/buy.",
                shop_title: "Shop — Fositos",
                upgrade_battery: "Battery Capacity",
                upgrade_autoclicker: "Autoclicker",
                upgrade_critical: "Critical Clicks",
                upgrade_efficiency: "Click Efficiency",
                upgrade_combo: "Combo Extension",
                upgrade_liquid_luck: "Liquid Luck",
                upgrade_autorecharge: "Auto-Recharge",
                follow_us: "Follow us:",
                footer_credits: "Functional prototype — Pure HTML/CSS/JS. Autosave to localStorage.",
                settings_title: "⚙️ Settings",
                language_label: "Language 🌐",
                smoke_animation_label: "Smoke Animation 💨",
                click_numbers_label: "Click Numbers ✨",
                manual_save_label: "Manual Save 💾",
                manual_save_button: "Save Now",
                reset_progress_label: "Reset Progress 💣",
                reset_progress_button: "Reset All",
                daily_rewards_title: "🎁 Daily Rewards",
                claim_today: "Claim Today's",
                afk_upgrades_title: "⏰ AFK Upgrades",
                upgrade: "⬆️ Upgrade",
                claim: "💰 Claim",
                wheel_title: "🎡 Wheel of Fortune",
                spin: "Spin",
                next_spin: "Next spin in:",
                missions_title: "🎯 Daily Missions",
                owned: "Owned",
                max_level: "MAX",
                tutorial_1: "Welcome to Foso Tycoon! Click the foso to earn your first Sigmacoins.",
                tutorial_2: "Great! Each click consumes a bit of battery. You can see it on the foso's screen.",
                tutorial_3: "To recharge the battery, press the 'Charge' button. You can't click while it's charging.",
                tutorial_4: "Well done! Now, let's buy a better foso. Open the Shop from the side menu.",
                tutorial_5: "Save up 200 ΣC and click on 'Foso 2: Strawberry Kiwi' to increase your earnings.",
                tutorial_6: "Good purchase! In the menu, you'll also find 'Permanent Upgrades', which are very useful for progressing.",
                tutorial_7: "We're almost done! Check your 'Daily Gift', the 'Wheel', and 'Missions' to speed up your progress. They are in the side menu.",
                tutorial_8: "Tutorial complete! Now explore all the features and become a Foso Tycoon.",
                rank_0: "Newbie",
                rank_1: "Foso Apprentice",
                rank_2: "Casual Clicker",
                rank_3: "Foso Master",
                rank_4: "Vape Tycoon",
                rank_5: "Sigma Legend",
                repeat_tutorial_label: "Repeat Tutorial 🎓",
                repeat_tutorial_button: "Restart Tutorial",
                music_volume_label: "Music Volume 🎵",
                sfx_volume_label: "SFX Volume 🔊",
                next: "Next",
                got_it: "Got it!",
                foso_broken_toast: "Foso is broken! Repair it from the Maintenance menu.",
                foso_repaired_toast: "Foso repaired! You earned {amount} ΣC.",
            }
        };

        const FOSOS = [{
            id: 1,
            name: 'Foso 1',
            cost: 0, background: 'radial-gradient(ellipse at bottom, #1b2735 0%, #090a0f 100%)',
            perClick: 1
        }, {
            id: 2,
            name: 'Foso 2',
            cost: 250, background: 'radial-gradient(ellipse at bottom, #3d0b0b 0%, #1a0505 100%)',
            perClick: 2
        }, {
            id: 3,
            name: 'Foso 3',
            cost: 1000, background: 'radial-gradient(ellipse at bottom, #002240 0%, #000c1a 100%)',
            perClick: 5
        }, {
            id: 4,
            name: 'Foso 4',
            cost: 4000, background: 'radial-gradient(ellipse at bottom, #2c3e50 0%, #0e1318 100%)',
            perClick: 15
        }, {
            id: 5,
            name: 'Foso 5',
            cost: 15000, background: 'radial-gradient(ellipse at bottom, #5d4900 0%, #292000 100%)',
            perClick: 50
        }, {
            id: 6,
            name: 'Foso 6',
            cost: 50000, background: 'radial-gradient(ellipse at bottom, #3b1f4a 0%, #180c1e 100%)',
            perClick: 100
        }, {
            id: 7,
            name: 'Foso 7: Peach Mango 🍑🥭',
            cost: 200000, background: 'radial-gradient(ellipse at bottom, #5c0000 0%, #240000 100%)',
            perClick: 150
        }, {
            id: 8,
            name: 'Foso 8',
            cost: 750000, background: 'radial-gradient(ellipse at bottom, #004d66 0%, #00202b 100%)',
            perClick: 350
        }, {
            id: 9,
            name: 'Foso 9',
            cost: 3000000, background: 'radial-gradient(ellipse at bottom, #0f3d24 0%, #06180e 100%)',
            perClick: 500
        }, {
            id: 10,
            name: 'Foso 10',
            cost: 1.2e7, background: 'radial-gradient(ellipse at bottom, #5e0828 0%, #290311 100%)',
            perClick: 1000
        }, {
            id: 11,
            name: 'Foso 11',
            cost: 5e7, background: 'radial-gradient(ellipse at bottom, #005252 0%, #002424 100%)',
            perClick: 1500
        }, {
            id: 12,
            name: 'Foso 12',
            cost: 2e8, background: 'radial-gradient(ellipse at bottom, #2a0054 0%, #110022 100%)',
            perClick: 3000
        }, {
            id: 13,
            name: 'Foso 13',
            cost: 8e8, background: 'radial-gradient(ellipse at bottom, #4a1c00 0%, #1f0c00 100%)',
            perClick: 3500
        
        }, {
            id: 14,
            name: 'Foso 14: Cotton Candy 🍭',
            cost: 3e9, background: 'radial-gradient(ellipse at bottom, #2b404d 0%, #11191f 100%)',
            perClick: 5000
        }, {
            id: 15,
            name: 'Foso 15: Black Diamond Reserve 💎🔥',
            cost: 1e10, background: 'radial-gradient(ellipse at bottom, #000 0%, #222 100%)',
            perClick: 10000
        }, {
            id: 16,
            name: 'Foso 16',
            cost: 4e10, background: 'radial-gradient(ellipse at bottom, #1a1a1a 0%, #000 100%)',
            perClick: 20000
        }, {
            id: 17,
            name: 'Foso 17',
            cost: 1.2e11, background: 'radial-gradient(ellipse at bottom, #6b4f00 0%, #332600 100%)',
            perClick: 35000
        }, {
            id: 18,
            name: 'Foso 18',
            cost: 5e11, background: 'radial-gradient(ellipse at bottom, #004d66 0%, #00202b 100%)',
            perClick: 50000
        }, {
            id: 19,
            name: 'Foso 19',
            cost: 1.8e12, background: 'radial-gradient(ellipse at bottom, #6b0b08 0%, #330504 100%)',
            perClick: 100000
        }, {
            id: 20,
            name: 'Foso 20',
            cost: 7e12, background: 'radial-gradient(ellipse at bottom, #005c30 0%, #002915 100%)',
            perClick: 125000
        }, {
            id: 21,
            name: 'Foso 21',
            cost: 2.5e13, background: 'radial-gradient(ellipse at bottom, #07285c 0%, #031129 100%)',
            perClick: 150000
        }, {
            id: 22,
            name: 'Foso 22',
            cost: 9e13, background: 'radial-gradient(ellipse at bottom, #4d3366 0%, #21152b 100%)',
            perClick: 200000
        }, {
            id: 23,
            name: 'Foso 23',
            cost: 3.5e14, background: 'radial-gradient(ellipse at bottom, #80643d 0%, #332818 100%)',
            perClick: 350000
        }, {
            id: 24,
            name: 'Foso 24',
            cost: 1.2e15, background: 'radial-gradient(ellipse at bottom, #1a1a1a 0%, #000 100%)',
            perClick: 500000
        }, {
            id: 25,
            name: 'Foso 25',
            cost: 5e15, background: 'radial-gradient(ellipse at bottom, #757575 0%, #e0e0e0 100%)',
            perClick: 750000
        }, {
            id: 26,
            name: 'Foso 26',
            cost: 1.8e16, background: 'radial-gradient(ellipse at bottom, #802700 0%, #ff4e00 100%)',
            perClick: 1000000
        }, {
            id: 27,
            name: 'Foso 27',
            cost: 7e16, background: 'radial-gradient(ellipse at bottom, #687680 0%, #cfdef3 100%)',
            perClick: 1250000
        }, {
            id: 28,
            name: 'Foso 28',
            cost: 2.5e17, background: 'radial-gradient(ellipse at bottom, #566b00 0%, #add100 100%)',
            perClick: 1500000
        }, {
            id: 29,
            name: 'Foso 29',
            cost: 9e17, background: 'radial-gradient(ellipse at bottom, #754802 0%, #ed8f03 100%)',
            perClick: 2000000
        }, {
            id: 30,
            name: 'Foso 30',
            cost: 3.5e18, background: 'radial-gradient(ellipse at bottom, #00656b 0%, #00f2ff 100%)',
            perClick: 3000000
        }, {
            id: 31,
            name: 'Foso 31',
            cost: 1.2e19, background: 'radial-gradient(ellipse at bottom, #3d2e1e 0%, #7a5c3c 100%)',
            perClick: 4000000
        }, {
            id: 32,
            name: 'Foso 32',
            cost: 5e19, background: 'radial-gradient(ellipse at bottom, #161f28 0%, #fd746c 100%)',
            perClick: 5000000
        }, {
            id: 33,
            name: 'Foso 33',
            cost: 1.8e20, background: 'radial-gradient(ellipse at bottom, #000000 0%, #222222 100%)',
            perClick: 6000000
        }, {
            id: 34,
            name: 'Foso 34',
            cost: 7e20, background: 'radial-gradient(ellipse at bottom, #606060 0%, #ffffff 100%)',
            perClick: 7000000
        }, {
            id: 35,
            name: 'Foso 35',
            cost: 2.5e21, background: 'radial-gradient(ellipse at bottom, #802136 0%, #ff4b2b 100%)',
            perClick: 8000000
        }, {
            id: 36,
            name: 'Foso 36',
            cost: 9e21, background: 'radial-gradient(ellipse at bottom, #000023 0%, #1cb5e0 100%)',
            perClick: 9000000
        }, {
            id: 37,
            name: 'Foso 37',
            cost: 3.5e22, background: 'radial-gradient(ellipse at bottom, #2d1c0b 0%, #5a3815 100%)',
            perClick: 10000000
        }, {
            id: 38,
            name: 'Foso 38',
            cost: 1.2e23, background: 'radial-gradient(ellipse at bottom, #161f28 0%, #bdc3c7 100%)',
            perClick: 12500000
        }, {
            id: 39,
            name: 'Foso 39',
            cost: 5e23, background: 'radial-gradient(ellipse at bottom, #807e00 0%, #fffc00 100%)',
            perClick: 15000000
        }, {
            id: 40,
            name: 'Foso 40',
            cost: 1.8e24, background: 'radial-gradient(ellipse at bottom, #000000 0%, #000000 100%)',
            perClick: 20000000
        }, {
            id: 41,
            name: 'Foso 41',
            cost: 7e24, background: 'radial-gradient(ellipse at bottom, #451136 0%, #da4453 100%)',
            perClick: 30000000
        }, {
            id: 42,
            name: 'Foso 42',
            cost: 2.5e25, background: 'radial-gradient(ellipse at bottom, #096a7d 0%, #12d8fa 100%)',
            perClick: 40000000
        }, {
            id: 43,
            name: 'Foso 43',
            cost: 9e25, background: 'radial-gradient(ellipse at bottom, #80545b 0%, #ffa8b6 100%)',
            perClick: 50000000
        }, {
            id: 44,
            name: 'Foso 44',
            cost: 3.5e26, background: 'radial-gradient(ellipse at bottom, #1a1a4d 0%, #ff00cc 100%)',
            perClick: 60000000
        }, {
            id: 45,
            name: 'Foso 45',
            cost: 9e26, background: 'radial-gradient(ellipse at bottom, #000000 0%, #ffffff 100%)',
            perClick: 70000000
        }, {
            id: 46,
            name: 'Foso Pollo 🍗',
            cost: Infinity,
            background: 'radial-gradient(ellipse at bottom, #228b22 0%, #006400 100%)',
            perClick: 75000000,
            exclusive: true
        }];

        const GEM_FOSOS = Array.from({ length: 30 }, (_, i) => ({
            id: i + 1,
            cost: 100 + i * (i > 15 ? 100 : 20) + (i > 25 ? 500 : 0), // Coste incremental en gemas
            bonus: 0.05 // +5% de bonus a las ganancias por cada uno
        }));

        const PRESTIGE_UPGRADES = {
            all_earnings: { name: "Ganancias Totales", icon: "💰", cost: 1, maxLevel: 20, bonus: 0.1, description: "Aumenta todas las ganancias de ΣC en un 10% por nivel." },
            afk_earnings: { name: "Ganancias AFK", icon: "⏰", cost: 1, maxLevel: 10, bonus: 0.2, description: "Aumenta las ganancias AFK en un 20% por nivel." },
            crit_chance: { name: "Prob. Crítico", icon: "💥", cost: 2, maxLevel: 10, bonus: 0.005, description: "Aumenta la probabilidad de crítico en 0.5% por nivel." },
            gem_chance: { name: "Suerte de Gema", icon: "💎", cost: 3, maxLevel: 5, bonus: 0.001, description: "Aumenta la probabilidad de encontrar gemas en 0.1% por nivel." },
        };

        const BASE_LIQUIDS = {
            'glycerin': { name: 'Glicerina', icon: '💧' },
            'strawberry': { name: 'Aroma Fresa', icon: '🍓' },
            'mint': { name: 'Aroma Menta', icon: '🌿' },
            'banana': { name: 'Aroma Plátano', icon: '🍌' },
        };

        const CRAFTING_RECIPES = [
            { ingredients: ['strawberry', 'mint'].sort(), result: { id: 'fresamint', name: 'Fosolado de Fresa', bonus: { type: 'multiplier', value: 1.25 }, duration: 300 } }, // +25% sig for 5 mins
            { ingredients: ['strawberry', 'banana'].sort(), result: { id: 'fresabanana', name: 'Batido Tropical', bonus: { type: 'multiplier', value: 1.5 }, duration: 180 } }, // +50% sig for 3 mins
            { ingredients: ['mint', 'mint'].sort(), result: { id: 'doblementa', name: 'Explosión Glacial', bonus: { type: 'crit_chance', value: 0.10 }, duration: 120 } }, // +10% crit chance for 2 mins
            { ingredients: ['banana', 'banana'].sort(), result: { id: 'potassium_power', name: 'Doble Potasio', bonus: { type: 'afk_multiplier', value: 1.5 }, duration: 600 } }, // +50% AFK earnings for 10 mins
            { ingredients: ['strawberry', 'strawberry'].sort(), result: { id: 'berry_blast', name: 'Explosión de Bayas', bonus: { type: 'chest_chance', value: 0.05 }, duration: 300 } }, // +5% chest find chance for 5 mins
            { ingredients: ['glycerin', 'glycerin'].sort(), result: { id: 'nube', name: 'Nube Densa', bonus: { type: 'no_battery_drain' }, duration: 60 } }, // No battery drain for 1 min
            { ingredients: ['glycerin', 'strawberry'].sort(), result: { id: 'sweet_cloud', name: 'Nube Dulce', bonus: { type: 'multiplier', value: 1.1 }, duration: 900 } }, // +10% sig for 15 mins
            { ingredients: ['glycerin', 'mint'].sort(), result: { id: 'cool_cloud', name: 'Nube Fresca', bonus: { type: 'crit_chance', value: 0.02 }, duration: 900 } }, // +2% crit chance for 15 mins
            { ingredients: ['glycerin', 'banana'].sort(), result: { id: 'mellow_cloud', name: 'Nube de Ensueño', bonus: { type: 'afk_multiplier', value: 1.1 }, duration: 1800 } }, // +10% AFK for 30 mins
        ];

        const SHOP_FLAVORS = {
            'mint_burst': { name: 'Ráfaga de Menta', cost: 500000, currency: 'sig', bonus: { type: 'crit_chance', value: 0.05 }, duration: 120 },
            'strawberry_boost': { name: 'Impulso de Fresa', cost: 2000000, currency: 'sig', bonus: { type: 'multiplier', value: 1.5 }, duration: 300 },
            'gem_essence': { name: 'Esencia de Gema', cost: 50, currency: 'gems', bonus: { type: 'gem_chance', value: 0.01 }, duration: 600 },
            'tycoon_elixir': { name: 'Elixir del Magnate', cost: 150, currency: 'gems', bonus: { type: 'multiplier', value: 2.0 }, duration: 900 },
            'battery_chew': { name: 'Chicle de Batería', cost: 10000000, currency: 'sig', bonus: { type: 'battery_saver', value: 0.5 }, duration: 600 }, // 50% less drain
            'repair_tonic': { name: 'Tónico de Reparación', cost: 25000000, currency: 'sig', bonus: { type: 'instant_repair', value: 25 }, duration: 0 }, // Instant effect
            'chest_magnet': { name: 'Imán de Cofres', cost: 75, currency: 'gems', bonus: { type: 'chest_chance', value: 0.05 }, duration: 600 }, // +5% chest chance
            'time_potion': { name: 'Poción del Tiempo', cost: 200, currency: 'gems', bonus: { type: 'instant_afk', value: 3600 }, duration: 0 }, // 1 hour of AFK
        };


        const REBIRTH_LEVELS = [
            { cost: 1000, requiredFosos: 3, bonus: 0.05 }, // +5%
            { cost: 50000, requiredFosos: 6, bonus: 0.10 }, // +10%
            { cost: 1e6, requiredFosos: 9, bonus: 0.15 }, // +15%
            { cost: 2.5e7, requiredFosos: 12, bonus: 0.20 },
            { cost: 5e8, requiredFosos: 15, bonus: 0.25 },
            { cost: 1e10, requiredFosos: 20, bonus: 0.30 },
            { cost: 5e11, requiredFosos: 25, bonus: 0.35 },
            { cost: 1e13, requiredFosos: 30, bonus: 0.40 },
            { cost: 5e14, requiredFosos: 35, bonus: 0.45 },
            { cost: 1e16, requiredFosos: 40, bonus: 0.50 },
        ];

        const DAILY_REWARDS = [
            { type: 'sig', value: 100, label: '100 ΣC' },
            { type: 'sig', value: 250, label: '250 ΣC' },
            { type: 'sig', value: 500, label: '500 ΣC' },
            { type: 'multiplier', value: 2, duration: 300, label: 'x2 Clics (5 min)' },
            { type: 'sig', value: 1000, label: '1000 ΣC' },
            { type: 'sig', value: 2000, label: '2000 ΣC' },
            { type: 'combo', value: { sig: 5000, multiplier: 2, duration: 600 }, label: '5000 ΣC + x2 Clics (10 min)' }
        ];

        const AUTOCLICKER_UPGRADES = [
            { cost: 500, cps: 1 },
            { cost: 2000, cps: 2 },
            { cost: 10000, cps: 5 },
            { cost: 50000, cps: 10 },
            { cost: 250000, cps: 25 },
        ];

        const BATTERY_UPGRADES = [
            { cost: 200, capacity: 120 },
            { cost: 800, capacity: 150 },
            { cost: 3000, capacity: 200 },
            { cost: 15000, capacity: 250 },
            { cost: 75000, capacity: 300 },
        ];

        const CRITICAL_UPGRADES = [
            { cost: 25000, chance: 0.01, multiplier: 10 }, // 1% chance for x10
            { cost: 100000, chance: 0.02, multiplier: 12 }, // 2% chance for x12
            { cost: 500000, chance: 0.03, multiplier: 15 }, // 3% chance for x15
            { cost: 2500000, chance: 0.04, multiplier: 20 }, // 4% chance for x20
            { cost: 10000000, chance: 0.05, multiplier: 25 }, // 5% chance for x25
        ];

        const EFFICIENCY_UPGRADES = [
            { cost: 1000, reduction: 0.05 }, // 5% less drain
            { cost: 5000, reduction: 0.10 },
            { cost: 20000, reduction: 0.15 },
            { cost: 100000, reduction: 0.20 },
            { cost: 500000, reduction: 0.25 },
        ];

        const COMBO_UPGRADES = [
            { cost: 25000, time: 500 }, // +0.5s
            { cost: 125000, time: 1000 }, // +1s
            { cost: 600000, time: 1500 }, // +1.5s
            { cost: 3000000, time: 2000 }, // +2s
        ];

        const LIQUID_LUCK_UPGRADES = [
            { cost: 100000, chance: 0.01 }, // +1%
            { cost: 500000, chance: 0.02 },
            { cost: 2500000, chance: 0.03 },
        ];

        const AUTORECHARGE_UPGRADES = [
            { cost: 75000, recharge: 0.1 },
            { cost: 300000, recharge: 0.2 },
            { cost: 1500000, recharge: 0.3 },
            { cost: 7000000, recharge: 0.4 },
            { cost: 30000000, recharge: 0.5 },
        ];

        const AFK_UPGRADES = [
            { cost: 1000, sph: 100 },
            { cost: 5000, sph: 500 },
            { cost: 25000, sph: 2500 },
            { cost: 100000, sph: 10000 },
            { cost: 500000, sph: 50000 },
        ];

        const CONFIG = {
            storageKey: 'foso_tycoon_state_v2', // Version bump for new features
            autosaveMs: 10000,
            uiTickMs: 1000,
            baseBatteryDrainPerClick: 1,
            overheatCps: 15,
            mataReward: 50,
            chestDropChance: 0.01, // 1% chance to drop a chest on click
            eventChance: 0.2, // 20% chance per check
            healthDegradationPerClick: 0.05, // How much health is lost per click
            comboTimeout: 2000, // 2 seconds to continue combo
            comboMax: 5, // Max combo multiplier
            marketUpdateInterval: 5 * 60 * 1000, // 5 minutes
            mataCooldownSec: 300,
            onEquipRefill: 20,
            rechargeBaseSec: 60,
            eventInterval: 2 * 60 * 1000, // Check for event every 2 minutes
        };
        CONFIG.overheatCps = 13; // Límite de clics por segundo

        const ACHIEVEMENTS = {
            CLICK_1: { id: 'CLICK_1', name: "Iniciado", description: "Haz 1 clic.", icon: "👆", reward: "+1% por clic (permanente)" },
            CLICK_100: { id: 'CLICK_100', name: "Clickeador", description: "Haz 100 clics.", icon: "🖱️", reward: "+2% por clic (permanente)" },
            CLICK_1K: { id: 'CLICK_1K', name: "Dedos Ágiles", description: "Haz 1,000 clics.", icon: "🤌", reward: "+3% por clic (permanente)" },
            CLICK_10K: { id: 'CLICK_10K', name: "Profesional del Clic", description: "Haz 10,000 clics.", icon: "🏆", reward: "+5% por clic (permanente)" },
            CLICK_100K: { id: 'CLICK_100K', name: "Deidad del Clic", description: "Haz 100,000 clics.", icon: "🙏", reward: "+10% por clic (permanente)" },

            SIG_1K: { id: 'SIG_1K', name: "Ahorrador", description: "Acumula 1,000 ΣC en total.", icon: "💰", reward: "Gana 500 ΣC extra" },
            SIG_10K: { id: 'SIG_10K', name: "Pequeño Inversor", description: "Acumula 10,000 ΣC en total.", icon: "💸", reward: "Gana 2,500 ΣC extra" },
            SIG_100K: { id: 'SIG_100K', name: "Pudiente", description: "Acumula 100,000 ΣC en total.", icon: "💵", reward: "Gana 5,000 ΣC extra" },
            SIG_1M: { id: 'SIG_1M', name: "Millonario", description: "Acumula 1,000,000 ΣC en total.", icon: "💎", reward: "+5% a las ganancias por clic" },
            SIG_1B: { id: 'SIG_1B', name: "Billonario", description: "Acumula 1,000,000,000 ΣC en total.", icon: "🌌", reward: "+10% a las ganancias por clic" },

            FOSO_5: { id: 'FOSO_5', name: "Coleccionista", description: "Posee 5 fosos diferentes.", icon: "📚", reward: "+10% por clic (permanente)" },
            FOSO_10: { id: 'FOSO_10', name: "Entusiasta", description: "Posee 10 fosos diferentes.", icon: "📖", reward: "+15% por clic (permanente)" },
            FOSO_15: { id: 'FOSO_15', name: "Magnate de Fosos", description: "Posee los 15 fosos.", icon: "👑", reward: "+20% por clic (permanente)" },
            FOSO_ALL: { id: 'FOSO_ALL', name: "Leyenda del Foso", description: "Posee todos los fosos de ΣC.", icon: "🏆", reward: "+50% por clic (permanente)" },

            REBIRTH_1: { id: 'REBIRTH_1', name: "Renacido", description: "Realiza tu primer Rebirth.", icon: "🔄", reward: "Bonus de Rebirth +10% extra" },
            REBIRTH_3: { id: 'REBIRTH_3', name: "Iluminado", description: "Alcanza 3 Rebirths.", icon: "✨", reward: "Bonus de Rebirth +20% extra" },
            REBIRTH_5: { id: 'REBIRTH_5', name: "Ascendido", description: "Alcanza 5 Rebirths.", icon: "🌟", reward: "Bonus de Rebirth +30% extra" },

            WHEEL_1: { id: 'WHEEL_1', name: "Afortunado", description: "Gira la ruleta por primera vez.", icon: "🍀", reward: "1 Giro Gratis" },
            WHEEL_10: { id: 'WHEEL_10', name: "Ludópata", description: "Gira la ruleta 10 veces.", icon: "🎡", reward: "Las recompensas de la ruleta son un 10% mejores" },

            MATA_1: { id: 'MATA_1', name: "Impaciente", description: "Usa Mata Foso por primera vez.", icon: "💥", reward: "Mata Foso da 100 ΣC extra" },
            MATA_10: { id: 'MATA_10', name: "Destructor", description: "Usa Mata Foso 10 veces.", icon: "💣", reward: "El cooldown de Mata Foso se reduce en 1 minuto" },

            AFK_1: { id: 'AFK_1', name: "Ingresos Pasivos", description: "Mejora el AFK al nivel 1.", icon: "💤", reward: "+5% de ganancias AFK" },
            AFK_MAX: { id: 'AFK_MAX', name: "Magnate Durmiente", description: "Lleva las mejoras de AFK al máximo.", icon: "😴", reward: "+25% de ganancias AFK" },

            MAINTAIN_1: { id: 'MAINTAIN_1', name: "Manitas", description: "Realiza un mantenimiento con éxito.", icon: "🔧", reward: "El mantenimiento da un 10% más de ΣC." },
            CRAFT_1: { id: 'CRAFT_1', name: "Alquimista", description: "Crea tu primer sabor.", icon: "🧪", reward: "Los sabores crafteados duran un 10% más." },
            EVENT_1: { id: 'EVENT_1', name: "Afortunado", description: "Participa en un evento aleatorio.", icon: "🎉", reward: "Los eventos aleatorios son un 5% más frecuentes." },
            
            CLICK_1M: { id: 'CLICK_1M', name: "Clicker Divino", description: "Haz 1,000,000 de clics.", icon: "😇", reward: "+15% por clic (permanente)" },
            SIG_1T: { id: 'SIG_1T', name: "Trillonario", description: "Acumula 1T (1,000,000,000,000) ΣC en total.", icon: "🪐", reward: "+15% a las ganancias por clic" },
            PET_OWNER: { id: 'PET_OWNER', name: "Amigo Animal", description: "Adopta tu primera mascota.", icon: "🐾", reward: "Las mascotas son un 5% más efectivas." },
            MISSION_MASTER: { id: 'MISSION_MASTER', name: "Misionero", description: "Completa 10 misiones diarias.", icon: "📜", reward: "Las recompensas de misión son un 10% mejores." },
            CHEST_HUNTER: { id: 'CHEST_HUNTER', name: "Cazatesoros", description: "Abre 5 cofres.", icon: "📦", reward: "Aumenta la probabilidad de encontrar cofres." },
        };

        const ACHIEVEMENT_LOGIC = {
            CLICK_1: { condition: s => s.totalClicks >= 1, apply: s => s.perClickMult *= 1.01 },
            CLICK_100: { condition: s => s.totalClicks >= 100, apply: s => s.perClickMult *= 1.02 },
            CLICK_1K: { condition: s => s.totalClicks >= 1000, apply: s => s.perClickMult *= 1.03 },
            CLICK_10K: { condition: s => s.totalClicks >= 10000, apply: s => s.perClickMult *= 1.05 },
            CLICK_100K: { condition: s => s.totalClicks >= 100000, apply: s => s.perClickMult *= 1.10 },
            SIG_1K: { condition: s => s.totalSigEarned >= 1000, apply: s => { s.sig += 500; showToast("+500 ΣC!", "success"); } },SIG_10K: { condition: s => s.totalSigEarned >= 10000, apply: s => { s.sig += 2500; showToast("+2,500 ΣC!", "success"); } },
            SIG_100K: { condition: s => s.totalSigEarned >= 100000, apply: s => s.sig += 5000 },
            SIG_1M: { condition: s => s.totalSigEarned >= 1000000, apply: s => s.perClickMult *= 1.05 },
            SIG_1B: { condition: s => s.totalSigEarned >= 1000000000, apply: s => s.perClickMult *= 1.10 },
            FOSO_5: { condition: s => s.fososOwned.length >= 5, apply: s => s.perClickMult *= 1.10 },
            FOSO_10: { condition: s => s.fososOwned.length >= 10, apply: s => s.perClickMult *= 1.15 },
            FOSO_15: { condition: s => s.fososOwned.length >= 15, apply: s => s.perClickMult *= 1.20 },
            FOSO_ALL: { condition: s => s.fososOwned.length >= FOSOS.length, apply: s => s.perClickMult *= 1.50 },
            REBIRTH_1: { condition: s => s.rebirths >= 1, apply: s => s.rebirthBonus += 0.1 },
            REBIRTH_3: { condition: s => s.rebirths >= 3, apply: s => s.rebirthBonus += 0.2 },
            REBIRTH_5: { condition: s => s.rebirths >= 5, apply: s => s.rebirthBonus += 0.3 },
            WHEEL_1: { condition: s => s.wheelSpins >= 1, apply: s => s.wheelLastSpin = 0 },
            WHEEL_10: { condition: s => s.wheelSpins >= 10, apply: s => s.wheelRewardMultiplier = 1.1 },
            MATA_1: { condition: s => s.mataUses >= 1, apply: s => CONFIG.mataReward += 100 },
            MATA_10: { condition: s => s.mataUses >= 10, apply: s => CONFIG.mataCooldownSec -= 60 },
            AFK_1: { condition: s => (s.upgradeLevels.afk || 0) >= 1, apply: s => s.afkMultiplier = 1.05 },
            AFK_MAX: { condition: s => (s.upgradeLevels.afk || 0) >= AFK_UPGRADES.length, apply: s => s.afkMultiplier = 1.25 },
            MAINTAIN_1: { condition: s => (s.maintenancesDone || 0) >= 1, apply: s => s.maintenanceRewardBonus = 1.1 },
            CRAFT_1: { condition: s => (s.craftsDone || 0) >= 1, apply: s => s.craftedFlavorDurationBonus = 1.1 },
            EVENT_1: { condition: s => (s.eventsParticipated || 0) >= 1, apply: s => CONFIG.eventChance *= 1.05 },
            CLICK_1M: { condition: s => s.totalClicks >= 1000000, apply: s => s.perClickMult *= 1.15 },
            SIG_1T: { condition: s => s.totalSigEarned >= 1e12, apply: s => s.perClickMult *= 1.15 },
            PET_OWNER: { condition: s => s.unlockedPets.length > 0, apply: s => s.petBonusMultiplier = 1.05 },
            MISSION_MASTER: { condition: s => (s.missionsCompleted || 0) >= 10, apply: s => s.missionRewardBonus = 1.1 },
            CHEST_HUNTER: { condition: s => (s.chestsOpened || 0) >= 5, apply: s => CONFIG.chestDropChance *= 1.2 },
        };

        const MISSION_TYPES = [
            { id: 'click', description: (target) => `Haz ${target} clics.`, reward: (target) => target * 10, unit: 'clics' },
            { id: 'earn', description: (target) => `Gana ${formatNum(target)} ΣC.`, reward: (target) => target / 2, unit: 'ΣC' },
            { id: 'spin', description: (target) => `Gira la ruleta ${target} veces.`, reward: (target) => target * 5000, unit: 'giros' },
            { id: 'buy_foso', description: (target) => `Compra ${target} fosos.`, reward: (target) => target * 10000, unit: 'fosos' },
        ];

        const WHEEL_REWARDS = [
            { label: "1K ΣC", reward: (s) => { const amount = 1000 * (s.wheelRewardMultiplier || 1); s.sig += amount; showToast(`+${formatNum(amount)} ΣC!`, "success"); } },
            { label: "5K ΣC", reward: (s) => { const amount = 5000 * (s.wheelRewardMultiplier || 1); s.sig += amount; showToast(`+${formatNum(amount)} ΣC!`, "success"); } },
            { label: "x2 Clics (1min)", reward: (s) => {
                s.perClickMult *= 2;
                showToast("x2 Clics por 1 minuto!", "success");
                setTimeout(() => {
                    s.perClickMult /= 2;
                    showToast("x2 Clics ha terminado.", "info");
                }, 60000);
            }},
            { label: "Batería Max", reward: (s) => { s.battery = s.maxBattery; showToast("Batería Recargada!", "success"); } },
            { label: "10K ΣC", reward: (s) => { const amount = 10000 * (s.wheelRewardMultiplier || 1); s.sig += amount; showToast(`+${formatNum(amount)} ΣC!`, "success"); } },
            { label: "Nada", reward: (s) => { showToast("¡Más suerte la próxima vez!", "info"); } },
            { label: "25K ΣC", reward: (s) => { const amount = 25000 * (s.wheelRewardMultiplier || 1); s.sig += amount; showToast(`+${formatNum(amount)} ΣC!`, "success"); } },
            { label: "x3 Clics (30s)", reward: (s) => {
                s.perClickMult *= 3;
                showToast("x3 Clics por 30 segundos!", "success");
                setTimeout(() => {
                    s.perClickMult /= 3;
                    showToast("x3 Clics ha terminado.", "info");
                }, 30000);
            }},
            { label: "Foso Pollo 🍗", reward: (s) => {
                const fosoIndex = 45; // El índice del Foso Pollo
                if (s.fososOwned.includes(fosoIndex)) {
                    const consolationPrize = 100000;
                    s.sig += consolationPrize;
                    // Mostrar el foso pollo en la tienda si ya se tiene
                    const fosoPolloCard = document.querySelector('.shopCard[data-index="45"]');
                    if (fosoPolloCard) {
                        fosoPolloCard.style.display = 'flex';
                    }
                    showToast(`Ya tienes el Foso Pollo. ¡Toma ${formatNum(consolationPrize)} ΣC en su lugar!`, "info");
                } else {
                    s.fososOwned.push(fosoIndex);
                    showToast("¡Has ganado el exclusivo Foso Pollo 🍗!", "success", 5000);
                }
            }},
        ];

        const RANKS = [
            { clicks: 0, key: 'rank_0' },
            { clicks: 100, key: 'rank_1' },
            { clicks: 1000, key: 'rank_2' },
            { clicks: 10000, key: 'rank_3' },
            { clicks: 100000, key: 'rank_4' },
            { clicks: 1000000, key: 'rank_5' },
        ];

        const RANDOM_EVENTS = [
            { id: 'frenzy', name_key: 'event_frenzy', duration: 30000 },
            { id: 'infinite_battery', name_key: 'event_infinite_battery', duration: 45000 },
            { id: 'black_market', name_key: 'event_black_market', duration: 60000, onStart: () => openBlackMarket(), onEnd: () => blackMarketModal.classList.add('hidden') },
            { id: 'gem_rain', name_key: 'event_gem_rain', duration: 20000 },
            { id: 'free_repair', name_key: 'event_free_repair', duration: 1000, onStart: (s) => { s.fosoConditions[s.activeFosoIndex] = 100; showToast(LANGUAGES[s.lang || 'es']['event_free_repair'], 'success'); } },
            { id: 'combo_madness', name_key: 'event_combo_madness', duration: 30000 },
        ];

        const PETS = {
            dog: {
                id: 'dog', name: 'Perro Leal', description: 'Multiplica las ganancias por clic x2.',
                cost: 5000, multiplier: 2, icon: '🐶'
            },
            cat: {
                id: 'cat', name: 'Gato Cósmico', description: 'Multiplica las ganancias por clic x3.',
                cost: 25000, multiplier: 3, icon: '🐱'
            }
        };


        let state = {
            sig: 0,
            totalClicks: 0,
            totalSigEarned: 0,
            activeFosoIndex: 0,
            fososOwned: [0],
            gemFososOwned: [],
            fosoConditions: {},
            achievements: {},
            gems: 0,
            unlockedPets: [],
            equippedPet: null,
            chests: [],
            wheelLastSpin: 0,
            dailyMissions: [],
            lastMissionCheck: 0,
            wheelSpins: 0,
            mataUses: 0,
            wheelRewardMultiplier: 1,
            afkMultiplier: 1,
            battery: 100,
            maxBattery: 100,
            burned: false,
            powerOn: true,
            mataCooldownUntil: 0,
            autoClickerLevel: 0,
            autoClickExpiresAt: 0,
            dailyDay: 0,
            rebirths: 0,
            rebirthBonus: 0, // Bonificación porcentual aditiva, 0.05 = +5%
            prestigeLevel: 0,
            prestigePoints: 0,
            prestigeUpgrades: {},
            liquidInventory: {},
            activeCraftedFlavor: null,
            liquidDropChance: 0.02, // 2% chance to drop a liquid on click
            lastDailyClaim: null,
            afkLevel: 0,
            afkLastClaim: Date.now(),
            afkEarnings: 0,
            lang: 'es',
            powersOwned: {},
            overheatBonus: 0,
            batteryEfficiencyLevel: 0,
            rechargeSpeedLevel: 0,
            perClickMult: 1,
            passivePerSec: 0,
            tutorialCompleted: true,
            tutorialStep: 0,
            upgradeLevels: {
                battery: 0,
                autoclicker: 0,
                afk: 0,
                critical: 0,
                combo: 0,
                liquid_luck: 0,
                autorecharge: 0,
            },
            extraClicks: 0,
            combo: {
                count: 0,
                expires: 0,
            },
            market: {
                nextUpdate: 0,
                priceMultipliers: {}
            },
            activeEvent: null,
            blackMarketOffers: [],
            lastEventCheck: 0,
            maintenancesDone: 0,
            craftsDone: 0,
            eventsParticipated: 0,
            petBonusMultiplier: 1,
            missionsCompleted: 0,
            chestsOpened: 0,
            settings: { smokeEnabled: true, clickNumbersEnabled: true, musicVolume: 0.2, sfxVolume: 0.5 },
        };


        // Audio elements
        let bgMusic, clickSfx, buySfx, successSfx, errorSfx, chestOpenSfx;
        let musicStarted = false;

        // DOM refs
        const sigTotalEl = document.getElementById('sigTotal');
        const perClickEl = document.getElementById('perClick');
        const totalClicksEl = document.getElementById('totalClicks');
        const shopSigma = document.getElementById('shopSigma');
        const rankTitleEl = document.getElementById('rankTitle');
        const shopGems = document.getElementById('shopGems');
        const btnMata = document.getElementById('btnMata');
        const mataLabel = document.getElementById('mataLabel');
        const centralFoso = document.getElementById('centralFoso');
        const vaperWrap = document.getElementById('vaperWrap');
        const btnChargeToggle = document.getElementById('btnChargeToggle');
        const chargeLabel = document.getElementById('chargeLabel');
        const batteryText = document.getElementById('batteryText');
        const shopGrid = document.getElementById('shopGrid');
        const btnShop = document.getElementById('btnShop');
        const shopModal = document.getElementById('shopModal');
        const rebirthModal = document.getElementById('rebirthModal');
        const btnRebirth = document.getElementById("btnRebirth");
        const btnUpgrades = document.getElementById("btnUpgrades");
        const upgradesModal = document.getElementById("upgradesModal");
        const dotMenu = document.getElementById('dotMenu');
        const menuToggle = document.getElementById('menuToggle');
        const rightMenu = document.getElementById('rightMenu');
        const btnPrestige = document.getElementById("btnPrestige");
        const prestigeModal = document.getElementById("prestigeModal");
        const btnCrafting = document.getElementById("btnCrafting"); // No hay modal para esto
        const btnPromo = document.getElementById("btnPromo");
        const promoModal = document.getElementById("promoModal");
        const craftingModal = document.getElementById("craftingModal"); // No hay modal para esto
        const btnConfig = document.getElementById('btnConfig');
        const configModal = document.getElementById('configModal');
        const langSelect = document.getElementById('langSelect');
        const chkSmoke = document.getElementById('chkSmoke');
        const chkClickNumbers = document.getElementById('chkClickNumbers');
        const btnManualSave = document.getElementById('btnManualSave');
        const btnRepeatTutorial = document.getElementById('btnRepeatTutorial');
        const btnReset = document.getElementById('btnReset');
        const centralScreen = document.getElementById('centralScreen');
        const dailyStreakEl = document.getElementById('dailyStreak');
        const streakHint = document.getElementById('streakHint');
        const btnDaily = document.getElementById('btnDaily');
        const dailyModal = document.getElementById('dailyModal');
        const closeDaily = document.getElementById('closeDaily');
        const btnClaimDaily = document.getElementById('btnClaimDaily');
        const dailyCarousel = document.getElementById('carousel');
        const dotDaily = document.getElementById('dotDaily');
        const btnPowers = document.getElementById('btnPower');
        const btnAFK = document.getElementById('btnAFK');
        const afkModal = document.getElementById('afkModal');
        const btnUpgradeAFK = document.getElementById('btnUpgradeAFK');
        const btnClaimAFK = document.getElementById('btnClaimAFK');
        const afkInfo = document.getElementById('afkInfo');
        const dotAFK = document.getElementById('dotAFK');
        const btnPower = document.getElementById('btnPower');
        const btnAchievements = document.getElementById('btnAchievements');
        const achievementsModal = document.getElementById('achievementsModal');
        const achievementsGrid = document.getElementById('achievementsGrid');
        const dotAchievements = document.getElementById('dotAchievements');
        const btnWheel = document.getElementById('btnWheel');
        const wheelModal = document.getElementById('wheelModal');
        const wheel = document.querySelector('.wheel');
        const btnSpinWheel = document.getElementById('btnSpinWheel');
        const wheelCooldownText = document.getElementById('wheelCooldownText');
        const wheelBtnLabel = document.getElementById('wheelBtnLabel');
        const dotWheel = document.getElementById('dotWheel');
        const btnMissions = document.getElementById('btnMissions');
        const missionsModal = document.getElementById('missionsModal');
        const missionsGrid = document.getElementById('missionsGrid');
        const dotMissions = document.getElementById('dotMissions');
        const btnChests = document.getElementById('btnChests');
        const chestsModal = document.getElementById('chestsModal');
        const btnCustomize = document.getElementById('btnCustomize');
        const customizeModal = document.getElementById('customizeModal');
        const dotCustomize = document.getElementById('dotCustomize');
        const dotChests = document.getElementById('dotChests');
        const comboContainer = document.getElementById('comboContainer');
        const comboText = document.getElementById('comboText');
        const comboBar = document.getElementById('comboBar');
        const marketStatusEl = document.getElementById('marketStatus');
        const maintenanceBarFill = document.getElementById('maintenanceBarFill');
        const btnMaintenance = document.getElementById('btnMaintenance');
        const maintenanceModal = document.getElementById('maintenanceModal');
        const maintenanceGameArea = document.getElementById('maintenanceGameArea');
        const maintenanceInstructions = document.getElementById('maintenanceInstructions');
        const maintenanceRewardText = document.getElementById('maintenanceRewardText');
        const gemsTotalEl = document.getElementById('gemsTotal');
        const eventBanner = document.getElementById('eventBanner');
        const eventName = document.getElementById('eventName');
        const eventTimer = document.getElementById('eventTimer');
        const blackMarketModal = document.getElementById('blackMarketModal');
        const promoInput = document.getElementById('promoInput');
        const blackMarketGrid = document.getElementById('blackMarketGrid');
        const musicVolumeSlider = document.getElementById('musicVolume');
        const sfxVolumeSlider = document.getElementById('sfxVolume');

        let powersModal = document.getElementById('powersModal');
        let isCharging = false;
        let anyNotification = false;
        let chargeInterval = null;
        let autoClickTimer = null;
        let canClaimDaily = false;
        let nextRewardInterval = null;
        let comboDecayTimer = null;
        let marketUpdateInterval = null;
        let wheelSpinning = false;
        let maintenanceSequence = [];
        let eventInterval = null;
        let currentMaintenanceStep = 0;
        let tutorialHighlights = [];

        const tutorialHighlight = document.getElementById('tutorialHighlight');
        const tutorialTooltip = document.getElementById('tutorialTooltip');
        const tutorialText = document.getElementById('tutorialText');
        const tutorialSkipBtn = document.getElementById('tutorialSkipBtn');
        const tutorialNextBtn = document.getElementById('tutorialNextBtn');

        function updateMenuNotification() {
            anyNotification = !dotDaily.classList.contains('hidden') || !dotMissions.classList.contains('hidden') || !dotChests.classList.contains('hidden') || !dotAFK.classList.contains('hidden') || !dotPets.classList.contains('hidden');
            dotMenu.classList.toggle('hidden', !anyNotification);
        }

        function translateUI() {
            const lang = state.lang || 'es';
            const translations = LANGUAGES[lang];
            if (!translations) return;

            document.querySelectorAll('[data-lang]').forEach(el => {
                const key = el.dataset.lang;
                if (translations[key]) {
                    el.textContent = translations[key];
                }
            });

            document.querySelectorAll('[data-lang-placeholder]').forEach(el => {
                const key = el.dataset.langPlaceholder;
                if (translations[key]) {
                    el.placeholder = translations[key];
                }
            });

        }

        function generateDailyMissions() {
            state.dailyMissions = [];
            const availableMissions = [...MISSION_TYPES];
            for (let i = 0; i < 3; i++) {
                if (availableMissions.length === 0) break;

                const missionIndex = Math.floor(Math.random() * availableMissions.length);
                const missionType = availableMissions.splice(missionIndex, 1)[0];
                
                let target;
                if (missionType.id === 'click') target = 100 + Math.floor(Math.random() * 900); // 100-1000
                else if (missionType.id === 'earn') target = 1000 + Math.floor(Math.random() * 9000); // 1000-10000
                else if (missionType.id === 'spin') target = 1 + Math.floor(Math.random() * 2); // 1-3
                else if (missionType.id === 'buy_foso') target = 1 + Math.floor(Math.random() * 2); // 1-3

                state.dailyMissions.push({
                    id: missionType.id,
                    description: missionType.description(target),
                    target: target,
                    progress: 0,
                    reward: missionType.reward(target),
                    claimed: false
                });
            }
            state.lastMissionCheck = new Date().setHours(0, 0, 0, 0);
        }

        function checkMissionReset() {
            const today = new Date().setHours(0, 0, 0, 0);
            if (!state.lastMissionCheck || state.lastMissionCheck < today) {
                generateDailyMissions();
            }
        }

        function renderMissions() {
            missionsGrid.innerHTML = '';
            let canClaim = false;
            state.dailyMissions.forEach((mission, index) => {
                const card = document.createElement('div');
                card.className = 'mission-card';
                const progressPercent = Math.min(100, (mission.progress / mission.target) * 100);

                card.innerHTML = `
                    <div class="mission-info">
                        <h4>${mission.description}</h4>
                        <div class="mission-progress-bar">
                            <div class="mission-progress-fill" style="width: ${progressPercent}%;"></div>
                        </div>
                        <p class="metaTiny">Progreso: ${mission.progress} / ${mission.target}</p>
                        <p class="metaTiny">Recompensa: ${formatNum(mission.reward)} ΣC</p>
                    </div>
                    <button class="mata-btn claim-mission-btn" data-lang="${mission.claimed ? 'claimed' : 'claim'}" data-index="${index}" ${mission.progress < mission.target || mission.claimed ? 'disabled' : ''}>
                        ${mission.claimed ? 'Reclamado' : 'Reclamar'}
                    </button>
                `;
                missionsGrid.appendChild(card);

                if (progressPercent >= 100 && !mission.claimed) {
                    canClaim = true;
                }
            });

            dotMissions.classList.toggle('hidden', !canClaim);
            updateMenuNotification();
            document.querySelectorAll('.claim-mission-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const missionIndex = e.target.dataset.index;
                    const mission = state.dailyMissions[missionIndex];
                    if (mission && mission.progress >= mission.target && !mission.claimed) {
                        state.sig += mission.reward;
                        if (state.missionRewardBonus) {
                            state.sig += mission.reward * (state.missionRewardBonus - 1);
                        }
                        state.missionsCompleted = (state.missionsCompleted || 0) + 1;
                        state.totalSigEarned += mission.reward;
                        mission.claimed = true;
                        showToast(`+${formatNum(mission.reward)} ΣC! Misión completada!`, 'success');
                        saveState();
                        renderMissions();
                    }
                });
            });
        }

        function updateMissionProgress(missionId, value) {
            if (!state.dailyMissions) return;
            state.dailyMissions.forEach(mission => {
                if (mission.id === missionId && !mission.claimed) {
                    mission.progress += value;
                }
            });
        }

        function checkWheelCooldown() {
            const now = Date.now();
            const cooldown = 20 * 60 * 1000; // 20 minutes
            const timeSinceSpin = now - state.wheelLastSpin;

            if (timeSinceSpin >= cooldown) {
                if(wheelBtnLabel.dataset.lang) wheelBtnLabel.textContent = LANGUAGES[state.lang]['wheel'];
                dotWheel.classList.remove('hidden');
                if(wheelCooldownText) wheelCooldownText.textContent = LANGUAGES[state.lang]['spin'];
                if(btnSpinWheel) btnSpinWheel.disabled = wheelSpinning; updateMenuNotification();
            } else {
                const remaining = cooldown - timeSinceSpin;
                const minutes = Math.floor(remaining / 60000);
                const seconds = Math.floor((remaining % 60000) / 1000);
                const timeStr = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
                wheelBtnLabel.textContent = `${LANGUAGES[state.lang || 'es']['wheel']} (${timeStr})`;
                dotWheel.classList.add('hidden');
                if(wheelCooldownText) wheelCooldownText.textContent = `${LANGUAGES[state.lang]['next_spin']} ${timeStr}`; updateMenuNotification();
                if(btnSpinWheel) btnSpinWheel.disabled = true;
            }
        }

        function spinWheel() {
            if (wheelSpinning) return;

            const now = Date.now();
            const cooldown = 20 * 60 * 1000;
            if (now - state.wheelLastSpin < cooldown) {
                showToast("La ruleta aún está en cooldown.", "info");
                return;
            }

            wheelSpinning = true;
            btnSpinWheel.disabled = true;

            const segmentCount = WHEEL_REWARDS.length;
            const segmentAngle = 360 / segmentCount;
            const randomSegment = Math.floor(Math.random() * segmentCount);
            
            const spinAngle = (360 * 5) - (randomSegment * segmentAngle) - (segmentAngle / 2);

            wheel.style.transition = 'transform 5s cubic-bezier(0.2, 0.8, 0.2, 1)';
            wheel.style.transform = `rotate(${spinAngle}deg)`;

            setTimeout(() => {
                const selectedReward = WHEEL_REWARDS[randomSegment];
                selectedReward.reward(state);
                updateMissionProgress('spin', 1);
                state.wheelSpins = (state.wheelSpins || 0) + 1;
                state.wheelLastSpin = Date.now();
                wheelSpinning = false;
                checkWheelCooldown();
                saveState();
                checkAchievements();
                render();
                
            }, 5000); // Match CSS transition time
        }

        function renderWheel() {
            const wheelEl = document.querySelector('.wheel');
            wheelEl.innerHTML = '';
            const colors = ['#ff6b6b', '#f06595', '#cc5de8', '#845ef7', '#5c7cfa', '#339af0', '#22b8cf', '#20c997'];
            const segmentAngle = 45;

            WHEEL_REWARDS.forEach((reward, i) => {
                const segment = document.createElement('li');
                segment.className = 'segment';
                segment.style.transform = `rotate(${i * segmentAngle}deg) skewY(-45deg)`;

                const text = document.createElement('div');
                text.className = 'text';
                text.textContent = reward.label;
                text.style.setProperty('--color', colors[i % colors.length]);
                
                segment.appendChild(text);
                wheelEl.appendChild(segment);
            });
        }

        function checkAchievements() {
            let newAchievementUnlocked = false;
            for (const id in ACHIEVEMENT_LOGIC) {
                if (!state.achievements[id]) {
                    const logic = ACHIEVEMENT_LOGIC[id];
                    if (logic.condition(state)) {
                        state.achievements[id] = true;
                        logic.apply(state);
                        const achievementName = ACHIEVEMENTS[id].name;
                        const toastMessage = (state.lang === 'en') 
                            ? `Achievement: ${achievementName}!` 
                            : `Logro: ${achievementName}!`;
                        saveState();
                        showToast(toastMessage, 'success');
                        newAchievementUnlocked = true;
                    }
                }
            }
            if (newAchievementUnlocked) {
                dotAchievements.classList.remove('hidden');
            }
            updateMenuNotification();
        }

        function renderAchievements() {
            achievementsGrid.innerHTML = '';
            for (const id in ACHIEVEMENTS) {
                const achievement = ACHIEVEMENTS[id];
                const unlocked = state.achievements[id];

                const card = document.createElement('div');
                card.className = `achievement-card ${unlocked ? 'unlocked' : 'locked'}`;
                
                card.innerHTML = `
                    <div class="achievement-icon" style="fill: ${unlocked ? 'var(--accent)' : 'var(--muted)'};">${achievement.icon}</div>
                    <div class="achievement-info">
                        <h4>${achievement.name}</h4>
                        <p>${achievement.description}</p>
                        <p style="color: var(--muted); font-style: italic;">${(state.lang === 'en') ? 'Reward' : 'Recompensa'}: ${achievement.reward}</p>
                    </div>
                `;
                achievementsGrid.appendChild(card);
            }
        }

        function openChestsModal() {
            const chestsGrid = document.getElementById('chestsGrid');
            const chestsInfo = document.getElementById('chestsInfo');
            chestsModal.classList.remove('hidden');
            dotChests.classList.add('hidden');
            chestsGrid.innerHTML = '';
            updateMenuNotification();

            if (state.chests.length === 0) {
                chestsInfo.textContent = "No tienes cofres por ahora. ¡Sigue clickeando!";
                return;
            }

            chestsInfo.textContent = "¡Has encontrado cofres! Haz clic en uno para abrirlo.";
            state.chests.forEach((chest, index) => {
                const chestEl = document.createElement('div');
                chestEl.innerHTML = '<svg class="icon" style="width:48px; height:48px; stroke: #f39c12;" viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="3" y1="9" x2="21" y2="9"></line><line x1="9" y1="21" x2="9" y2="9"></line></svg>';
                chestEl.style.fontSize = '48px';
                chestEl.style.cursor = 'pointer';
                chestEl.style.transition = 'transform 0.2s';
                chestEl.addEventListener('mouseenter', () => chestEl.style.transform = 'scale(1.1)');
                chestEl.addEventListener('mouseleave', () => chestEl.style.transform = 'scale(1)');
                chestEl.addEventListener('click', () => {
                    // Deshabilitar todos los cofres para evitar doble clic
                    chestsGrid.querySelectorAll('div').forEach(c => c.style.pointerEvents = 'none');
                    // Abrir el cofre seleccionado
                    openChest(index, chestEl);
                }, { once: true });
                chestsGrid.appendChild(chestEl);
            });
        }

        function openChest(index) {
            const chestEl = document.querySelector(`#chestsGrid > div:nth-child(${index + 1})`);
            if (chestEl) {
                chestEl.style.pointerEvents = 'none';
                chestEl.style.animation = 'shake 0.5s';
            }            

            setTimeout(() => {
                state.chests.splice(index, 1);
                state.chestsOpened = (state.chestsOpened || 0) + 1;

                playSound('chestOpenSfx');

                // Probabilidad de 1 en 1000 para el Foso Pollo
                if (Math.random() < 0.001 && !state.fososOwned.includes(45)) {
                    state.fososOwned.push(45);
                    showToast("¡¡¡Has encontrado el legendario Foso Pollo 🍗!!!", "success", 5000);
                } else {
                    // Recompensa normal si no toca el Foso Pollo
                    const basePer = FOSOS[state.activeFosoIndex]?.perClick || 1;
                    const currentPerClick = basePer * state.perClickMult * (1 + state.rebirthBonus);
                    const rewardAmount = Math.floor(currentPerClick * 60 * (Math.random() * 0.5 + 0.75)); // Entre 75% y 125% de 60s de ganancias
                    state.sig += rewardAmount;
                    state.totalSigEarned += rewardAmount;
                    showToast(`¡El cofre contenía ${formatNum(rewardAmount)} ΣC!`, 'success', 4000);
                }

                openChestsModal(); // Refresh the modal
                saveState();
                checkAchievements();
                render(); // Actualizar la UI principal
            }, 600);
        }

        function saveState() {
            state.lastPlayed = Date.now();
            try {
                localStorage.setItem(CONFIG.storageKey, JSON.stringify(state));
            } catch (e) {
                console.warn('save state err', e);
            }
        }

        function loadState() {
            try {
                const raw = localStorage.getItem(CONFIG.storageKey);
                if (!raw) return;
                const s = JSON.parse(raw);
                Object.assign(state, s);
                if (isNaN(state.battery) || state.battery === null) {
                    state.battery = 100;
                }
                // Migration for new features
                if (!state.upgradeLevels) {
                    state.upgradeLevels = { battery: 0, autoclicker: 0, afk: 0, critical: 0 };
                } else if (state.upgradeLevels.critical === undefined) {
                    state.upgradeLevels.critical = 0;
                }
                if (state.upgradeLevels.efficiency === undefined) {
                    state.upgradeLevels.efficiency = 0;
                }
                if (state.upgradeLevels.combo === undefined) {
                    state.upgradeLevels.combo = 0;
                }
                if (state.upgradeLevels.liquid_luck === undefined) {
                    state.upgradeLevels.liquid_luck = 0;
                }
                if (state.upgradeLevels.autorecharge === undefined) {
                    state.upgradeLevels.autorecharge = 0;
                }
                if (state.upgradeLevels.autorecharge === undefined) {
                    state.upgradeLevels.autorecharge = 0;
                }
                if (state.upgradeLevels.autoclicker === undefined) {
                    state.upgradeLevels.critical = 0;
                }
                if (!state.achievements) {
                    state.achievements = {};
                }
                if (!state.wheelLastSpin) {
                    state.wheelLastSpin = 0;
                }
                if (!state.totalSigEarned) {
                    state.totalSigEarned = state.sig;
                }
                if (!state.dailyMissions) {
                    state.dailyMissions = [];
                }
                if (!state.lastMissionCheck) {
                    state.lastMissionCheck = 0;
                }
                if (!state.chests) {
                    state.chests = [];
                }
                if (!state.gems) {
                    state.gems = 0;
                }
                if (!state.unlockedPets) {
                    state.unlockedPets = [];
                }
                if (!state.equippedPet) {
                    state.equippedPet = null;
                }
                if (!state.combo) {
                    state.combo = { count: 0, expires: 0 };
                }
                if (!state.market) {
                    state.market = { nextUpdate: 0, priceMultipliers: {} };
                }
                if (!state.market.priceMultipliers) {
                    state.market.priceMultipliers = {};
                }
                if (state.settings === undefined) {
                    state.settings = {
                        smokeEnabled: true,
                        clickNumbersEnabled: true
                    };
                }
                if (state.settings.musicVolume === undefined) {
                    state.settings.musicVolume = 0.2;
                }
                if (state.settings.sfxVolume === undefined) {
                    state.settings.sfxVolume = 0.5;
                }
            } catch (e) {
                console.warn('load state err', e);
            }
        }

        function formatNum(n) {
            const suffixes = [
                { value: 1e3, symbol: "k" }, { value: 1e6, symbol: "m" },
                { value: 1e9, symbol: "b" }, { value: 1e12, symbol: "t" },
                { value: 1e15, symbol: "qa" }, { value: 1e18, symbol: "qi" },
                { value: 1e21, symbol: "sx" }, { value: 1e24, symbol: "sp" },
                { value: 1e27, symbol: "oc" }, { value: 1e30, symbol: "no" },
                { value: 1e33, symbol: "dc" }
            ];
            const item = suffixes.slice().reverse().find(item => n >= item.value);
            if (item) return (n / item.value).toFixed(2).replace(/\.00$/, '') + item.symbol;
            return Math.floor(n).toString();
        }

        function render() {
            const lang = state.lang || 'es';
            sigTotalEl.textContent = formatNum(state.sig);
            if(shopSigma) shopSigma.textContent = formatNum(state.sig);

            const fosoPolloCard = document.querySelector('.shopCard[data-index="45"]');
            if (fosoPolloCard) {
                fosoPolloCard.style.display = state.fososOwned.includes(45) ? 'flex' : 'none';
            }

            if(shopGems) shopGems.textContent = formatNum(state.gems);

            // Mostrar/ocultar botón de prestigio
            btnPrestige.classList.toggle('hidden', state.fososOwned.length < FOSOS.length);
            if(gemsTotalEl) gemsTotalEl.textContent = formatNum(state.gems);
            totalClicksEl.textContent = state.totalClicks;

            const currentRank = RANKS.slice().reverse().find(r => state.totalClicks >= r.clicks) || RANKS[0];
            if (rankTitleEl) {
                rankTitleEl.innerHTML = `<span data-lang="rank_label">Rango</span>: <span data-lang="${currentRank.key}">${LANGUAGES[lang][currentRank.key]}</span>`;
            }

            let petMultiplier = 1;
            if (state.equippedPet && PETS[state.equippedPet] && state.unlockedPets.includes(state.equippedPet)) {
                petMultiplier = PETS[state.equippedPet].multiplier * (state.petBonusMultiplier || 1);
            }

            const fosoHealth = state.fosoConditions[state.activeFosoIndex] || 100;
            const isBroken = fosoHealth <= 0;
            const healthPenalty = isBroken ? 0 : (fosoHealth < 20 ? 0.5 : 1); // Penalización si la salud es baja

            const basePer = FOSOS[state.activeFosoIndex]?.perClick || 1; // Ganancia base del foso
            
            let craftedBonus = 1;
            if (state.activeCraftedFlavor && state.activeCraftedFlavor.expires > Date.now()) {
                const bonus = state.activeCraftedFlavor.bonus;
                if (bonus.type === 'multiplier') {
                    craftedBonus = state.activeCraftedFlavor.bonus.value;
                }
            }

            let afkPrestigeBonus = 1;
            if (state.prestigeUpgrades.afk_earnings) {
                afkPrestigeBonus = 1 + (state.prestigeUpgrades.afk_earnings || 0) * PRESTIGE_UPGRADES.afk_earnings.bonus;
            }
            const prestigeBonus = 1 + (state.prestigeUpgrades.all_earnings || 0) * PRESTIGE_UPGRADES.all_earnings.bonus;
            const gemFosoBonus = 1 + state.gemFososOwned.length * 0.05;
            const comboBonus = state.combo.count > 1 ? 1 + (state.combo.count * 0.1) : 1; // +10% por nivel de combo
            let per = basePer * state.perClickMult * (1 + state.rebirthBonus) * comboBonus * petMultiplier * prestigeBonus * gemFosoBonus * craftedBonus;



            if (isBroken) per = 0;
            perClickEl.textContent = formatNum(per);

            // Render Foso Health
            if (maintenanceBarFill) {
                maintenanceBarFill.style.width = `${fosoHealth}%`;
                // Cambia el color de la barra según la salud
                const position = 100 - fosoHealth; // 0 = verde, 50 = amarillo, 100 = rojo
                maintenanceBarFill.style.backgroundPosition = `${position}% 0`;
            }
            // Animación de vibración y humo
            centralFoso.classList.remove('foso-shaking', 'foso-combo-max'); // Limpiar clases de animación
            if (state.combo.count >= CONFIG.comboMax) {
                centralFoso.classList.add('foso-combo-max');
            } else if (state.burned) {
                centralFoso.classList.add('foso-shaking');
            } else {
                centralFoso.classList.toggle('foso-shaking', fosoHealth < 40 && !isBroken);
            }
            if (centralScreen) {
                centralScreen.setAttribute('fill', isBroken ? '#c0392b' : '#000');
            }


            if(dailyStreakEl) dailyStreakEl.textContent = state.dailyDay;

            if (batteryText) {
                const maxB = state.maxBattery || 100;
                const percent = Math.floor((Number(state.battery) / maxB) * 100);
                batteryText.textContent = percent + "%" ;
                batteryText.setAttribute("fill", percent > 20 ? "#0f0" : "#f00");
            }

            const now = Date.now();
            if (state.mataCooldownUntil && state.mataCooldownUntil > now) {
                btnMata.disabled = true;
                const sec = Math.ceil((state.mataCooldownUntil - now) / 1000);
                const mm = String(Math.floor(sec / 60)).padStart(2, '0'),
                    ss = String(sec % 60).padStart(2, '0');
                mataLabel.textContent = `${LANGUAGES[state.lang || 'es']['cooldown']} ${mm}:${ss}`;
            } else {
                btnMata.disabled = isCharging;
                if(mataLabel.dataset.lang) mataLabel.textContent = LANGUAGES[state.lang || 'es'][mataLabel.dataset.lang];
            }

            syncCentralAppearance(state.activeFosoIndex);

            if (centralScreen) {
                if (state.burned) {
                    centralScreen.setAttribute('fill', '#6b0000');
                } else {
                    if (fosoHealth > 0)
                    centralScreen.setAttribute('fill', '#000');
                }
            }

            // Update shop items
            shopGrid.querySelectorAll('.shopCard[data-index]').forEach(card => {
                const index = parseInt(card.dataset.index, 10);
                const priceTag = card.querySelector('.priceTag');
                const baseCost = FOSOS[index].cost;
                const currentCost = Math.round(baseCost * (state.market.priceMultipliers[index] || 1));

                if (state.fososOwned.includes(index)) {
                    card.classList.add('owned');
                    if (priceTag) priceTag.textContent = LANGUAGES[lang]['owned'];
                    if (state.fosoConditions[index] === undefined) state.fosoConditions[index] = 100;
                    priceTag.style.color = '';
                } else {
                    card.classList.remove('owned');
                    if (priceTag) {
                        priceTag.textContent = `${formatNum(currentCost)} ΣC`;
                        priceTag.style.color = currentCost < baseCost ? '#2ecc71' : (currentCost > baseCost ? '#e74c3c' : '');
                    }
                }
            });

            // Update Gem Foso items
            shopGrid.querySelectorAll('.shopCard[data-gem-foso-index]').forEach(card => {
                const index = parseInt(card.dataset.gemFosoIndex, 10);
                const priceTag = card.querySelector('.priceTag');

                if (state.gemFososOwned.includes(index)) {
                    card.classList.add('owned');
                    priceTag.textContent = LANGUAGES[lang]['owned'];
                    priceTag.style.background = '#27ae60';
                } else {
                    card.classList.remove('owned');
                    priceTag.style.background = '';
                }
            });
            renderUpgrades();
        }

        function renderUpgrades() {
            const upgradesGrid = document.getElementById('upgradesGrid');
            if (!upgradesGrid) return;
            upgradesGrid.innerHTML = '';

            const allUpgrades = {
                autoclicker: { upgrades: AUTOCLICKER_UPGRADES, icon: '<svg class="icon" viewBox="0 0 24 24"><path d="M16 10h4v4h-4zM4 10h4v4H4zM10 4h4v4h-4zM10 16h4v4h-4z"/><path d="M12 10a2 2 0 100 4 2 2 0 000-4z"/></svg>', desc: 'Añade clics automáticos por segundo.' },
                battery: { upgrades: BATTERY_UPGRADES, icon: '<svg class="icon" viewBox="0 0 24 24"><path d="M17 4h-3V2h-4v2H7c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-5 14h-2v-6h2v6z"/></svg>', desc: 'Aumenta la capacidad máxima de la batería.' },
                critical: { upgrades: CRITICAL_UPGRADES, icon: '<svg class="icon" viewBox="0 0 24 24"><path d="M12 1L9 9l-8 3 8 3 3 8 3-8 8-3-8-3-3-8z"/></svg>', desc: 'Aumenta la probabilidad y multiplicador de críticos.' },
                efficiency: { upgrades: EFFICIENCY_UPGRADES, icon: '<svg class="icon" viewBox="0 0 24 24"><path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0L12 2.69z"/></svg>', desc: 'Reduce el consumo de batería por clic.' },
                combo: { upgrades: COMBO_UPGRADES, icon: '<svg class="icon" viewBox="0 0 24 24"><path d="M13 2 L4 14h6l-1 8 10-12h-7z"/></svg>', desc: 'Aumenta el tiempo para mantener el combo.' },
                autorecharge: { upgrades: AUTORECHARGE_UPGRADES, icon: '<svg class="icon" viewBox="0 0 24 24"><path d="M17 4h-3V2h-4v2H7c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-1 14h-3v3l4-4-4-4v3H7v-2h3V8l-4 4 4 4v-3h5v2z" fill="currentColor"/></svg>', desc: 'Recarga una pequeña cantidad de batería con cada clic.' },
                liquid_luck: { upgrades: LIQUID_LUCK_UPGRADES, icon: '<svg class="icon" viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg>', desc: 'Aumenta la probabilidad de encontrar líquidos.' },
            };

            for (const type in allUpgrades) {
                const level = state.upgradeLevels[type] || 0;
                const config = allUpgrades[type];
                const nextUpgrade = config.upgrades[level];

                const card = document.createElement('div');
                card.className = 'power-card';
                card.innerHTML = `
                    <div class="power-icon">${config.icon.replace('<svg', '<svg style="width:28px; height:28px;"')}</div>
                    <h4>${LANGUAGES[state.lang || 'es'][`upgrade_${type}`]} (Nivel ${level})</h4>
                    <p class="metaTiny">${config.desc}</p>
                    <button class="mata-btn" data-upgrade="${type}" ${!nextUpgrade || state.sig < nextUpgrade.cost ? 'disabled' : ''}>
                        ${nextUpgrade ? `${formatNum(nextUpgrade.cost)} ΣC` : LANGUAGES[state.lang || 'es']['max_level']}
                    </button>
                `;
                upgradesGrid.appendChild(card);
            }
        }

        function toggleCharging() {
            if (isCharging) {
                clearInterval(chargeInterval);
                chargeInterval = null;
                isCharging = false;
                if(chargeLabel.dataset.lang) chargeLabel.textContent = LANGUAGES[state.lang || 'es'][chargeLabel.dataset.lang];
                handleTutorialAction(3);
            } else {
                isCharging = true;
                chargeLabel.textContent = LANGUAGES[state.lang || 'es']['charging'] || 'Cargando...';
                chargeInterval = setInterval(() => {
                    if (Number(state.battery) < (state.maxBattery || 100)) {
                        state.battery = Math.min(state.maxBattery, (Number(state.battery) || 0) + 25);
                        render();
                    } else {
                        clearInterval(chargeInterval);
                        chargeInterval = null;
                        isCharging = false;
                        chargeLabel.textContent = LANGUAGES[state.lang || 'es']['charge'] || 'Cargar';
                        handleTutorialAction(3);
                    }
                }, 1000);
            }
        }

        function showClickAnimation(value, x, y, isCritical = false) {
            if (!chkClickNumbers.checked) return;
            const anim = document.createElement('div');
            anim.className = isCritical ? 'click-value critical' : 'click-value';
            anim.textContent = isCritical ? `CRÍTICO! +${formatNum(value)}` : `+${formatNum(value)}`;
            const rect = vaperWrap.getBoundingClientRect();
            anim.style.left = `${x - rect.left}px`;
            anim.style.top = `${y - rect.top - 20}px`; // Start slightly higher
            vaperWrap.appendChild(anim);            
            setTimeout(() => anim.remove(), 1000); // Coincide con la duración de la animación
        }

        function createSmokeParticle() {
            if (!state.settings.smokeEnabled) return;
            const smokeLayer = document.getElementById('smokeLayer');
            if (!smokeLayer) return;

            const smoke = document.createElement('div');
            smoke.className = 'smoke-on-click';

            // Posición X aleatoria para un efecto más natural
            const randomX = (Math.random() - 0.5) * 30; // -15px a +15px
            smoke.style.transform = `translateX(calc(-50% + ${randomX}px))`;

            smokeLayer.appendChild(smoke);

            // Eliminar el elemento después de que termine la animación
            setTimeout(() => {
                smoke.remove();
            }, 1500); // Coincide con la duración de la animación
        }

        function updateCombo() {
            const comboTimeExtension = state.upgradeLevels.combo > 0 ? COMBO_UPGRADES[state.upgradeLevels.combo - 1].time : 0;
            const totalComboTime = CONFIG.comboTimeout + comboTimeExtension;

            state.combo.count = Math.min(state.combo.count + 1, CONFIG.comboMax);
            state.combo.expires = Date.now() + totalComboTime;

            if (state.combo.count > 1) {
                comboContainer.classList.remove('hidden');
                comboText.textContent = LANGUAGES[state.lang || 'es']['combo_meter'].replace('{value}', (1 + (state.combo.count * 0.1)).toFixed(1));
            }

            if (comboDecayTimer) clearTimeout(comboDecayTimer);
            comboDecayTimer = setTimeout(() => {
                const tick = () => {
                    const remaining = state.combo.expires - Date.now();
                    if (remaining <= 0) {
                        state.combo.count = 0;
                        comboContainer.classList.add('hidden');
                    } else {
                        comboBar.style.width = `${(remaining / totalComboTime) * 100}%`;
                        requestAnimationFrame(tick);
                    }
                };
                tick();
            }, 100);
        }

        function handleCentralClick(e) {
            if (isCharging) {
                showToast('No puedes vapear mientras se está cargando.', "info");
                return;
            }
            if (!state.powerOn) return;
            if (state.burned) {
                showToast('El foso está quemado. Compra/selecciona otro.', "info");
                return;

            }
            if (state.battery <= 0) {
                showToast('Batería agotada.', "info");
                return;
            }

            const fosoHealth = state.fosoConditions[state.activeFosoIndex] || 100;
            if (fosoHealth <= 0) {
                showToast("¡Foso roto! Repáralo desde el menú de Mantenimiento.", "error");
                openMaintenanceModal();
                return;
            }

            state.clicksThisSecond = (state.clicksThisSecond || 0) + 1;
            if (state.activeEvent?.id !== 'combo_madness') {
                updateCombo();
            }

            const basePer = FOSOS[state.activeFosoIndex]?.perClick || 1; // Ganancia base del foso
            const comboBonus = state.combo.count > 1 ? 1 + (state.combo.count * 0.1) : 1;
            let per = basePer * state.perClickMult * (1 + state.rebirthBonus) * comboBonus; // Aplicar multiplicadores y bonus de rebirth
            let isCritical = false;

            let craftedBonus = 1;
            let craftedCritBonus = 0;
            if (state.activeCraftedFlavor && state.activeCraftedFlavor.expires > Date.now()) {
                const bonus = state.activeCraftedFlavor.bonus;
                if (bonus.type === 'multiplier') craftedBonus = bonus.value;
                if (bonus.type === 'crit_chance') craftedCritBonus = bonus.value;
                if (bonus.type === 'gem_chance') state.liquidDropChance += bonus.value; // Temporarily boost gem chance
            }

            const prestigeBonus = 1 + (state.prestigeUpgrades.all_earnings || 0) * PRESTIGE_UPGRADES.all_earnings.bonus;
            const gemFosoBonus = 1 + state.gemFososOwned.length * 0.05;
            per *= prestigeBonus * gemFosoBonus * craftedBonus;

            // Apply event effects
            if (state.activeEvent?.id === 'frenzy') {
                per *= 5;
            }

            const prestigeCritBonus = (state.prestigeUpgrades.crit_chance || 0) * PRESTIGE_UPGRADES.crit_chance.bonus;
            const critLevel = state.upgradeLevels.critical || 0;
            if (critLevel > 0) {
                const critUpgrade = CRITICAL_UPGRADES[critLevel - 1];
                if (critUpgrade && Math.random() < critUpgrade.chance) {
                    per *= critUpgrade.multiplier;
                    isCritical = true;
                }
            }

            // Ganancia de gemas
            let gemChance = 0.001 + ((state.prestigeUpgrades.gem_chance || 0) * PRESTIGE_UPGRADES.gem_chance.bonus);
            if (state.activeEvent?.id === 'gem_rain') {
                gemChance += 0.10; // +10% durante el evento
            }
            if (Math.random() < gemChance) { state.gems += 1; showToast('+1 💎!', 'success'); }

            // Ganancia de líquidos
            const liquidLuckLevel = state.upgradeLevels.liquid_luck || 0;
            const liquidLuckBonus = liquidLuckLevel > 0 ? LIQUID_LUCK_UPGRADES[liquidLuckLevel - 1].chance : 0;
            if (Math.random() < (state.liquidDropChance + liquidLuckBonus)) {
                gainRandomLiquid();
            }

            // Chest drop
            let chestChance = CONFIG.chestDropChance;
            if (state.activeCraftedFlavor && state.activeCraftedFlavor.expires > Date.now() && state.activeCraftedFlavor.bonus.type === 'chest_chance') {
                chestChance += state.activeCraftedFlavor.bonus.value;
            }

            state.sig += per;
            state.totalSigEarned += per;
            state.totalClicks++;
            updateMissionProgress('click', 1);
            updateMissionProgress('earn', per);

            // Degradar salud del foso
            state.fosoConditions[state.activeFosoIndex] = Math.max(0, fosoHealth - CONFIG.healthDegradationPerClick);
            if (state.fosoConditions[state.activeFosoIndex] <= 0) {
                showToast("¡Tu foso se ha roto! Repáralo para seguir.", "error", 5000);
            }
            updateMenuNotification();

            // Chest drop
            if (Math.random() < CONFIG.chestDropChance) {
                state.chests.push({ type: 'common' });
                showToast("¡Has encontrado un cofre!", "success");
                dotChests.classList.remove('hidden');
            }

            // Don't drain battery during event
            if (state.activeEvent?.id !== 'infinite_battery' && !(state.activeCraftedFlavor && state.activeCraftedFlavor.bonus.type === 'no_battery_drain' && state.activeCraftedFlavor.expires > Date.now())) {
                const efficiencyLevel = state.upgradeLevels.efficiency || 0;
                const efficiencyBonus = efficiencyLevel > 0 ? EFFICIENCY_UPGRADES[efficiencyLevel - 1].reduction : 0;
                let drain = CONFIG.baseBatteryDrainPerClick * (1 - efficiencyBonus);
                let finalDrain = drain;
                if (state.activeCraftedFlavor && state.activeCraftedFlavor.expires > Date.now() && state.activeCraftedFlavor.bonus.type === 'battery_saver') {
                    finalDrain *= (1 - state.activeCraftedFlavor.bonus.value); // 50% less drain means multiply by 0.5
                }
                state.battery = Math.max(0, state.battery - finalDrain);
            }
            
            // Auto-recharge per click
            const rechargeLevel = state.upgradeLevels.autorecharge || 0;
            if (rechargeLevel > 0) {
                const rechargeAmount = AUTORECHARGE_UPGRADES[rechargeLevel - 1].recharge;
                state.battery = Math.min(state.maxBattery, state.battery + rechargeAmount);
            }

            // The click handler can be called by the autoclicker with a null event
            // We only want to show animations for manual clicks (where 'e' is a valid event object)
            if (e) {
                // Animación de pulso
                centralFoso.classList.add('clicked');
                setTimeout(() => {
                    centralFoso.classList.remove('clicked');
                }, 100);

                showClickAnimation(per, e.clientX, e.clientY, isCritical);
                // Humo negro si está dañado
                const isDamaged = (state.fosoConditions[state.activeFosoIndex] || 100) < 40;
                createSmokeParticle(isDamaged);
            }

            // Play sounds
            playSound('clickSfx');
            if (!musicStarted && bgMusic) {
                bgMusic.volume = state.settings.musicVolume;
                bgMusic.play().catch(e => console.warn("Music autoplay was blocked."));
                musicStarted = true;
            }

            checkAchievements();
            handleTutorialAction(1);
            render();
        }

        function gainRandomLiquid(isFromClick = false) {
            const liquidIds = Object.keys(BASE_LIQUIDS);
            const randomId = liquidIds[Math.floor(Math.random() * liquidIds.length)];
            state.liquidInventory[randomId] = (state.liquidInventory[randomId] || 0) + 1;
            const liquid = BASE_LIQUIDS[randomId];
            if (isFromClick) {
                showToast(`¡Has encontrado ${liquid.name}! ${liquid.icon}`, 'info');
            }
            document.getElementById('dotCrafting').classList.remove('hidden');
            updateMenuNotification();
        }
        
        function syncCentralAppearance(activeIndex){
            const activeCard = document.querySelector(`.shopCard[data-index="${activeIndex}"]`); // Busca en todo el documento
            if(!activeCard) return; // Si la tarjeta no existe (ej. al inicio), no hacer nada
            state.fosoConditions[activeIndex] = state.fosoConditions[activeIndex] || 100; // Asegurar que la salud existe
            const cardSvg = activeCard.querySelector('svg');
            const cardDefs = cardSvg?.querySelector('defs');
            const centralDefs = centralFoso.querySelector('defs');
            if (!cardDefs || !centralDefs) return;

            centralDefs.querySelectorAll('#gActive, #mouthActive').forEach(n=>n.remove());
            
            if (!cardDefs) return;
            centralDefs.insertAdjacentHTML('beforeend', cardDefs.innerHTML.replace(/_shop/g, '').replace(/id="g(\d+)"/g, 'id="gActive"').replace(/id="mouth(\d+)"/g, 'id="mouthActive"'));

            const fosoData = FOSOS[activeIndex];
            const gameContainer = document.querySelector('.game-container');
            if (fosoData.background && gameContainer) gameContainer.style.background = fosoData.background;

            const rects = centralFoso.querySelectorAll('rect');
            const bodyRect = rects[0];
            if(bodyRect) bodyRect.setAttribute('fill','url(#gActive)');
        }

        function playSound(id, volume = state.settings.sfxVolume) {
            const audio = document.getElementById(id);
            if (audio && state.settings.sfxVolume > 0) {
                audio.volume = state.settings.sfxVolume;
                audio.currentTime = 0;
                audio.play().catch(e => {}); // Ignore play errors
            }
        }

        
        function showToast(message, type = "info", duration = 3000) {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = 'toast';

            const icons = { success: '✅', error: '❌', warning: '⚠️', info: 'ℹ️' };
            const colors = { success: '#27ae60', error: '#e74c3c', warning: '#f39c12', info: '#3498db' };

            toast.innerHTML = `<span>${icons[type] || 'ℹ️'}</span> ${message}`;
            toast.style.borderLeft = `4px solid ${colors[type] || '#3498db'}`;

            if (type === 'success') playSound('successSfx', 0.7);
            if (type === 'error') playSound('errorSfx', 0.7);

            container.appendChild(toast);

            setTimeout(() => {
                toast.remove();
            }, duration);
        }

        function updateNextRewardCountdown() {
            if (nextRewardInterval) clearInterval(nextRewardInterval);

            const now = new Date();
            const lastClaim = state.lastDailyClaim ? new Date(state.lastDailyClaim) : null;

            if (lastClaim && now.toDateString() === lastClaim.toDateString()) {
                nextRewardInterval = setInterval(() => {
                    const tomorrow = new Date(now.getFullYear(), now.getMonth(), now.getDate() + 1);
                    const diff = tomorrow - new Date();
                    if (diff <= 0) {
                        streakHint.textContent = '¡Tu recompensa diaria está lista!';
                        clearInterval(nextRewardInterval);
                        checkDailyReward();
                        return;
                    }
                    const hours = Math.floor(diff / (1000 * 60 * 60));
                    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((diff % (1000 * 60)) / 1000);
                    streakHint.textContent = `Próxima recompensa en: ${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
                }, 1000);
            } else {
                 if(streakHint.dataset.lang) streakHint.textContent = LANGUAGES[state.lang || 'es'][streakHint.dataset.lang];
            }
        }

        function checkDailyReward() {
            const now = new Date();
            const lastClaim = state.lastDailyClaim ? new Date(state.lastDailyClaim) : null;
            
            if (!lastClaim) {
                canClaimDaily = true;
                state.dailyDay = 1;
            } else {
                const isSameDay = now.toDateString() === lastClaim.toDateString();
                if (!isSameDay) {
                    const yesterday = new Date(now);
                    yesterday.setDate(now.getDate() - 1);
                    const isConsecutive = yesterday.toDateString() === lastClaim.toDateString();
                    if (isConsecutive) {
                        state.dailyDay = (state.dailyDay % DAILY_REWARDS.length) + 1;
                    } else {
                        state.dailyDay = 1; // Reset streak
                    }
                    canClaimDaily = true;
                } else {
                    canClaimDaily = false;
                }
            }

            if (canClaimDaily) {
                dotDaily.classList.remove('hidden');
                updateMenuNotification();
            } else {
                dotDaily.classList.add('hidden');
            }
            updateNextRewardCountdown();
            render();
        }

        function openDailyModal() {
            if (!dailyModal) return;
            dailyModal.classList.remove('hidden');
            dailyCarousel.innerHTML = '';

            DAILY_REWARDS.forEach((reward, index) => {
                const day = index + 1;
                const card = document.createElement('div');
                card.style.cssText = `
                    flex-shrink: 0;
                    width: 120px;
                    padding: 10px;
                    border-radius: 8px;
                    text-align: center;
                    border: 2px solid #333;
                    background: #222;
                `;
                if (day < state.dailyDay) { // Claimed
                    card.style.borderColor = '#27ae60';
                    card.style.opacity = '0.6';
                } else if (day === state.dailyDay && canClaimDaily) { // Can claim
                    card.style.borderColor = '#f39c12';
                    card.style.transform = 'scale(1.05)';
                }
                
                card.innerHTML = `
                    <div style="font-weight:bold; margin-bottom:8px;">${LANGUAGES[state.lang || 'es']['days'].slice(0, -1)} ${day}</div>
                    <div style="font-size:24px; margin-bottom:8px;">🎁</div>
                    <div style="font-size:12px;">${reward.label}</div>
                `;
                dailyCarousel.appendChild(card);
            });

            btnClaimDaily.disabled = !canClaimDaily;
        }

        function claimDailyReward() {
            if (!canClaimDaily) return;

            const rewardIndex = state.dailyDay - 1;
            const reward = DAILY_REWARDS[rewardIndex];

            if (reward.type === 'sig') {
                state.sig += reward.value;
                state.totalSigEarned += reward.value;
                showToast(`+${formatNum(reward.value)} ΣC!`, 'success');
            } else if (reward.type === 'multiplier') {
                state.perClickMult *= reward.value;
                showToast(`Multiplicador x${reward.value} activado por ${reward.duration / 60} min!`, 'success');
                setTimeout(() => { state.perClickMult /= reward.value; showToast(`El multiplicador del regalo diario ha terminado.`, 'info'); }, reward.duration * 1000);
            } else if (reward.type === 'combo') {
                state.sig += reward.value.sig;
                state.totalSigEarned += reward.value.sig;
                showToast(`+${reward.value.sig} ΣC y multiplicador activado!`, 'success');
            }

            state.lastDailyClaim = new Date().toISOString();
            canClaimDaily = false;
            dotDaily.classList.add('hidden');
            saveState();
            dailyModal.classList.add('hidden');
            updateNextRewardCountdown();
            render();
        }

        function updateAutoClickLoop() { // CORREGIDO
            if (autoClickTimer) {
                clearInterval(autoClickTimer);
                autoClickTimer = null;
            }
            const level = state.upgradeLevels.autoclicker || 0;
            if (level > 0) {
                const cps = AUTOCLICKER_UPGRADES[level - 1].cps;
                autoClickTimer = setInterval(() => {
                    if (state.powerOn && !isCharging && state.battery > 0 && document.visibilityState === 'visible') {                        handleCentralClick(null); 
                    }
                }, 1000 / cps);
            }
        }

        function calculateAfkEarnings() {
            const now = Date.now();
            const lastClaim = state.afkLastClaim || state.lastPlayed || now;
            const diffSeconds = Math.floor((now - lastClaim) / 1000);
            const afkLevel = state.upgradeLevels.afk || 0;
            let craftedAfkBonus = 1;
            if (state.activeCraftedFlavor && state.activeCraftedFlavor.expires > Date.now() && state.activeCraftedFlavor.bonus.type === 'afk_multiplier') {
                craftedAfkBonus = state.activeCraftedFlavor.bonus.value;
            }

            // showToast(`AFK check: ${diffSeconds}s since last claim. Level: ${afkLevel}`, "info"); // DEBUG
            const prestigeAfkBonus = 1 + (state.prestigeUpgrades.afk_earnings || 0) * PRESTIGE_UPGRADES.afk_earnings.bonus;
            if (afkLevel > 0) {
                const sph = AFK_UPGRADES[afkLevel - 1].sph;
                const earnings = (sph / 3600) * diffSeconds * (state.afkMultiplier || 1);
                state.afkEarnings = earnings;
                if (earnings > 0) {
                    dotAFK.classList.remove('hidden');
                }
            }
        }

        function openAfkModal() {
            calculateAfkEarnings();
            const afkLevel = state.upgradeLevels.afk || 0;
            const earnings = state.afkEarnings || 0;
            let infoText = `Ganancias actuales: ${formatNum(earnings)} ΣC.\n`;
            if (afkLevel > 0) {
                infoText += `Ganas ${formatNum(AFK_UPGRADES[afkLevel - 1].sph)} ΣC por hora.`;
            } else {
                infoText += 'Compra tu primera mejora para empezar a ganar AFK.';
            }
            afkInfo.innerText = infoText;

            const nextLevel = afkLevel < AFK_UPGRADES.length ? AFK_UPGRADES[afkLevel] : null;
            if (nextLevel) {
                btnUpgradeAFK.textContent = `Mejorar (${formatNum(nextLevel.cost)} ΣC)`;
                btnUpgradeAFK.disabled = false;
            } else {
                btnUpgradeAFK.textContent = 'MAX';
                btnUpgradeAFK.disabled = true;
            }

            dotAFK.classList.add('hidden');
            afkModal.classList.remove('hidden');
        }

        function claimAfkEarnings() {
            calculateAfkEarnings();
            const earnings = state.afkEarnings || 0;
            if (earnings > 0) {
                state.sig += earnings;
                state.totalSigEarned += earnings;
                showToast(`+${formatNum(earnings)} ΣC de ganancias AFK!`, 'success');
                state.afkEarnings = 0;
                state.afkLastClaim = Date.now();
                dotAFK.classList.add('hidden');
                saveState();
            updateMenuNotification();
            }
            afkModal.classList.add('hidden');
            render();
        }

        function upgradeAfk() {
            const level = state.upgradeLevels.afk || 0;
            if (level < AFK_UPGRADES.length) {
                const cost = AFK_UPGRADES[level].cost;
                if (state.sig >= cost) {
                    state.sig -= cost;
                    state.upgradeLevels.afk++;
                    showToast('¡Mejora de AFK comprada!', 'success');
                    saveState();
                    openAfkModal(); // Refresh modal
                } else {
                    showToast('No tienes suficientes Sigmacoins.', 'error');
                }
            }
            render();
        }

        function openRebirthModal() {
            const rebirthInfoEl = document.getElementById('rebirthInfo');
            const btnConfirmRebirth = document.getElementById('btnConfirmRebirth');
            const nextLevelIndex = state.rebirths;

            if (nextLevelIndex < REBIRTH_LEVELS.length) {
                const nextLevel = REBIRTH_LEVELS[nextLevelIndex];
                const hasEnoughSig = state.sig >= nextLevel.cost;
                const hasEnoughFosos = state.fososOwned.length >= nextLevel.requiredFosos;
                
                rebirthInfoEl.innerHTML = `
                    <p><strong>Próximo Rebirth (Nivel ${nextLevelIndex + 1}):</strong></p>
                    <ul>
                        <li>Costo: ${formatNum(nextLevel.cost)} ΣC (${hasEnoughSig ? '✅' : '❌'})</li>
                        <li>Fosos requeridos: ${nextLevel.requiredFosos} (${hasEnoughFosos ? '✅' : '❌'})</li>
                        <li><strong>Bonificación:</strong> +${nextLevel.bonus * 100}% de ganancias por clic</li>
                    </ul>
                `;
                btnConfirmRebirth.disabled = !(hasEnoughSig && hasEnoughFosos);
            } else {
                rebirthInfoEl.innerHTML = '<p>¡Has alcanzado el nivel máximo de Rebirth por ahora!</p>';
                btnConfirmRebirth.disabled = true;
            }

            rebirthModal.classList.remove('hidden');
        }

        function handleRebirth() {
            const nextLevelIndex = state.rebirths;
            if (nextLevelIndex >= REBIRTH_LEVELS.length) return;

            const nextLevel = REBIRTH_LEVELS[nextLevelIndex];
            const hasEnoughSig = state.sig >= nextLevel.cost;
            const hasEnoughFosos = state.fososOwned.length >= nextLevel.requiredFosos;

            if (hasEnoughSig && hasEnoughFosos) {
                if (confirm(`¿Seguro que quieres hacer Rebirth? Perderás tus Sigmacoins, fosos y mejoras a cambio de una bonificación de +${nextLevel.bonus * 100}% en las ganancias.`)) {
                    // Aplicar bonificación
                    state.rebirthBonus += nextLevel.bonus;
                    state.rebirths++;

                    // Recompensa de Gemas por Rebirth
                    const gemsFromRebirth = 10 + (state.rebirths * 5);
                    state.gems += gemsFromRebirth;
                    showToast(`¡Has ganado ${gemsFromRebirth} gemas 💎 por el Rebirth!`, 'success');


                    // Resetear estado
                    state.sig = 0;
                    state.totalClicks = state.totalClicks; // Mantener clics totales
                    state.activeFosoIndex = 0; // CORREGIDO: Asegurar que fososOwned es un array
                    state.fososOwned = [0];
                    state.battery = 100; // Resetear batería
                    state.maxBattery = 100;
                    state.upgradeLevels = { battery: 0, autoclicker: 0, afk: 0 };
                    // Podríamos resetear más cosas si quisiéramos (cooldowns, etc.)

                    showToast(`¡Rebirth completado! Ahora tienes un +${(state.rebirthBonus * 100).toFixed(0)}% de bonus.`, 'success', 5000);
                    rebirthModal.classList.add('hidden');
                    checkAchievements();
                    saveState();
                    updateAutoClickLoop();
                    render();
                }
            } else {
                showToast('No cumples los requisitos para el Rebirth.', 'error');
            }
        }

        function openPrestigeModal() {
            const prestigeInfoEl = document.getElementById('prestigeInfo');
            const btnConfirmPrestige = document.getElementById('btnConfirmPrestige');
            const prestigeUpgradesGrid = document.getElementById('prestigeUpgradesGrid');

            const canPrestige = state.fososOwned.length >= FOSOS.length;
            const pointsToGain = canPrestige ? Math.floor(Math.log10(state.totalSigEarned) / 2) : 0;

            prestigeInfoEl.innerHTML = `
                <p>Nivel de Prestigio actual: <strong>${state.prestigeLevel}</strong></p>
                <p>Puntos de Prestigio (PP) actuales: <strong>${state.prestigePoints}</strong></p>
                <p>PP que ganarás al prestigiar: <strong>${pointsToGain}</strong></p>
            `;

            btnConfirmPrestige.disabled = !canPrestige;

            // Render prestige upgrades
            prestigeUpgradesGrid.innerHTML = '';
            for (const id in PRESTIGE_UPGRADES) {
                const upgrade = PRESTIGE_UPGRADES[id];
                const level = state.prestigeUpgrades[id] || 0;
                const cost = upgrade.cost * (level + 1);

                const card = document.createElement('div');
                card.className = 'shopCard';
                card.title = upgrade.description;

                card.innerHTML = `
                    <div style="font-size: 24px;">${upgrade.icon}</div>
                    <div style="font-weight:700; font-size: 12px;">${upgrade.name} (Lvl ${level})</div>
                    <button class="mata-btn buy-prestige-btn" data-id="${id}" ${state.prestigePoints < cost || level >= upgrade.maxLevel ? 'disabled' : ''}>
                        ${level >= upgrade.maxLevel ? 'MAX' : `${cost} PP`}
                    </button>
                `;
                prestigeUpgradesGrid.appendChild(card);
            }

            prestigeModal.classList.remove('hidden');
        }

        function handlePrestige() {
            if (state.fososOwned.length < FOSOS.length) return;

            const pointsToGain = Math.floor(Math.log10(state.totalSigEarned) / 2);
            if (confirm(`¿Seguro que quieres hacer Prestigio? Ganarás ${pointsToGain} Puntos de Prestigio y reiniciarás tu progreso.`)) {
                state.prestigeLevel++;
                state.prestigePoints += pointsToGain;

                // Reset
                state.sig = 0;
                state.activeFosoIndex = 0;
                state.fososOwned = [0];
                state.battery = 100;
                state.maxBattery = 100;
                state.upgradeLevels = { battery: 0, autoclicker: 0, afk: 0, critical: 0 };
                state.rebirths = 0;
                state.rebirthBonus = 0;

                showToast(`¡Prestigio completado! Nivel ${state.prestigeLevel}. Has ganado ${pointsToGain} PP.`, 'success', 5000);
                prestigeModal.classList.add('hidden');
                saveState();
                updateAutoClickLoop();
                render();
            }
        }

        function buyPrestigeUpgrade(id) {
            const upgrade = PRESTIGE_UPGRADES[id];
            const level = state.prestigeUpgrades[id] || 0;
            const cost = upgrade.cost * (level + 1);

            if (state.prestigePoints >= cost && level < upgrade.maxLevel) {
                state.prestigePoints -= cost;
                state.prestigeUpgrades[id] = level + 1;
                showToast(`¡Mejora de prestigio '${upgrade.name}' comprada!`, 'success');
                saveState();
                openPrestigeModal(); // Refresh
            }
        }

        function openCraftingModal() {
            craftingModal.classList.remove('hidden');
            document.getElementById('dotCrafting').classList.add('hidden');
            updateMenuNotification();
            renderLiquidInventory();
            renderActiveFlavor();
        }

        function renderLiquidInventory() {
            const grid = document.getElementById('liquidInventoryGrid');
            grid.innerHTML = '';
            for (const id in state.liquidInventory) {
                if (state.liquidInventory[id] > 0) {
                    const liquid = BASE_LIQUIDS[id];
                    const item = document.createElement('div');
                    item.className = 'liquid-item';
                    item.draggable = true;
                    item.dataset.liquidId = id;
                    item.innerHTML = `
                        <div class="liquid-icon">${liquid.icon}</div>
                        <div class="liquid-name">${liquid.name}</div>
                        <div class="liquid-count">x${state.liquidInventory[id]}</div>
                    `;
                    item.addEventListener('dragstart', handleDragStart);
                    grid.appendChild(item);
                }
            }
        }

        function renderActiveFlavor() {
            const detailsEl = document.getElementById('activeFlavorDetails');
            if (state.activeCraftedFlavor && state.activeCraftedFlavor.expires > Date.now()) {
                const flavor = state.activeCraftedFlavor;
                const remaining = Math.ceil((flavor.expires - Date.now()) / 1000);
                let bonusText = '';
                if (flavor.bonus.type === 'multiplier') bonusText = `+${(flavor.bonus.value - 1) * 100}% ΣC`;
                if (flavor.bonus.type === 'crit_chance') bonusText = `+${flavor.bonus.value * 100}% Prob. Crítico`;
                if (flavor.bonus.type === 'afk_multiplier') bonusText = `+${(flavor.bonus.value - 1) * 100}% Ganancias AFK`;
                if (flavor.bonus.type === 'battery_saver') bonusText = `-${flavor.bonus.value * 100}% Consumo Batería`;
                if (flavor.bonus.type === 'chest_chance') bonusText = `+${flavor.bonus.value * 100}% Prob. Cofre`;
                if (flavor.bonus.type === 'gem_chance') bonusText = `+${flavor.bonus.value * 100}% Prob. Gema`;
                if (flavor.bonus.type === 'no_battery_drain') bonusText = `Batería no se gasta`;

                detailsEl.innerHTML = `
                    <strong>${flavor.name}</strong>
                    <p class="metaTiny">Bonus: ${bonusText}</p>
                    <p class="metaTiny">Tiempo restante: ${remaining}s</p>
                `;
            } else {
                detailsEl.innerHTML = `<p class="metaTiny" data-lang="no_active_flavor">${LANGUAGES[state.lang || 'es']['no_active_flavor']}</p>`;
            }
        }

        function handleDragStart(e) {
            e.dataTransfer.setData('text/plain', e.target.dataset.liquidId);
        }

        function handleDrop(e) {
            e.preventDefault();
            const slot = e.target.closest('.crafting-slot');
            if (!slot) return;
            slot.classList.remove('over');
            const liquidId = e.dataTransfer.getData('text/plain');
            if (liquidId && BASE_LIQUIDS[liquidId]) {
                slot.dataset.liquidId = liquidId;
                slot.innerHTML = `<div class="liquid-icon">${BASE_LIQUIDS[liquidId].icon}</div>`;
            }
        }

        function combineLiquids() {
            const slots = document.querySelectorAll('#craftingSlots .crafting-slot');
            const ingredients = Array.from(slots).map(slot => slot.dataset.liquidId).filter(id => id).sort();

            if (ingredients.length < 2) {
                showToast("Necesitas al menos 2 ingredientes.", "error");
                return;
            }

            // Check inventory
            const tempInventory = { ...state.liquidInventory };
            for (const id of ingredients) {
                if (!tempInventory[id] || tempInventory[id] <= 0) {
                    showToast("No tienes suficientes líquidos.", "error");
                    return;
                }
                tempInventory[id]--;
            }

            const recipe = CRAFTING_RECIPES.find(r => JSON.stringify(r.ingredients) === JSON.stringify(ingredients));
            
            // Consume ingredients
            state.liquidInventory = tempInventory;

            if (recipe) {
                if (state.activeCraftedFlavor && state.activeCraftedFlavor.expires > Date.now()) {
                    if (!confirm("Ya tienes un sabor activo. ¿Quieres reemplazarlo? Perderás el bonus actual.")) {
                        // Devolver ingredientes si el usuario cancela
                        ingredients.forEach(id => state.liquidInventory[id]++);
                        return;
                    }
                }
                 const result = recipe.result;
                 const durationBonus = state.craftedFlavorDurationBonus || 1;
                 state.activeCraftedFlavor = {
                     ...result,
                     id: result.id,
                     name: result.name,
                     expires: Date.now() + (result.duration * 1000 * durationBonus)
                 };
                 state.craftsDone = (state.craftsDone || 0) + 1;
                 showToast(`¡Has creado ${result.name}!`, 'success');
                 saveState();
            } else {
                showToast("La combinación ha fallado...", "error");
            }

            // Clear slots and update UI
            slots.forEach(slot => {
                delete slot.dataset.liquidId;
                slot.innerHTML = '';
            });
            renderLiquidInventory();
            renderActiveFlavor();
        }

        function buyShopFlavor(flavorId) {
            const flavor = SHOP_FLAVORS[flavorId];
            if (!flavor) return;

            if (state.activeCraftedFlavor && state.activeCraftedFlavor.expires > Date.now()) {
                if (!confirm("Ya tienes un sabor activo. ¿Quieres reemplazarlo? Perderás el bonus actual.")) {
                    return;
                }
            }

            if (flavor.currency === 'sig' && state.sig >= flavor.cost) {
                state.sig -= flavor.cost;
            } else if (flavor.currency === 'gems' && state.gems >= flavor.cost) {
                state.gems -= flavor.cost;
            } else {
                showToast(`No tienes suficientes ${flavor.currency === 'sig' ? 'ΣC' : 'gemas'}.`, 'error');
                return;
            }

            // Handle instant-effect flavors
            if (flavor.duration === 0) {
                if (flavor.bonus.type === 'instant_repair') {
                    state.fosoConditions[state.activeFosoIndex] = Math.min(100, (state.fosoConditions[state.activeFosoIndex] || 100) + flavor.bonus.value);
                    showToast(`Foso reparado en un ${flavor.bonus.value}%!`, 'success');
                } else if (flavor.bonus.type === 'instant_afk') {
                    const afkLevel = state.upgradeLevels.afk || 0;
                    if (afkLevel > 0) {
                        const sph = AFK_UPGRADES[afkLevel - 1].sph;
                        const earnings = (sph / 3600) * flavor.bonus.value;
                        state.sig += earnings;
                        showToast(`¡Has ganado ${formatNum(earnings)} ΣC de la poción!`, 'success');
                    } else {
                        showToast('Compra mejoras AFK para usar esta poción.', 'warning');
                    }
                }
                render();
                return; // Don't set it as an active flavor
            }

            state.activeCraftedFlavor = {
                ...flavor,
                expires: Date.now() + (flavor.duration * 1000)
            };
            showToast(`¡Has activado ${flavor.name}!`, 'success');
            saveState();
            render();
        }

        function updateTutorialButtonStates(step) {
            const allButtons = rightMenu.querySelectorAll('.mata-btn');
            allButtons.forEach(btn => btn.disabled = true);
            menuToggle.disabled = true;

            // Enable buttons based on tutorial step
            switch (step) {
                case 0: // No tutorial
                    allButtons.forEach(btn => btn.disabled = false);
                    menuToggle.disabled = false;
                    break;
                case 1: // Click foso
                case 2: // See battery
                    break; // All disabled
                case 3: // Charge
                    btnChargeToggle.disabled = false;
                    break;
                case 4: // Open menu
                    menuToggle.disabled = false;
                    break;
                case 5: // Open shop
                    menuToggle.disabled = true; // Keep it disabled to focus on shop
                    btnShop.disabled = false;
                    break;
                case 6: // Buy foso
                    menuToggle.disabled = false;
                    btnShop.disabled = false;
                    break;
                case 7: // Open upgrades
                    menuToggle.disabled = true;
                    btnUpgrades.disabled = false;
                    break;
                case 8: // Introduce other features
                    menuToggle.disabled = true;
                    btnDaily.disabled = false;
                    btnWheel.disabled = true; // Keep some disabled to not overwhelm
                    btnMissions.disabled = false;
                    break;
            }
            // Re-evaluate disabled state based on game logic (e.g., cooldowns)
            render();
        }

        function showTutorialStep(step) {
            if (state.tutorialCompleted) return;

            const tutorialOverlay = document.getElementById('tutorialOverlay');
            const tutorialArrow = document.getElementById('tutorialArrow');
            const lang = state.lang || 'es';
            const translations = LANGUAGES[lang];
            state.tutorialStep = step;
            tutorialOverlay.classList.remove('hidden', 'tutorial-active');

            let targetEl;
            let text = '';
            let nextBtnText = translations.next;
            let isActionStep = false; // If true, button is hidden, advances on action

            switch (step) {
                case 1: // Click foso
                    targetEl = vaperWrap;
                    text = translations.tutorial_1;
                    isActionStep = true;
                    break; // Wait for user click
                case 2:
                    targetEl = batteryText;
                    text = translations.tutorial_2;
                    break;
                case 3:
                    targetEl = btnChargeToggle;
                    text = translations.tutorial_3;
                    isActionStep = true;
                    break; // Wait for user click
                case 4:
                    if (!rightMenu.classList.contains('active')) {
                        rightMenu.classList.add('active');
                    }
                    targetEl = menuToggle;
                    text = translations.tutorial_4;
                    isActionStep = true;
                    break; // Wait for user click
                case 5:
                    targetEl = btnShop;
                    text = "Ahora, entra en la Tienda para ver los fosos disponibles.";
                    isActionStep = true; // Wait for user click
                    break; // Wait for user click
                case 6:
                    targetEl = document.querySelector('.shopCard[data-index="1"]'); // Foso 2
                    text = translations.tutorial_5;
                    isActionStep = true; // Wait for user click
                    break; // Wait for user click
                case 7:
                    targetEl = btnUpgrades;
                    text = translations.tutorial_6;
                    isActionStep = true; // This should be `isActionStep`
                    break;
                case 8:
                    targetEl = rightMenu;
                    text = translations.tutorial_7;
                    break;
                case 9:
                    targetEl = vaperWrap;
                    text = translations.tutorial_8;
                    nextBtnText = translations.got_it;
                    break;
                default:
                    tutorialOverlay.classList.add('hidden');
                    tutorialOverlay.classList.remove('tutorial-active');
                    state.tutorialCompleted = true;
                    updateTutorialButtonStates(0); // Enable all buttons
                    saveState();
                    return;
            }

            // If it's an action step, we just show the highlight and wait for the action.
            if (isActionStep) {
                tutorialNextBtn.classList.add('hidden');
            } else {
                tutorialNextBtn.classList.remove('hidden');
            }
            updateTutorialButtonStates(step);

            if (!targetEl || !targetEl.offsetParent) { // If element is hidden or doesn't exist, skip
                checkTutorialProgress(step + 1);
                return;
            }

            tutorialOverlay.classList.add('tutorial-active');
            
            // Posicionar el botón de saltar
            tutorialSkipBtn.style.position = 'fixed';
            tutorialSkipBtn.style.top = '20px';
            tutorialSkipBtn.style.left = '20px';
            tutorialSkipBtn.classList.remove('hidden');

            tutorialText.innerText = text;
            tutorialNextBtn.textContent = nextBtnText;

            const rect = targetEl.getBoundingClientRect();
            tutorialHighlight.style.left = `${rect.left - 4}px`;
            tutorialHighlight.style.top = `${rect.top - 4}px`;
            tutorialHighlight.style.width = `${rect.width + 8}px`;
            tutorialHighlight.style.height = `${rect.height + 8}px`;

            // Position tooltip and arrow
            const tooltipRect = tutorialTooltip.getBoundingClientRect();
            let top, left, arrowClass, arrowEl;
            arrowEl = document.getElementById('tutorialArrow');
            if (rect.bottom + tooltipRect.height + 15 > window.innerHeight) { // Place above
                top = rect.top - tooltipRect.height - 15 - arrowEl.offsetHeight;
                arrowClass = 'bottom';
            } else { // Place below
                top = rect.bottom + 15 + arrowEl.offsetHeight;
                arrowClass = 'top';
            }
            left = rect.left + (rect.width / 2) - (tooltipRect.width / 2);
            left = Math.max(10, Math.min(left, window.innerWidth - tooltipRect.width - 10));

            tutorialTooltip.style.top = `${top}px`;
            tutorialTooltip.style.left = `${left}px`;
            if(arrowEl) arrowEl.className = `tutorial-arrow ${arrowClass}`;

            tutorialNextBtn.onclick = () => showTutorialStep(step + 1);

            tutorialSkipBtn.onclick = () => {
                tutorialOverlay.classList.add('hidden');
                tutorialOverlay.classList.remove('tutorial-active');
                state.tutorialCompleted = true;
                updateTutorialButtonStates(0); // Habilitar todos los botones
                saveState();
                showToast('Tutorial saltado.', 'info');
            };
        }

        function checkTutorialProgress(nextStep) {
            if (state.tutorialCompleted || state.tutorialStep >= nextStep) return;
            
            // Hide current tutorial to avoid flicker
            const tutorialOverlay = document.getElementById('tutorialOverlay');
            tutorialOverlay.classList.remove('tutorial-active');

            // Show next step after a short delay
            setTimeout(() => showTutorialStep(nextStep), 150);
        }


        function handleTutorialAction(stepCondition) {
            if (!state.tutorialCompleted && state.tutorialStep === stepCondition) {
                checkTutorialProgress(stepCondition + 1);
            }
        }

        function startTutorial() {
            if (state.tutorialCompleted) {
                updateTutorialButtonStates(0); // Ensure all buttons are enabled on load
                return;
            }
            // Delay start to allow intro animations to finish
            setTimeout(() => showTutorialStep(1), 8500);
        }
        
        function openMaintenanceModal() {
            maintenanceModal.classList.remove('hidden');
            generateMaintenanceGame();
        }

        function generateMaintenanceGame() {
            const gameArea = maintenanceGameArea;
            gameArea.innerHTML = '';
            maintenanceSequence = [];
            currentMaintenanceStep = 0;

            const fosoHealth = state.fosoConditions[state.activeFosoIndex] || 100;
            if (fosoHealth === 100) {
                maintenanceInstructions.textContent = "El foso está en perfectas condiciones.";
                maintenanceRewardText.textContent = "";
                setTimeout(() => maintenanceModal.classList.add('hidden'), 1500);
                return;
            }
            
            maintenanceInstructions.textContent = LANGUAGES[state.lang || 'es']['maintenance_instructions'];
            const reward = Math.floor((100 - fosoHealth) * 10 * (state.maintenanceRewardBonus || 1));
            maintenanceRewardText.textContent = LANGUAGES[state.lang || 'es']['maintenance_reward'].replace('{amount}', formatNum(reward));
            
            const numPoints = 4;
            for (let i = 1; i <= numPoints; i++) {
                const point = document.createElement('div');
                point.className = 'maintenance-point';
                point.textContent = i;
                point.dataset.id = i;

                // Posiciones aleatorias pero dentro del foso
                point.style.top = `${Math.random() * 70 + 10}%`; // Entre 10% y 80%
                point.style.left = `${Math.random() * 60 + 20}%`; // Entre 20% y 80%

                point.addEventListener('click', handleMaintenanceClick);
                gameArea.appendChild(point);
            }
        }

        function handleMaintenanceClick(e) {
            const clickedId = parseInt(e.target.dataset.id, 10);
            if (clickedId === currentMaintenanceStep + 1) {
                currentMaintenanceStep++;
                e.target.style.background = 'lightgreen';
                e.target.style.pointerEvents = 'none'; // Desactivar tras acierto

                if (currentMaintenanceStep === 4) { // 4 es el número de puntos
                    // Éxito
                    const fosoHealth = state.fosoConditions[state.activeFosoIndex] || 100;
                    const reward = Math.floor((100 - fosoHealth) * 10 * (state.maintenanceRewardBonus || 1));
                    state.sig += reward;
                    state.totalSigEarned += reward;
                    state.fosoConditions[state.activeFosoIndex] = 100;
                    state.maintenancesDone = (state.maintenancesDone || 0) + 1;
                    showToast(LANGUAGES[state.lang || 'es'].foso_repaired_toast.replace('{amount}', formatNum(reward)), "success");
                    maintenanceModal.classList.add('hidden');
                }
            } else {
                // Error
                showToast("¡Secuencia incorrecta! Inténtalo de nuevo.", "error");
                generateMaintenanceGame(); // Reiniciar
            }
        }

        function renderPets() {
            const petsGrid = document.getElementById('petsGrid');
            const petsGems = document.getElementById('petsGems');
            if (!petsGrid || !petsGems) return;

            petsGems.textContent = formatNum(state.gems);
            petsGrid.innerHTML = '';

            Object.values(PETS).forEach(pet => {
                const isUnlocked = state.unlockedPets.includes(pet.id);
                const isEquipped = state.equippedPet === pet.id;

                const card = document.createElement('div');
                card.className = 'shopCard';
                card.dataset.petId = pet.id;

                if (isEquipped) {
                    card.style.borderColor = 'var(--accent)';
                    card.style.boxShadow = '0 0 15px -3px var(--accent)';
                }

                card.innerHTML = `
                    <div style="font-size: 48px;">${pet.icon}</div>
                    <div style="font-weight:700;">${pet.name}</div>
                    <p class="hint" style="font-size:11px; margin: 4px 0; min-height: 2.5em;">${pet.description}</p>
                    <button class="mata-btn pet-action-btn" style="width: 100%; justify-content: center;"></button>
                `;

                const actionBtn = card.querySelector('.pet-action-btn');
                if (isEquipped) {
                    actionBtn.textContent = 'Equipado';
                    actionBtn.disabled = true;
                    actionBtn.style.background = '#27ae60';
                } else if (isUnlocked) {
                    actionBtn.textContent = 'Equipar';
                    actionBtn.dataset.action = 'equip';
                } else {
                    actionBtn.textContent = `Comprar (${formatNum(pet.cost)} 💎)`;
                    actionBtn.dataset.action = 'buy';
                    actionBtn.disabled = state.gems < pet.cost;
                }

                petsGrid.appendChild(card);
            });
        }

        function openPetsModal() {
            renderPets();
            petsModal.classList.remove('hidden');
            dotPets.classList.add('hidden');
        }

        function triggerRandomEvent() {
            if (state.activeEvent) return; // Don't start a new event if one is active

            if (Math.random() < CONFIG.eventChance) {
                const eventConfig = RANDOM_EVENTS[Math.floor(Math.random() * RANDOM_EVENTS.length)];
                state.eventsParticipated = (state.eventsParticipated || 0) + 1;
                state.activeEvent = {
                    id: eventConfig.id,
                    name_key: eventConfig.name_key,
                    expires: Date.now() + eventConfig.duration,
                };

                // Apply event effect
                if (eventConfig.onStart) {
                    eventConfig.onStart(state);
                }

                showToast(LANGUAGES[state.lang || 'es'][eventConfig.name_key], 'success', 5000);
                eventBanner.classList.remove('hidden');
            }
        }

        function updateEventUI() {
            if (!state.activeEvent) {
                eventBanner.classList.add('hidden');
                return;
            }

            const remaining = state.activeEvent.expires - Date.now();
            if (remaining <= 0) {
                // Event ended
                const eventConfig = RANDOM_EVENTS.find(e => e.id === state.activeEvent.id);
                if (eventConfig && eventConfig.onEnd) {
                    eventConfig.onEnd();
                }
                showToast("El evento ha terminado.", "info");
                state.activeEvent = null;
                eventBanner.classList.add('hidden');
            } else {
                eventName.textContent = LANGUAGES[state.lang || 'es'][state.activeEvent.name_key];
                eventTimer.textContent = `${Math.ceil(remaining / 1000)}s`;
            }
        }

        function openBlackMarket() {
            state.blackMarketOffers = [];
            // Generate 3 unique offers
            const availableFosos = FOSOS.map((f, i) => i).filter(i => i > 0 && !state.fososOwned.includes(i));
            
            for (let i = 0; i < 3 && availableFosos.length > 0; i++) {
                const randIndex = Math.floor(Math.random() * availableFosos.length);
                const fosoIndex = availableFosos.splice(randIndex, 1)[0];
                const discount = 0.3 + Math.random() * 0.4; // 30% - 70% discount
                const foso = FOSOS[fosoIndex];
                state.blackMarketOffers.push({
                    fosoIndex: fosoIndex,
                    cost: Math.round(foso.cost * (1 - discount)),
                });
            }
            renderBlackMarket();
            blackMarketModal.classList.remove('hidden');
        }

        function renderBlackMarket() {
            blackMarketGrid.innerHTML = '';
            state.blackMarketOffers.forEach((offer, i) => {
                if (offer.bought) return;
                const foso = FOSOS[offer.fosoIndex];
                const card = document.createElement('div');
                card.className = 'shopCard';
                card.dataset.offerIndex = i;
                card.innerHTML = `
                    <div class="metaTiny" style="font-weight:700">${document.querySelector(`.shopCard[data-index="${offer.fosoIndex}"] .metaTiny`).textContent}</div>
                    <div class="priceTag" style="color: #2ecc71;">${formatNum(offer.cost)} ΣC</div>
                `;
                card.addEventListener('click', () => buyBlackMarketOffer(i));
                blackMarketGrid.appendChild(card);
            });
        }

        function buyBlackMarketOffer(offerIndex) {
            const offer = state.blackMarketOffers[offerIndex];
            if (!offer || offer.bought) return;

            if (state.sig >= offer.cost) {
                state.sig -= offer.cost;
                state.fososOwned.push(offer.fosoIndex);
                offer.bought = true; // Mark as bought
                showToast("¡Buena compra!", "success");
                renderBlackMarket(); // Re-render to show it's gone
            } else {
                showToast("No tienes suficientes Sigmacoins.", "error");
            }
        }

        function updateMarket() {
            FOSOS.forEach((foso, index) => {
                if (foso.cost > 0) {
                    const change = (Math.random() * 0.20) + 0.05; // 5% to 25%
                    const direction = Math.random() > 0.5 ? 1 : -1;
                    state.market.priceMultipliers[index] = Math.max(0.5, 1 + (change * direction)); // Min price is 50% of base
                } else {
                    state.market.priceMultipliers[index] = 1;
                }
            });
            state.market.nextUpdate = Date.now() + CONFIG.marketUpdateInterval;
            showToast("¡Los precios del mercado han cambiado!", "info");
            render();
        }

        function updateMarketStatus() {
            const remaining = state.market.nextUpdate - Date.now();
            if (remaining <= 0) return;
            const minutes = Math.floor(remaining / 60000);
            const seconds = Math.floor((remaining % 60000) / 1000);
            marketStatusEl.textContent = `Próximo cambio de precios en: ${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadState();
            checkMissionReset(); // Must be before render
            renderWheel();
            calculateAfkEarnings();
            checkWheelCooldown(); // Initial check
            translateUI();
            updateAutoClickLoop();
            render();
            // startTutorial(); // Tutorial deshabilitado permanentemente

            setInterval(saveState, CONFIG.autosaveMs);

            // // Intervalo para la mecánica de quemado (DESACTIVADO)
            // setInterval(() => {
            //     if ((state.clicksThisSecond || 0) > CONFIG.overheatCps) {
            //         state.burned = true;
            //         showToast('¡Has quemado el foso! Equipa otro o espera a que se enfríe.', 'error');
            //         render();
            //     }
            //     state.clicksThisSecond = 0;
            // }, 1000);

            setInterval(() => { render(); updateMarketStatus(); updateEventUI(); renderActiveFlavor(); }, CONFIG.uiTickMs);
            setInterval(calculateAfkEarnings, 60000);
            setInterval(checkWheelCooldown, 1000);
            checkDailyReward();

            // Lluvia de monedas periódica
            setInterval(() => {
                const rainContainer = document.createElement('div');
                rainContainer.className = 'coin-rain';
                document.body.appendChild(rainContainer);

                for (let i = 0; i < 50; i++) {
                    const coin = document.createElement('div');
                    coin.className = 'coin';
                    coin.textContent = 'Σ';
                    coin.style.left = `${Math.random() * 100}vw`;
                    coin.style.animationDelay = `${Math.random() * 4}s`;
                    coin.style.fontSize = `${Math.random() * 16 + 12}px`;
                    coin.style.opacity = `${Math.random() * 0.5 + 0.5}`;
                    rainContainer.appendChild(coin);
                }

                showToast("¡Lluvia de Sigmacoins!", "success", 4000);

                setTimeout(() => {
                    rainContainer.remove();
                }, 5000); // Duración de la animación + delay
            }, 20 * 60 * 1000); // 20 minutos

            eventInterval = setInterval(triggerRandomEvent, CONFIG.eventInterval);
            if (Date.now() > state.market.nextUpdate) {
                updateMarket();
            }
            marketUpdateInterval = setInterval(updateMarket, CONFIG.marketUpdateInterval);

            if (menuToggle) {
                menuToggle.addEventListener('click', () => {
                    rightMenu.classList.toggle('active');
                    handleTutorialAction(4);
                });
            }
            dotChests.classList.toggle('hidden', state.chests.length === 0);

            if(langSelect) langSelect.value = state.lang || 'es';

            if(centralFoso) centralFoso.addEventListener('click', handleCentralClick);

            if(btnMaintenance) btnMaintenance.addEventListener('click', openMaintenanceModal);
            if(maintenanceModal) {
                maintenanceModal.querySelector('.close-btn').addEventListener('click', () => {
                    maintenanceModal.classList.add('hidden');
                });
            }

            if(blackMarketModal) {
                blackMarketModal.querySelector('.close-btn').addEventListener('click', () => {
                    blackMarketModal.classList.add('hidden');
                });
            }

            const promoBtn = document.getElementById('promoBtn');
            if (promoBtn) {
                promoBtn.addEventListener('click', () => {
                    const code = promoInput.value.trim().toUpperCase();
                    if (!code) return;

                    if (code === 'IG') {
                        state.perClickMult *= 2;
                        showToast('¡Código IG! x2 de ganancias por 10 minutos.', 'success');
                        setTimeout(() => {
                            state.perClickMult /= 2;
                            showToast('El bonus del código IG ha terminado.', 'info');
                        }, 10 * 60 * 1000); // 10 minutos
                        promoInput.value = '';
                    } else if  (code === 'ALR') {
                        state.sig = Infinity;
                        state.gems = Infinity;
                        showToast('¡Código ALR! ¡Dinero y gemas infinitas!', 'success');
                        promoInput.value = '';
                    } 
                    else if (code === 'SIGMA') {
                        state.sig += 1000;
                        state.totalSigEarned += 1000;
                        showToast('¡Código SIGMA! +1,000 ΣC.', 'success');
                        promoInput.value = '';
                    } else if (code === 'FOSO') {
                        if (!state.fososOwned.includes(1)) {
                            state.fososOwned.push(1);
                            showToast('¡Código FOSO! Has desbloqueado el Foso 2.', 'success');
                        } else {
                            showToast('Ya tienes el Foso 2 desbloqueado.', 'warning');
                        }
                        promoInput.value = '';
                    } else if (code === 'GEMAS') {
                        state.gems += 50;
                        showToast('¡Código GEMAS! +50 gemas.', 'success');
                        promoInput.value = '';

                    }else {
                        showToast('Código promocional no válido.', 'error');
                    }
                });
            }


            if(btnPower) {
                btnPower.addEventListener('click', () => {
                    state.powerOn = !state.powerOn;
                    const powerStatus = state.powerOn ? 'encendido' : 'apagado';
                    const color = state.powerOn ? 'success' : 'error';
                    btnPower.style.background = state.powerOn ? '#0ea5b7' : '#555';
                    showToast(`Foso ${powerStatus}.`, color);
                    render();
                });
            }

            if(btnChargeToggle) btnChargeToggle.addEventListener('click', () => {
                toggleCharging();
                handleTutorialAction(3); // Tutorial step for charging
            });
            
            if(btnShop) btnShop.addEventListener('click', () => {
              if(shopModal) shopModal.classList.remove('hidden');
              handleTutorialAction(4); // After opening menu, this is the next action
            });

            if(shopModal) {
              shopModal.querySelectorAll('.close-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                  shopModal.classList.add('hidden');
                  if (!state.tutorialCompleted && state.tutorialStep === 5) checkTutorialProgress(6);
                });
              });
            }

            if(btnUpgrades) btnUpgrades.addEventListener('click', () => {
                upgradesModal.classList.remove('hidden');
                renderUpgrades();
                handleTutorialAction(6); // Tutorial step for upgrades
            });
            if(upgradesModal) {
                upgradesModal.querySelector('.close-btn').addEventListener('click', () => {
                    upgradesModal.classList.add('hidden');
                    handleTutorialAction(7);
                });
            }

            if(btnRebirth) btnRebirth.addEventListener('click', openRebirthModal);
            if(rebirthModal) {
                rebirthModal.querySelector('.close-btn').addEventListener('click', () => {
                    rebirthModal.classList.add('hidden');
                });
                document.getElementById('btnConfirmRebirth').addEventListener('click', handleRebirth);
            }

            if(btnCrafting) btnCrafting.addEventListener('click', openCraftingModal);
            if(craftingModal) {
                craftingModal.querySelector('.close-btn').addEventListener('click', () => craftingModal.classList.add('hidden'));
                document.getElementById('btnCombine').addEventListener('click', combineLiquids);
                const slots = craftingModal.querySelectorAll('.crafting-slot');
                slots.forEach(slot => {
                    slot.addEventListener('dragover', (e) => { e.preventDefault(); slot.classList.add('over'); });
                    slot.addEventListener('dragleave', () => slot.classList.remove('over'));
                    slot.addEventListener('drop', handleDrop);
                    slot.addEventListener('click', () => { // Clear slot on click
                        delete slot.dataset.liquidId; slot.innerHTML = '';
                    });
                });
            }

            if(btnPrestige) btnPrestige.addEventListener('click', openPrestigeModal);
            if(prestigeModal) {
                prestigeModal.querySelector('.close-btn').addEventListener('click', () => {
                    prestigeModal.classList.add('hidden');
                });
                document.getElementById('btnConfirmPrestige').addEventListener('click', handlePrestige);
                prestigeModal.querySelector('#prestigeUpgradesGrid').addEventListener('click', (e) => {
                    if (e.target.classList.contains('buy-prestige-btn')) buyPrestigeUpgrade(e.target.dataset.id);
                });
            }


            
            if(btnConfig) btnConfig.addEventListener('click', ()=> {
              if(configModal) configModal.classList.remove('hidden');
              chkSmoke.checked = state.settings.smokeEnabled;
              chkClickNumbers.checked = state.settings.clickNumbersEnabled;
              musicVolumeSlider.value = state.settings.musicVolume;
              sfxVolumeSlider.value = state.settings.sfxVolume;
            });

            
            if(btnConfig) btnConfig.addEventListener('click', ()=> {
              if(configModal) configModal.classList.remove('hidden');
              chkSmoke.checked = state.settings.smokeEnabled;
              chkClickNumbers.checked = state.settings.clickNumbersEnabled;
              musicVolumeSlider.value = state.settings.musicVolume;
              sfxVolumeSlider.value = state.settings.sfxVolume;
            });

            if(configModal) {
              configModal.querySelectorAll('.close-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                  configModal.classList.add('hidden');
                });
              });
            }

            if(langSelect) langSelect.addEventListener('change', (e) => {
                state.lang = e.target.value;
                translateUI();
                render(); // Re-render dynamic parts like cooldowns
            });

            if(chkSmoke) chkSmoke.addEventListener('change', (e) => {
                state.settings.smokeEnabled = e.target.checked;
            });

            if(chkClickNumbers) chkClickNumbers.addEventListener('change', (e) => {
                state.settings.clickNumbersEnabled = e.target.checked;
            });

            if(musicVolumeSlider) musicVolumeSlider.addEventListener('input', (e) => {
                state.settings.musicVolume = parseFloat(e.target.value);
                if(bgMusic) bgMusic.volume = state.settings.musicVolume;
            });

            if(sfxVolumeSlider) sfxVolumeSlider.addEventListener('input', (e) => {
                state.settings.sfxVolume = parseFloat(e.target.value);
            });

            if(btnManualSave) btnManualSave.addEventListener('click', () => {
                saveState();
                showToast('¡Progreso guardado!', 'success');
            });

            if(btnRepeatTutorial) btnRepeatTutorial.addEventListener('click', () => {
                state.tutorialCompleted = false;
                state.tutorialStep = 0;
                configModal.classList.add('hidden');
                showToast('El tutorial se mostrará de nuevo.', 'info');
                startTutorial();
            });

            if(btnReset) btnReset.addEventListener('click', ()=>{
              if(confirm('⚠️ Esto borrará absolutamente TODO el progreso guardado en este juego.')){
                localStorage.clear();
                state = {};
                location.reload(true);
              }
            });

            if(btnMata) btnMata.addEventListener('click', ()=>{
              const now = Date.now();
              if(state.mataCooldownUntil && state.mataCooldownUntil > now) return;
              state.sig += CONFIG.mataReward;
              state.totalSigEarned += CONFIG.mataReward;
              state.mataUses = (state.mataUses || 0) + 1;
              state.mataCooldownUntil = now + CONFIG.mataCooldownSec*1000;
              checkAchievements();
              render();
            });

            if(btnDaily) btnDaily.addEventListener('click', openDailyModal);
            if(closeDaily) closeDaily.addEventListener('click', () => dailyModal.classList.add('hidden'));
            if(btnClaimDaily) btnClaimDaily.addEventListener('click', claimDailyReward);
            
            if(powersModal) {
                powersModal.querySelector('.close-btn').addEventListener('click', () => powersModal.classList.add('hidden'));
            }
            if(btnAFK) btnAFK.addEventListener('click', openAfkModal);
            if(afkModal) afkModal.querySelector('.close-btn').addEventListener('click', () => afkModal.classList.add('hidden'));
            if(btnClaimAFK) btnClaimAFK.addEventListener('click', claimAfkEarnings);
            if(btnUpgradeAFK) btnUpgradeAFK.addEventListener('click', upgradeAfk);
            afkModal.querySelectorAll('[data-close]').forEach(btn => btn.addEventListener('click', () => afkModal.classList.add('hidden')));

            if(btnWheel) {
                btnWheel.addEventListener('click', () => {
                    wheelModal.classList.remove('hidden');
                });
            }

            if(wheelModal) {
                wheelModal.querySelector('.close-btn').addEventListener('click', () => {
                    wheelModal.classList.add('hidden');
                });
            }

            if(btnSpinWheel) {
                btnSpinWheel.addEventListener('click', spinWheel);
            }

            if(btnMissions) {
                btnMissions.addEventListener('click', () => {
                    renderMissions();
                    missionsModal.classList.remove('hidden');
                });
            }

            if(missionsModal) {
                missionsModal.querySelector('.close-btn').addEventListener('click', () => {
                    missionsModal.classList.add('hidden');
                });
            }

            if(btnAchievements) {
                btnAchievements.addEventListener('click', () => {
                    renderAchievements();
                    achievementsModal.classList.remove('hidden');
                    dotAchievements.classList.add('hidden');
                });
            }

            if(achievementsModal) {
                achievementsModal.querySelector('.close-btn').addEventListener('click', () => {
                    achievementsModal.classList.add('hidden');
                });
            }

            if(btnChests) {
                btnChests.addEventListener('click', openChestsModal);
            }
            if(chestsModal) {
                chestsModal.querySelector('.close-btn').addEventListener('click', () => {
                    chestsModal.classList.add('hidden');
                });
            }

            if (btnPets) {
                btnPets.addEventListener('click', openPetsModal);
            }
            // Cargar sonidos
            bgMusic = document.getElementById('bgMusic');
            clickSfx = document.getElementById('clickSfx');
            buySfx = document.getElementById('buySfx');
            successSfx = document.getElementById('successSfx');
            errorSfx = document.getElementById('errorSfx');
            if (petsModal) {
                petsModal.querySelector('.close-btn').addEventListener('click', () => {
                    petsModal.classList.add('hidden');
                });
                petsModal.querySelector('#petsGrid').addEventListener('click', handlePetAction);
            }





            if (shopGrid) {
                shopGrid.addEventListener('click', (e) => {
                    const card = e.target.closest('.shopCard');
                    if (!card) return;

                    const itemIndex = card.dataset.index; // For fosos
                    const gemFosoIndex = card.dataset.gemFosoIndex; // For gem fosos
                    const flavorId = card.dataset.flavorId; // For flavors

                    if (itemIndex !== undefined) {
                        const index = parseInt(itemIndex, 10);
                        const item = FOSOS[index];                        
                        const currentCost = Math.round(item.cost * (state.market.priceMultipliers[index] || 1));

                        if (state.fososOwned.includes(index)) {
                            state.activeFosoIndex = index;
                            showToast(`Foso ${item.name} equipado.`, 'info');
                            // Al equipar un foso nuevo, se "arregla" si el anterior estaba quemado
                            if (state.burned) {
                                state.burned = false;
                                showToast('Foso nuevo equipado, ¡listo para usar!', 'success');
                            }
                        } else {
                            if (state.sig >= currentCost) {
                                state.sig -= currentCost;
                                state.fososOwned.push(index);
                                state.activeFosoIndex = index;
                                showToast(`Foso ${item.name} comprado y equipado!`, 'success');
                                playSound('buySfx');
                                updateMissionProgress('buy_foso', 1);                                
                                handleTutorialAction(5); // Check tutorial after buying
                                checkAchievements();
                            } else {
                                showToast('No tienes suficientes Sigmacoins.', 'error');
                            }
                        }
                    } else if (gemFosoIndex !== undefined) {
                        const index = parseInt(gemFosoIndex, 10);
                        const item = GEM_FOSOS[index];
                        if (!state.gemFososOwned.includes(index)) {
                            if (state.gems >= item.cost) {
                                state.gems -= item.cost;
                                state.gemFososOwned.push(index);
                                showToast(`¡Foso de Gema comprado! Bonus de ganancias +5%`, 'success');
                                playSound('buySfx');
                            } else {
                                showToast('No tienes suficientes gemas.', 'error');
                            }
                        }
                    } else if (flavorId) {
                        buyShopFlavor(flavorId);
                    }
                    render();
                });
            }

            if (upgradesGrid) {
                upgradesGrid.addEventListener('click', (e) => {
                    const button = e.target.closest('button[data-upgrade]');
                    if (!button) return;

                    const upgradeType = button.dataset.upgrade;
                    const allUpgrades = { autoclicker: AUTOCLICKER_UPGRADES, battery: BATTERY_UPGRADES, critical: CRITICAL_UPGRADES, efficiency: EFFICIENCY_UPGRADES, combo: COMBO_UPGRADES, liquid_luck: LIQUID_LUCK_UPGRADES };
                    const upgrades = allUpgrades[upgradeType];
                    const level = state.upgradeLevels[upgradeType] || 0;

                    if (level < upgrades.length) {
                        if (!state.upgradeLevels[upgradeType]) state.upgradeLevels[upgradeType] = 0;
                        const cost = upgrades[level].cost;
                        if (state.sig >= cost) {
                            state.sig -= cost;
                            state.upgradeLevels[upgradeType]++;
                            if (upgradeType === 'battery') state.maxBattery = nextUpgrade.capacity;
                            if (upgradeType === 'autoclicker') updateAutoClickLoop();
                            if (upgradeType === 'autorecharge') updateAutoRechargeLoop();
                            playSound('buySfx');
                            showToast(`¡Mejora de ${upgradeType} comprada!`, 'success');
                            renderUpgrades();
                        }
                    }
                });
            }

        });

        function handlePetAction(e) {
            const button = e.target.closest('.pet-action-btn');
            if (!button) return;

            const card = button.closest('.shopCard');
            const petId = card.dataset.petId;
            const pet = PETS[petId];
            const action = button.dataset.action;

            if (action === 'buy') {
                if (state.gems >= pet.cost) {
                    state.gems -= pet.cost;
                    state.unlockedPets.push(petId);
                    playSound('buySfx');
                    showToast(`¡Has adoptado a ${pet.name}!`, 'success');
                    renderPets();
                } else {
                    showToast('No tienes suficientes gemas.', 'error');
                }
            } else if (action === 'equip') {
                state.equippedPet = petId;
                playSound('successSfx');
                renderPets();
            }
        }
    })();
</script>

<!-- Elementos de Audio -->
<audio id="bgMusic" loop src="data:audio/mp3;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjQ1LjEwMAAAAAAAAAAAAAAA//tAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAAAAAACQABAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEA//tA0BMAAAAAAABEluZm8AAAAPAAAABAAAASAAAAAAAAAAAAAAAAAAAAAAQU1BVE9SQUxTVE9SRQAA//tA1BMAAAAAAAABAAAAAQU1BVE9SQUxTVE9SRQAA//tA2BMAAAAAAAABAAAAAQU1BVE9SQUxTVE9SRQAA//tA3BMAAAAAAAABAAAAAQU1BVE9SQUxTVE9SRQAA//tA4BMAAAAAAAABAAAAAQU1BVE9SQUxTVE9SRQAA//tA5BMAAAAAAAABAAAAAQU1BVE9SQUxTVE9SRQAA//tA6BMAAAAAAAABAAAAAQU1BVE9SQUxTVE9SRQAA//tA7BMAAAAAAAABAAAAAQU1BVE9SQUxTVE9SRQAA//tA8BMAAAAAAAABAAAAAQU1BVE9SQUxTVE9SRQAA//tA9BMAAAAAAAABAAAAAQU1BVE9SQUxTVE9SRQAA//tA+BMAAAAAAAABAAAAAQU1BVE9SQUxTVE9SRQAA//tA/BMAAAAAAAABAAAAAQU1BVE9SQUxTVE9SRQAA//tBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA-"></audio>
<audio id="clickSfx" src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAAABkYXRhAAAAAA=="></audio>
<audio id="buySfx" src="data:audio/wav;base64,UklGRlIAAABXQVZFZm10IBAAAAABAAIARKwAABCxAgAEABgAZGF0YUYAAAD/////////////////v/7//v/+/////v/9//7/+//6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/-"></audio>
                    tutorialOverlay.classList.add('hidden');
                    state.tutorialCompleted = true;
                    return;
            }

            if (!targetEl) { // If element doesn't exist, skip step
                checkTutorialProgress(step + 1);
                return;
            }

            tutorialText.innerText = text;
            tutorialNextBtn.textContent = nextBtnText;

            const rect = targetEl.getBoundingClientRect();
            tutorialHighlight.style.left = `${rect.left - 5}px`;
            tutorialHighlight.style.top = `${rect.top - 5}px`;
            tutorialHighlight.style.width = `${rect.width + 10}px`;
            tutorialHighlight.style.height = `${rect.height + 10}px`;
            tutorialHighlights.push(targetEl);

            // Position tooltip
            if (rect.bottom + 150 > window.innerHeight) { // If not enough space below
                tutorialTooltip.style.top = `${rect.top - tutorialTooltip.offsetHeight - 10}px`;
            } else {
                tutorialTooltip.style.top = `${rect.bottom + 10}px`;
            }
            tutorialTooltip.style.left = `${rect.left + rect.width / 2 - tutorialTooltip.offsetWidth / 2}px`;

            tutorialNextBtn.onclick = () => {
                if (condition()) {
                    showTutorialStep(step + 1);
                }
            };
        }

        function checkTutorialProgress(nextStep) {
            if (state.tutorialCompleted || state.tutorialStep >= nextStep) return;
            showTutorialStep(nextStep);
        }

        function startTutorial() {
            if (state.tutorialCompleted || state.tutorialStep > 0) return;
            setTimeout(() => showTutorialStep(1), 2000);
        }

        function openMaintenanceModal() {
            maintenanceModal.classList.remove('hidden');
            generateMaintenanceGame();
        }

        function generateMaintenanceGame() {
            const gameArea = maintenanceGameArea;
            gameArea.innerHTML = '';
            maintenanceSequence = [];
            currentMaintenanceStep = 0;

            const fosoHealth = state.fosoConditions[state.activeFosoIndex] || 100;
            if (fosoHealth === 100) {
                maintenanceInstructions.textContent = "El foso está en perfectas condiciones.";
                maintenanceRewardText.textContent = "";
                setTimeout(() => maintenanceModal.classList.add('hidden'), 1500);
                return;
            }
            
            maintenanceInstructions.textContent = LANGUAGES[state.lang || 'es']['maintenance_instructions'];
            const reward = Math.floor((100 - fosoHealth) * 10 * (state.maintenanceRewardBonus || 1));
            maintenanceRewardText.textContent = LANGUAGES[state.lang || 'es']['maintenance_reward'].replace('{amount}', formatNum(reward));
            
            const numPoints = 4;
            for (let i = 1; i <= numPoints; i++) {
                const point = document.createElement('div');
                point.className = 'maintenance-point';
                point.textContent = i;
                point.dataset.id = i;

                // Posiciones aleatorias pero dentro del foso
                point.style.top = `${Math.random() * 70 + 10}%`; // Entre 10% y 80%
                point.style.left = `${Math.random() * 60 + 20}%`; // Entre 20% y 80%

                point.addEventListener('click', handleMaintenanceClick);
                gameArea.appendChild(point);
            }
        }

        function handleMaintenanceClick(e) {
            const clickedId = parseInt(e.target.dataset.id, 10);
            if (clickedId === currentMaintenanceStep + 1) {
                currentMaintenanceStep++;
                e.target.style.background = 'lightgreen';
                e.target.style.pointerEvents = 'none'; // Desactivar tras acierto

                if (currentMaintenanceStep === 4) { // 4 es el número de puntos
                    // Éxito
                    const fosoHealth = state.fosoConditions[state.activeFosoIndex] || 100;
                    const reward = Math.floor((100 - fosoHealth) * 10 * (state.maintenanceRewardBonus || 1));
                    state.sig += reward;
                    state.totalSigEarned += reward;
                    state.fosoConditions[state.activeFosoIndex] = 100;
                    state.maintenancesDone = (state.maintenancesDone || 0) + 1;
                    showToast(LANGUAGES[state.lang || 'es'].foso_repaired_toast.replace('{amount}', formatNum(reward)), "success");
                    maintenanceModal.classList.add('hidden');
                }
            } else {
                // Error
                showToast("¡Secuencia incorrecta! Inténtalo de nuevo.", "error");
                generateMaintenanceGame(); // Reiniciar
            }
        }

        function renderPets() {
            const petsGrid = document.getElementById('petsGrid');
            const petsGems = document.getElementById('petsGems');
            if (!petsGrid || !petsGems) return;

            petsGems.textContent = formatNum(state.gems);
            petsGrid.innerHTML = '';

            Object.values(PETS).forEach(pet => {
                const isUnlocked = state.unlockedPets.includes(pet.id);
                const isEquipped = state.equippedPet === pet.id;

                const card = document.createElement('div');
                card.className = 'shopCard';
                card.dataset.petId = pet.id;

                if (isEquipped) {
                    card.style.borderColor = 'var(--accent)';
                    card.style.boxShadow = '0 0 15px -3px var(--accent)';
                }

                card.innerHTML = `
                    <div style="font-size: 48px;">${pet.icon}</div>
                    <div style="font-weight:700;">${pet.name}</div>
                    <p class="hint" style="font-size:11px; margin: 4px 0; min-height: 2.5em;">${pet.description}</p>
                    <button class="mata-btn pet-action-btn" style="width: 100%; justify-content: center;"></button>
                `;

                const actionBtn = card.querySelector('.pet-action-btn');
                if (isEquipped) {
                    actionBtn.textContent = 'Equipado';
                    actionBtn.disabled = true;
                    actionBtn.style.background = '#27ae60';
                } else if (isUnlocked) {
                    actionBtn.textContent = 'Equipar';
                    actionBtn.dataset.action = 'equip';
                } else {
                    actionBtn.textContent = `Comprar (${formatNum(pet.cost)} 💎)`;
                    actionBtn.dataset.action = 'buy';
                    actionBtn.disabled = state.gems < pet.cost;
                }

                petsGrid.appendChild(card);
            });
        }

        function openPetsModal() {
            renderPets();
            petsModal.classList.remove('hidden');
            dotPets.classList.add('hidden');
        }

        function triggerRandomEvent() {
            if (state.activeEvent) return; // Don't start a new event if one is active

            if (Math.random() < CONFIG.eventChance) {
                const eventConfig = RANDOM_EVENTS[Math.floor(Math.random() * RANDOM_EVENTS.length)];
                state.eventsParticipated = (state.eventsParticipated || 0) + 1;
                state.activeEvent = {
                    id: eventConfig.id,
                    name_key: eventConfig.name_key,
                    expires: Date.now() + eventConfig.duration,
                };

                // Apply event effect
                if (eventConfig.onStart) {
                    eventConfig.onStart(state);
                }

                showToast(LANGUAGES[state.lang || 'es'][eventConfig.name_key], 'success', 5000);
                eventBanner.classList.remove('hidden');
            }
        }

        function updateEventUI() {
            if (!state.activeEvent) {
                eventBanner.classList.add('hidden');
                return;
            }

            const remaining = state.activeEvent.expires - Date.now();
            if (remaining <= 0) {
                // Event ended
                const eventConfig = RANDOM_EVENTS.find(e => e.id === state.activeEvent.id);
                if (eventConfig && eventConfig.onEnd) {
                    eventConfig.onEnd();
                }
                showToast("El evento ha terminado.", "info");
                state.activeEvent = null;
                eventBanner.classList.add('hidden');
            } else {
                eventName.textContent = LANGUAGES[state.lang || 'es'][state.activeEvent.name_key];
                eventTimer.textContent = `${Math.ceil(remaining / 1000)}s`;
            }
        }

        function openBlackMarket() {
            state.blackMarketOffers = [];
            // Generate 3 unique offers
            const availableFosos = FOSOS.map((f, i) => i).filter(i => i > 0 && !state.fososOwned.includes(i));
            
            for (let i = 0; i < 3 && availableFosos.length > 0; i++) {
                const randIndex = Math.floor(Math.random() * availableFosos.length);
                const fosoIndex = availableFosos.splice(randIndex, 1)[0];
                const discount = 0.3 + Math.random() * 0.4; // 30% - 70% discount
                const foso = FOSOS[fosoIndex];
                state.blackMarketOffers.push({
                    fosoIndex: fosoIndex,
                    cost: Math.round(foso.cost * (1 - discount)),
                });
            }
            renderBlackMarket();
            blackMarketModal.classList.remove('hidden');
        }

        function renderBlackMarket() {
            blackMarketGrid.innerHTML = '';
            state.blackMarketOffers.forEach((offer, i) => {
                if (offer.bought) return;
                const foso = FOSOS[offer.fosoIndex];
                const card = document.createElement('div');
                card.className = 'shopCard';
                card.dataset.offerIndex = i;
                card.innerHTML = `
                    <div class="metaTiny" style="font-weight:700">${document.querySelector(`.shopCard[data-index="${offer.fosoIndex}"] .metaTiny`).textContent}</div>
                    <div class="priceTag" style="color: #2ecc71;">${formatNum(offer.cost)} ΣC</div>
                `;
                card.addEventListener('click', () => buyBlackMarketOffer(i));
                blackMarketGrid.appendChild(card);
            });
        }

        function buyBlackMarketOffer(offerIndex) {
            const offer = state.blackMarketOffers[offerIndex];
            if (!offer || offer.bought) return;

            if (state.sig >= offer.cost) {
                state.sig -= offer.cost;
                state.fososOwned.push(offer.fosoIndex);
                offer.bought = true; // Mark as bought
                showToast("¡Buena compra!", "success");
                renderBlackMarket(); // Re-render to show it's gone
            } else {
                showToast("No tienes suficientes Sigmacoins.", "error");
            }
        }

        function updateMarket() {
            FOSOS.forEach((foso, index) => {
                if (foso.cost > 0) {
                    const change = (Math.random() * 0.20) + 0.05; // 5% to 25%
                    const direction = Math.random() > 0.5 ? 1 : -1;
                    state.market.priceMultipliers[index] = Math.max(0.5, 1 + (change * direction)); // Min price is 50% of base
                } else {
                    state.market.priceMultipliers[index] = 1;
                }
            });
            state.market.nextUpdate = Date.now() + CONFIG.marketUpdateInterval;
            showToast("¡Los precios del mercado han cambiado!", "info");
            render();
        }

        function updateMarketStatus() {
            const remaining = state.market.nextUpdate - Date.now();
            if (remaining <= 0) return;
            const minutes = Math.floor(remaining / 60000);
            const seconds = Math.floor((remaining % 60000) / 1000);
            marketStatusEl.textContent = `Próximo cambio de precios en: ${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadState();
            checkMissionReset(); // Must be before render
            renderWheel();
            calculateAfkEarnings();
            checkWheelCooldown(); // Initial check
            translateUI();
            updateAutoClickLoop();
            render();
            startTutorial();

            setInterval(saveState, CONFIG.autosaveMs);

            // // Intervalo para la mecánica de quemado (DESACTIVADO)
            // setInterval(() => {
            //     if ((state.clicksThisSecond || 0) > CONFIG.overheatCps) {
            //         state.burned = true;
            //         showToast('¡Has quemado el foso! Equipa otro o espera a que se enfríe.', 'error');
            //         render();
            //     }
            //     state.clicksThisSecond = 0;
            // }, 1000);
            
            setInterval(() => { render(); updateMarketStatus(); updateEventUI(); renderActiveFlavor(); }, CONFIG.uiTickMs);
            setInterval(calculateAfkEarnings, 60000);
            setInterval(checkWheelCooldown, 1000);
            checkDailyReward();

            // Lluvia de monedas periódica
            setInterval(() => {
                const rainContainer = document.createElement('div');
                rainContainer.className = 'coin-rain';
                document.body.appendChild(rainContainer);

                for (let i = 0; i < 50; i++) {
                    const coin = document.createElement('div');
                    coin.className = 'coin';
                    coin.textContent = 'Σ';
                    coin.style.left = `${Math.random() * 100}vw`;
                    coin.style.animationDelay = `${Math.random() * 4}s`;
                    coin.style.fontSize = `${Math.random() * 16 + 12}px`;
                    coin.style.opacity = `${Math.random() * 0.5 + 0.5}`;
                    rainContainer.appendChild(coin);
                }

                showToast("¡Lluvia de Sigmacoins!", "success", 4000);

                setTimeout(() => {
                    rainContainer.remove();
                }, 5000); // Duración de la animación + delay
            }, 20 * 60 * 1000); // 20 minutos

            eventInterval = setInterval(triggerRandomEvent, CONFIG.eventInterval);
            if (Date.now() > state.market.nextUpdate) {
                updateMarket();
            }
            marketUpdateInterval = setInterval(updateMarket, CONFIG.marketUpdateInterval);

            if (menuToggle) {
                menuToggle.addEventListener('click', () => {
                    rightMenu.classList.toggle('active');
                    handleTutorialAction(4);
            }
            dotChests.classList.toggle('hidden', state.chests.length === 0);

            if(langSelect) langSelect.value = state.lang || 'es';

            if(centralFoso) centralFoso.addEventListener('click', handleCentralClick);

            if(btnMaintenance) btnMaintenance.addEventListener('click', openMaintenanceModal);
            if(maintenanceModal) {
                maintenanceModal.querySelector('.close-btn').addEventListener('click', () => {
                    maintenanceModal.classList.add('hidden'); 
                });
            }

            if(blackMarketModal) {
                blackMarketModal.querySelector('.close-btn').addEventListener('click', () => {
                    blackMarketModal.classList.add('hidden');
                });
            }

            const promoBtn = document.getElementById('promoBtn');
            if (promoBtn) {
                promoBtn.addEventListener('click', () => {
                    const code = promoInput.value.trim().toUpperCase();
                    if (!code) return;

                    if (code === 'IG') {
                        state.perClickMult *= 2;
                        showToast('¡Código IG! x2 de ganancias por 10 minutos.', 'success');
                        setTimeout(() => {
                            state.perClickMult /= 2;
                            showToast('El bonus del código IG ha terminado.', 'info');
                        }, 10 * 60 * 1000); // 10 minutos
                        promoInput.value = '';
                    } else if  (code === 'ALR') {
                        state.sig = Infinity;
                        state.gems = Infinity;
                        showToast('¡Código ALR! ¡Dinero y gemas infinitas!', 'success');
                        promoInput.value = '';
                    } 
                    else if (code === 'SIGMA') {
                        state.sig += 1000;
                        state.totalSigEarned += 1000;
                        showToast('¡Código SIGMA! +1,000 ΣC.', 'success');
                        promoInput.value = '';
                    } else if (code === 'FOSO') {
                        if (!state.fososOwned.includes(1)) {
                            state.fososOwned.push(1);
                            showToast('¡Código FOSO! Has desbloqueado el Foso 2.', 'success');
                        } else {
                            showToast('Ya tienes el Foso 2 desbloqueado.', 'warning');
                        }
                        promoInput.value = '';
                    } else if (code === 'GEMAS') {
                        state.gems += 50;
                        showToast('¡Código GEMAS! +50 gemas.', 'success');
                        promoInput.value = '';

                    }else {
                        showToast('Código promocional no válido.', 'error');
                    }
                });
            }


            if(btnPower) {
                btnPower.addEventListener('click', () => {
                    state.powerOn = !state.powerOn;
                    const powerStatus = state.powerOn ? 'encendido' : 'apagado';
                    const color = state.powerOn ? 'success' : 'error';
                    btnPower.style.background = state.powerOn ? '#0ea5b7' : '#555';
                    showToast(`Foso ${powerStatus}.`, color);
                    render();
                });
            }

            if(btnChargeToggle) btnChargeToggle.addEventListener('click', toggleCharging);
            
            // if(btnShop) btnShop.addEventListener('click', () => {
            //   if(shopModal) shopModal.classList.remove('hidden');
            // });

            if(shopModal) {
              shopModal.querySelectorAll('.close-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                  shopModal.classList.add('hidden'); 
                });
              });
            }

            if(btnUpgrades) btnUpgrades.addEventListener('click', () => {
                upgradesModal.classList.remove('hidden');
                renderUpgrades();
            }); 
            if(upgradesModal) {
                upgradesModal.querySelector('.close-btn').addEventListener('click', () => upgradesModal.classList.add('hidden'));
            }

            if(btnRebirth) btnRebirth.addEventListener('click', openRebirthModal); 
            if(rebirthModal) {
                rebirthModal.querySelector('.close-btn').addEventListener('click', () => {
                    rebirthModal.classList.add('hidden');
                });
                document.getElementById('btnConfirmRebirth').addEventListener('click', handleRebirth);
            }

            if(btnCrafting) btnCrafting.addEventListener('click', openCraftingModal);
            if(craftingModal) {
                craftingModal.querySelector('.close-btn').addEventListener('click', () => craftingModal.classList.add('hidden'));
                document.getElementById('btnCombine').addEventListener('click', combineLiquids);
                const slots = craftingModal.querySelectorAll('.crafting-slot');
                slots.forEach(slot => {
                    slot.addEventListener('dragover', (e) => { e.preventDefault(); slot.classList.add('over'); });
                    slot.addEventListener('dragleave', () => slot.classList.remove('over'));
                    slot.addEventListener('drop', handleDrop);
                    slot.addEventListener('click', () => { // Clear slot on click
                        delete slot.dataset.liquidId; slot.innerHTML = '';
                    });
                });
            }

            if(btnPrestige) btnPrestige.addEventListener('click', openPrestigeModal);
            if(prestigeModal) {
                prestigeModal.querySelector('.close-btn').addEventListener('click', () => {
                    prestigeModal.classList.add('hidden');
                });
                document.getElementById('btnConfirmPrestige').addEventListener('click', handlePrestige);
                prestigeModal.querySelector('#prestigeUpgradesGrid').addEventListener('click', (e) => {
                    if (e.target.classList.contains('buy-prestige-btn')) buyPrestigeUpgrade(e.target.dataset.id);
                });
            }


            
            if(btnConfig) btnConfig.addEventListener('click', ()=> {
              if(configModal) configModal.classList.remove('hidden');
              chkSmoke.checked = state.settings.smokeEnabled;
              chkClickNumbers.checked = state.settings.clickNumbersEnabled;
              musicVolumeSlider.value = state.settings.musicVolume;
              sfxVolumeSlider.value = state.settings.sfxVolume;
            });

            
            if(btnConfig) btnConfig.addEventListener('click', ()=> {
              if(configModal) configModal.classList.remove('hidden');
              chkSmoke.checked = state.settings.smokeEnabled;
              chkClickNumbers.checked = state.settings.clickNumbersEnabled;
              musicVolumeSlider.value = state.settings.musicVolume;
              sfxVolumeSlider.value = state.settings.sfxVolume;
            });

            if(configModal) {
              configModal.querySelectorAll('.close-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                  configModal.classList.add('hidden');
                });
              });
            }

            if(langSelect) langSelect.addEventListener('change', (e) => {
                state.lang = e.target.value;
                translateUI();
                render(); // Re-render dynamic parts like cooldowns
            });

            if(chkSmoke) chkSmoke.addEventListener('change', (e) => {
                state.settings.smokeEnabled = e.target.checked;
            });

            if(chkClickNumbers) chkClickNumbers.addEventListener('change', (e) => {
                state.settings.clickNumbersEnabled = e.target.checked;
            });

            if(musicVolumeSlider) musicVolumeSlider.addEventListener('input', (e) => {
                state.settings.musicVolume = parseFloat(e.target.value);
                if(bgMusic) bgMusic.volume = state.settings.musicVolume;
            });

            if(sfxVolumeSlider) sfxVolumeSlider.addEventListener('input', (e) => {
                state.settings.sfxVolume = parseFloat(e.target.value);
            });

            if(btnManualSave) btnManualSave.addEventListener('click', () => {
                saveState();
                showToast('¡Progreso guardado!', 'success');
            });

            if(btnRepeatTutorial) btnRepeatTutorial.addEventListener('click', () => {
                state.tutorialCompleted = false;
                state.tutorialStep = 0;
                configModal.classList.add('hidden'); showToast('El tutorial se mostrará de nuevo.', 'info'); startTutorial();
            });

            if(btnReset) btnReset.addEventListener('click', ()=>{
              if(confirm('⚠️ Esto borrará absolutamente TODO el progreso guardado en este juego.')){
                localStorage.clear();
                state = {};
                location.reload(true);
              }
            });

            if(btnMata) btnMata.addEventListener('click', ()=>{
              const now = Date.now();
              if(state.mataCooldownUntil && state.mataCooldownUntil > now) return;
              state.sig += CONFIG.mataReward;
              state.totalSigEarned += CONFIG.mataReward;
              state.mataUses = (state.mataUses || 0) + 1;
              state.mataCooldownUntil = now + CONFIG.mataCooldownSec*1000;
              checkAchievements();
              render();
            });

            if(btnDaily) btnDaily.addEventListener('click', openDailyModal);
            if(closeDaily) closeDaily.addEventListener('click', () => dailyModal.classList.add('hidden'));
            if(btnClaimDaily) btnClaimDaily.addEventListener('click', claimDailyReward);

            if(btnAFK) btnAFK.addEventListener('click', openAfkModal);
            if(afkModal) afkModal.querySelector('.close-btn').addEventListener('click', () => afkModal.classList.add('hidden'));
            if(btnClaimAFK) btnClaimAFK.addEventListener('click', claimAfkEarnings);
            if(btnUpgradeAFK) btnUpgradeAFK.addEventListener('click', upgradeAfk);
            afkModal.querySelectorAll('[data-close]').forEach(btn => btn.addEventListener('click', () => afkModal.classList.add('hidden')));

            if(btnWheel) {
                btnWheel.addEventListener('click', () => {
                    wheelModal.classList.remove('hidden');
                });
            }

            if(wheelModal) {
                wheelModal.querySelector('.close-btn').addEventListener('click', () => {
                    wheelModal.classList.add('hidden');
                });
            }

            if(btnSpinWheel) {
                btnSpinWheel.addEventListener('click', spinWheel);
            }

            if(btnMissions) {
                btnMissions.addEventListener('click', () => {
                    renderMissions();
                    missionsModal.classList.remove('hidden');
                });
            }

            if(missionsModal) {
                missionsModal.querySelector('.close-btn').addEventListener('click', () => {
                    missionsModal.classList.add('hidden');
                });
            }

            if(btnAchievements) {
                btnAchievements.addEventListener('click', () => {
                    renderAchievements();
                    achievementsModal.classList.remove('hidden');
                    dotAchievements.classList.add('hidden');
                });
            }

            if(achievementsModal) {
                achievementsModal.querySelector('.close-btn').addEventListener('click', () => {
                    achievementsModal.classList.add('hidden');
                });
            }

            if(btnChests) {
                btnChests.addEventListener('click', openChestsModal);
            }
            if(chestsModal) {
                chestsModal.querySelector('.close-btn').addEventListener('click', () => {
                    chestsModal.classList.add('hidden');
                });
            }

            if (btnPets) {
                btnPets.addEventListener('click', openPetsModal);
            }
            // Cargar sonidos
            bgMusic = document.getElementById('bgMusic');
            clickSfx = document.getElementById('clickSfx');
            buySfx = document.getElementById('buySfx');
            successSfx = document.getElementById('successSfx');
            errorSfx = document.getElementById('errorSfx');
            if (petsModal) {
                petsModal.querySelector('.close-btn').addEventListener('click', () => {
                    petsModal.classList.add('hidden');
                });
                petsModal.querySelector('#petsGrid').addEventListener('click', handlePetAction);
            }





            if (shopGrid) {
                shopGrid.addEventListener('click', (e) => {
                    const card = e.target.closest('.shopCard');
                    if (!card) return;

                    const itemIndex = card.dataset.index; // For fosos
                    const gemFosoIndex = card.dataset.gemFosoIndex; // For gem fosos
                    const flavorId = card.dataset.flavorId; // For flavors

                    if (itemIndex !== undefined) {
                        const index = parseInt(itemIndex, 10);
                        const item = FOSOS[index];                        
                        const currentCost = Math.round(item.cost * (state.market.priceMultipliers[index] || 1));

                        if (state.fososOwned.includes(index)) {
                            state.activeFosoIndex = index;
                            showToast(`Foso ${item.name} equipado.`, 'info');
                            // Al equipar un foso nuevo, se "arregla" si el anterior estaba quemado
                            if (state.burned) {
                                state.burned = false;
                                showToast('Foso nuevo equipado, ¡listo para usar!', 'success');
                            }
                        } else {
                            if (state.sig >= currentCost) {
                                state.sig -= currentCost;
                                state.fososOwned.push(index);
                                state.activeFosoIndex = index;
                                showToast(`Foso ${item.name} comprado y equipado!`, 'success');
                                playSound('buySfx');
                                updateMissionProgress('buy_foso', 1);                                
                                handleTutorialAction(5);
                                saveState();
                                checkAchievements();
                            } else {
                                showToast('No tienes suficientes Sigmacoins.', 'error');
                            }
                        }
                    } else if (gemFosoIndex !== undefined) {
                        const index = parseInt(gemFosoIndex, 10);
                        const item = GEM_FOSOS[index];
                        if (!state.gemFososOwned.includes(index)) {
                            if (state.gems >= item.cost) {
                                state.gems -= item.cost;
                                state.gemFososOwned.push(index);
                                showToast(`¡Foso de Gema comprado! Bonus de ganancias +5%`, 'success');
                                saveState();
                                playSound('buySfx');
                            } else {
                                showToast('No tienes suficientes gemas.', 'error');
                            }
                        }
                    } else if (flavorId) {
                        buyShopFlavor(flavorId);
                    }
                    render();
                });
            }

            if (upgradesGrid) {
                upgradesGrid.addEventListener('click', (e) => {
                    const button = e.target.closest('button[data-upgrade]');
                    if (!button) return;

                    const upgradeType = button.dataset.upgrade;
                    const allUpgrades = { autoclicker: AUTOCLICKER_UPGRADES, battery: BATTERY_UPGRADES, critical: CRITICAL_UPGRADES, efficiency: EFFICIENCY_UPGRADES, combo: COMBO_UPGRADES, liquid_luck: LIQUID_LUCK_UPGRADES, autorecharge: AUTORECHARGE_UPGRADES };
                    const upgrades = allUpgrades[upgradeType];
                    const currentLevel = state.upgradeLevels[upgradeType] || 0; // CORREGIDO

                    if (currentLevel < upgrades.length) {
                        if (!state.upgradeLevels[upgradeType]) state.upgradeLevels[upgradeType] = 0;
                        const nextUpgrade = upgrades[currentLevel];
                        const cost = nextUpgrade.cost;
                        if (state.sig >= cost) {
                            state.sig -= cost;
                            state.upgradeLevels[upgradeType]++;
                            if (upgradeType === 'battery') state.maxBattery = nextUpgrade.capacity; // CORREGIDO
                            if (upgradeType === 'autoclicker') updateAutoClickLoop();
                            playSound('buySfx');
                            saveState();
                            showToast(`¡Mejora de ${upgradeType} comprada!`, 'success');
                            renderUpgrades();
                        }
                    }
                });
            }

        });

        function handlePetAction(e) {
            const button = e.target.closest('.pet-action-btn');
            if (!button) return;

            const card = button.closest('.shopCard');
            const petId = card.dataset.petId;
            const pet = PETS[petId];
            const action = button.dataset.action;

            if (action === 'buy') {
                if (state.gems >= pet.cost) {
                    state.gems -= pet.cost;
                    state.unlockedPets.push(petId);
                    playSound('buySfx');
                    showToast(`¡Has adoptado a ${pet.name}!`, 'success');
                    saveState();
                    renderPets();
                } else {
                    showToast('No tienes suficientes gemas.', 'error');
                }
            } else if (action === 'equip') {
                state.equippedPet = petId;
                playSound('successSfx');
                saveState();
                renderPets();
            }
        }
    })();
</script>

<!-- Elementos de Audio -->
<audio id="bgMusic" loop src="data:audio/mp3;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjQ1LjEwMAAAAAAAAAAAAAAA//tAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAAAAAACQABAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEA//tA0BMAAAAAAABEluZm8AAAAPAAAABAAAASAAAAAAAAAAAAAAAAAAAAAAQU1BVE9SQUxTVE9SRQAA//tA1BMAAAAAAAABAAAAAQU1BVE9SQUxTVE9SRQAA//tA2BMAAAAAAAABAAAAAQU1BVE9SQUxTVE9SRQAA//tA3BMAAAAAAAABAAAAAQU1BVE9SQUxTVE9SRQAA//tA4BMAAAAAAAABAAAAAQU1BVE9SQUxTVE9SRQAA//tA5BMAAAAAAAABAAAAAQU1BVE9SQUxTVE9SRQAA//tA6BMAAAAAAAABAAAAAQU1BVE9SQUxTVE9SRQAA//tA7BMAAAAAAAABAAAAAQU1BVE9SQUxTVE9SRQAA//tA8BMAAAAAAAABAAAAAQU1BVE9SQUxTVE9SRQAA//tA9BMAAAAAAAABAAAAAQU1BVE9SQUxTVE9SRQAA//tA+BMAAAAAAAABAAAAAQU1BVE9SQUxTVE9SRQAA//tA/BMAAAAAAAABAAAAAQU1BVE9SQUxTVE9SRQAA//tBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA-"></audio>
<audio id="clickSfx" src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAAABkYXRhAAAAAA=="></audio>
<audio id="buySfx" src="data:audio/wav;base64,UklGRlIAAABXQVZFZm10IBAAAAABAAIARKwAABCxAgAEABgAZGF0YUYAAAD/////////////////v/7//v/+/////v/9//7/+//6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/e/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/a/UklGRlIAAABXQVZFZm10IBAAAAABAAIARKwAABCxAgAEABgAZGF0YUYAAAD/////////////////v/7//v/+/////v/9//7/+//6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/a/UklGRlIAAABXQVZFZm10IBAAAAABAAIARKwAABCxAgAEABgAZGF0YUYAAAD/////////////////v/7//v/+/////v/9//7/+//6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/6//r/+v/-"></audio>
<audio id="errorSfx" src="data:audio/wav;base64,UklGRiYAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAP//8v/L/8f/x//D/8T/wv/C/8P/w//E/8T/xP/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8-"></audio>
<audio id="successSfx" src="data:audio/wav;base64,UklGRiYAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAP//8v/L/8f/x//D/8T/wv/C/8P/w//E/8T/xP/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8//-"></audio>
<audio id="chestOpenSfx" src="data:audio/wav;base64,UklGRjIAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAAABkYXRhPAAAAP//8v/L/8f/x//D/8T/wv/C/8P/w//E/8T/xP/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8X/xf/F/8//-"></audio>
</body>
</html>
